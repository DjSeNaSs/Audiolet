var AudioletBuffer=function(a,c){this.numberOfChannels=a;this.length=c;this.channels=[];for(var b=0;b<this.numberOfChannels;b++){this.channels.push(new Float32Array(c))}this.unslicedChannels=[];for(var b=0;b<this.numberOfChannels;b++){this.unslicedChannels.push(this.channels[b])}this.isEmpty=false;this.channelOffset=0};AudioletBuffer.prototype.getChannelData=function(a){return(this.channels[a])};AudioletBuffer.prototype.set=function(a){var b=a.numberOfChannels;for(var c=0;c<b;c++){this.channels[c].set(a.getChannelData(c))}};AudioletBuffer.prototype.setSection=function(c,g,f,b){f=f||0;b=b||0;var d=c.numberOfChannels;for(var e=0;e<d;e++){f+=c.channelOffset;b+=this.channelOffset;var a=this.unslicedChannels[e].subarray(b,b+g);var h=c.unslicedChannels[e].subarray(f,f+g);
/*!
           var channel1 = this.getChannelData(i).subarray(outputOffset,
           outputOffset +
           length);
           var channel2 = buffer.getChannelData(i).subarray(inputOffset,
           inputOffset +
           length);
         */
a.set(h)}};AudioletBuffer.prototype.add=function(b){var f=this.length;var d=b.numberOfChannels;for(var e=0;e<d;e++){var a=this.getChannelData(e);var g=b.getChannelData(e);for(var c=0;c<f;c++){a[c]+=g[c]}}};AudioletBuffer.prototype.addSection=function(f,b,h,a){h=h||0;a=a||0;var k=f.numberOfChannels;for(var g=0;g<k;g++){var d=this.getChannelData(g);var c=f.getChannelData(g);for(var e=0;e<b;e++){d[e+a]+=c[e+h]}}};AudioletBuffer.prototype.resize=function(n,c,e,g){g=g||0;var j=this.channels;var b=this.unslicedChannels;var d=this.length;var f=this.channelOffset+g;for(var h=0;h<n;h++){var k=j[h];var m=b[h];if(c>d){var l=k;if(!e||!m||m.length<c){m=new Float32Array(c)}k=m.subarray(0,c);if(!e&&l){k.set(l,g)}f=0}else{if(!m){var a=b[0].length;m=new Float32Array(a)}g=f;k=m.subarray(g,g+c)}j[h]=k;b[h]=m}this.channels=j.slice(0,n);this.unslicedChannels=b.slice(0,n);this.length=c;this.numberOfChannels=n;this.channelOffset=f};AudioletBuffer.prototype.push=function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b);this.setSection(a,b,0,this.length-b)};AudioletBuffer.prototype.pop=function(a){var b=a.length;var c=this.length-b;a.setSection(this,b,c,0);this.resize(this.numberOfChannels,c)};AudioletBuffer.prototype.unshift=function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b,false,b);this.setSection(a,b,0,0)};AudioletBuffer.prototype.shift=function(a){var b=a.length;a.setSection(this,b,0,0);this.resize(this.numberOfChannels,this.length-b,false,b)};AudioletBuffer.prototype.zero=function(){var b=this.numberOfChannels;for(var c=0;c<b;c++){var e=this.getChannelData(c);var d=this.length;for(var a=0;a<d;a++){e[a]=0}}};AudioletBuffer.prototype.combined=function(){var a=this.channels;var b=this.numberOfChannels;var e=this.length;var d=new Float32Array(b*e);for(var c=0;c<b;c++){d.set(a[c],c*e)}return d};AudioletBuffer.prototype.interleaved=function(){var a=this.channels;var c=this.numberOfChannels;var e=this.length;var f=new Float32Array(c*e);for(var d=0;d<e;d++){for(var b=0;b<c;b++){f[c*d+b]=a[b][d]}}return f};AudioletBuffer.prototype.copy=function(){var a=new AudioletBuffer(this.numberOfChannels,this.length);a.set(this);return a};AudioletBuffer.prototype.load=function(c,a,d){var b=new AudioFileRequest(c,a);b.onSuccess=function(e){this.length=e.length;this.numberOfChannels=e.channels.length;this.unslicedChannels=e.channels;this.channels=e.channels;this.channelOffset=0;if(d){d()}}.bind(this);b.onFailure=function(){console.error("Could not load",c)}.bind(this);b.send()};var AudioletGroup=function(b,a,d){this.audiolet=b;this.inputs=[];for(var c=0;c<a;c++){this.inputs.push(new PassThroughNode(this.audiolet,1,1))}this.outputs=[];for(var c=0;c<d;c++){this.outputs.push(new PassThroughNode(this.audiolet,1,1))}};AudioletGroup.prototype.connect=function(c,b,a){this.outputs[b||0].connect(c,0,a)};AudioletGroup.prototype.disconnect=function(c,b,a){this.outputs[b||0].disconnect(c,0,a)};AudioletGroup.prototype.remove=function(){var a=this.inputs.length;for(var b=0;b<a;b++){this.inputs[b].remove()}var c=this.outputs.length;for(var b=0;b<c;b++){this.outputs[b].remove()}};
/*!
 * @depends AudioletGroup.js
 */
var AudioletDestination=function(c,b,a,d){AudioletGroup.call(this,c,1,0);this.device=new AudioletDevice(c,b,a,d);c.device=this.device;this.scheduler=new Scheduler(c);c.scheduler=this.scheduler;this.upMixer=new UpMixer(c,this.device.numberOfChannels);this.inputs[0].connect(this.scheduler);this.scheduler.connect(this.upMixer);this.upMixer.connect(this.device)};extend(AudioletDestination,AudioletGroup);AudioletDestination.prototype.toString=function(){return"Destination"};var AudioletNode=function(c,b,e,a){this.audiolet=c;this.inputs=[];for(var d=0;d<b;d++){this.inputs.push(new AudioletInput(this,d))}this.outputs=[];for(var d=0;d<e;d++){this.outputs.push(new AudioletOutput(this,d))}if(a){this.generate=a}this.timestamp=null};AudioletNode.prototype.connect=function(d,c,b){if(d instanceof AudioletGroup){d=d.inputs[b||0];b=0}var a=this.outputs[c||0];var e=d.inputs[b||0];a.connect(e);e.connect(a);this.audiolet.device.needTraverse=true};AudioletNode.prototype.disconnect=function(d,c,b){if(d instanceof AudioletGroup){d=d.inputs[b||0];b=0}var a=this.outputs[c||0];var e=d.inputs[b||0];e.disconnect(a);a.disconnect(e);this.audiolet.device.needTraverse=true};AudioletNode.prototype.setNumberOfOutputChannels=function(a,b){this.outputs[a].numberOfChannels=b};AudioletNode.prototype.linkNumberOfOutputChannels=function(b,a){this.outputs[b].linkNumberOfChannels(this.inputs[a])};AudioletNode.prototype.tick=function(){this.createInputSamples();this.createOutputSamples();this.generate()};AudioletNode.prototype.traverse=function(a){a=this.traverseParents(a);if(a.indexOf(this)==-1){a.push(this)}return a};AudioletNode.prototype.traverseParents=function(c){var a=this.inputs.length;for(var e=0;e<a;e++){var b=this.inputs[e];var f=b.connectedFrom.length;for(var d=0;d<f;d++){c=b.connectedFrom[d].node.traverse(c)}}return c};AudioletNode.prototype.generate=function(){};AudioletNode.prototype.createInputSamples=function(){var a=this.inputs.length;for(var f=0;f<a;f++){var d=this.inputs[f];if(!d.connectedFrom.length){continue}var h=0;for(var e=0;e<d.connectedFrom.length;e++){var c=d.connectedFrom[e];for(var b=0;b<c.samples.length;b++){var g=c.samples[b];if(b<h){d.samples[b]+=g}else{d.samples[b]=g;h+=1}}}if(d.samples.length>h){d.samples=d.samples.slice(0,h)}}};AudioletNode.prototype.createOutputSamples=function(){var e=this.outputs.length;for(var d=0;d<e;d++){var a=this.outputs[d];var c=a.getNumberOfChannels();if(a.samples.length==c){continue}else{if(a.samples.length>c){a.samples=a.samples.slice(0,c);continue}}for(var b=a.samples.length;b<c;b++){a.samples[b]=0}}};AudioletNode.prototype.remove=function(){var g=this.inputs.length;for(var e=0;e<g;e++){var h=this.inputs[e];var c=h.connectedFrom.length;for(var d=0;d<c;d++){var a=h.connectedFrom[d];var b=a.node;b.disconnect(this,a.index,e)}}var f=this.outputs.length;for(var e=0;e<f;e++){var b=this.outputs[e];var c=b.connectedTo.length;for(var d=0;d<c;d++){var k=b.connectedTo[d];var h=k.node;this.disconnect(h,e,k.index)}}};
/*!
 * @depends AudioletNode.js
 */
function AudioletDevice(c,b,a,d){AudioletNode.call(this,c,1,0);this.sink=Sink(this.tick.bind(this),a,d,b);this.sampleRate=this.sink.sampleRate;this.numberOfChannels=this.sink.channelCount;this.bufferSize=this.sink.preBufferSize;this.writePosition=0;this.buffer=null;this.paused=false;this.needTraverse=true;this.nodes=[]}extend(AudioletDevice,AudioletNode);AudioletDevice.prototype.tick=function(a,d){if(!this.paused){var b=this.inputs[0];var f=a.length/d;for(var e=0;e<f;e++){if(this.needTraverse){this.nodes=this.traverse([]);this.needTraverse=false}for(var c=0;c<this.nodes.length-1;c++){this.nodes[c].tick()}this.createInputSamples();for(var c=0;c<d;c++){a[e*d+c]=b.samples[c]}this.writePosition+=1}}};AudioletDevice.prototype.getPlaybackTime=function(){return this.sink.getPlaybackTime()};AudioletDevice.prototype.getWriteTime=function(){return this.writePosition};AudioletDevice.prototype.pause=function(){this.paused=true};AudioletDevice.prototype.play=function(){this.paused=false};AudioletDevice.prototype.toString=function(){return"Audio Output Device"};var AudioletInput=function(b,a){this.node=b;this.index=a;this.connectedFrom=[];this.samples=[]};AudioletInput.prototype.connect=function(a){this.connectedFrom.push(a)};AudioletInput.prototype.disconnect=function(a){var c=this.connectedFrom.length;for(var b=0;b<c;b++){if(a==this.connectedFrom[b]){this.connectedFrom.splice(b,1);break}}if(this.connectedFrom.length==0){this.samples=[]}};AudioletInput.prototype.toString=function(){return this.node.toString()+"Input #"+this.index};var Audiolet=function(b,a,c){this.output=new AudioletDestination(this,b,a,c)};var AudioletOutput=function(b,a){this.node=b;this.index=a;this.connectedTo=[];this.samples=[];this.linkedInput=null;this.numberOfChannels=1};AudioletOutput.prototype.connect=function(a){this.connectedTo.push(a)};AudioletOutput.prototype.disconnect=function(a){var c=this.connectedTo.length;for(var b=0;b<c;b++){if(a==this.connectedTo[b]){this.connectedTo.splice(b,1);break}}};AudioletOutput.prototype.linkNumberOfChannels=function(a){this.linkedInput=a};AudioletOutput.prototype.unlinkNumberOfChannels=function(){this.linkedInput=null};AudioletOutput.prototype.getNumberOfChannels=function(){if(this.linkedInput&&this.linkedInput.connectedFrom.length){return(this.linkedInput.samples.length)}return(this.numberOfChannels)};AudioletOutput.prototype.toString=function(){return this.node.toString()+"Output #"+this.index+" - "};var AudioletParameter=function(a,c,b){this.node=a;if(typeof c!="undefined"&&c!=null){this.input=a.inputs[c]}else{this.input=null}this.value=b||0};AudioletParameter.prototype.isStatic=function(){return(this.input.samples.length==0)};AudioletParameter.prototype.isDynamic=function(){return(this.input.samples.length>0)};AudioletParameter.prototype.setValue=function(a){this.value=a};AudioletParameter.prototype.getValue=function(){if(this.input!=null&&this.input.samples.length>0){return this.input.samples[0]}else{return this.value}};function extend(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b();a.prototype.constructor=a}
/*!
 * @depends ../core/AudioletNode.js
 */
var ParameterNode=function(a,b){AudioletNode.call(this,a,1,1);this.parameter=new AudioletParameter(this,0,b)};extend(ParameterNode,AudioletNode);ParameterNode.prototype.generate=function(){output.samples[0]=this.parameter.getValue()};ParameterNode.prototype.toString=function(){return"Parameter Node"};
/*!
 * @depends AudioletNode.js
 */
var PassThroughNode=function(b,a,c){AudioletNode.call(this,b,a,c)};extend(PassThroughNode,AudioletNode);PassThroughNode.prototype.createOutputSamples=function(e){var f=this.outputs.length;var a=this.inputs.length;for(var d=0;d<f;d++){var c=this.outputs[d];if(d<a){var b=this.inputs[d];c.samples=b.samples}else{c.samples=new Array(c.getNumberOfChannels())}}};PassThroughNode.prototype.toString=function(){return"Pass Through Node"};var PriorityQueue=function(c,b){if(b){this.compare=b}if(c){this.heap=c;for(var a=0;a<Math.floor(this.heap.length/2);a++){this.siftUp(a)}}else{this.heap=[]}};PriorityQueue.prototype.push=function(a){this.heap.push(a);this.siftDown(0,this.heap.length-1)};PriorityQueue.prototype.pop=function(){var b,a;b=this.heap.pop();if(this.heap.length){var a=this.heap[0];this.heap[0]=b;this.siftUp(0)}else{a=b}return(a)};PriorityQueue.prototype.peek=function(){return(this.heap[0])};PriorityQueue.prototype.isEmpty=function(){return(this.heap.length==0)};PriorityQueue.prototype.siftDown=function(d,a){var b=this.heap[a];while(a>d){var e=(a-1)>>1;var c=this.heap[e];if(this.compare(b,c)){this.heap[a]=c;a=e;continue}break}this.heap[a]=b};PriorityQueue.prototype.siftUp=function(a){var e=this.heap.length;var d=a;var c=this.heap[a];var b=2*a+1;while(b<e){var f=b+1;if(f<e&&!this.compare(this.heap[b],this.heap[f])){b=f}this.heap[a]=this.heap[b];a=b;b=2*a+1}this.heap[a]=c;this.siftDown(d,a)};PriorityQueue.prototype.compare=function(d,c){return(d<c)};
/*!
 * @depends PassThroughNode.js
 */
var Scheduler=function(a,b){PassThroughNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0);this.bpm=b||120;this.queue=new PriorityQueue(null,function(d,c){return(d.time<c.time)});this.time=0;this.beat=0;this.beatInBar=0;this.bar=0;this.seconds=0;this.beatsPerBar=0;this.lastBeatTime=0;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate};extend(Scheduler,PassThroughNode);Scheduler.prototype.setTempo=function(a){this.bpm=a;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate};Scheduler.prototype.addRelative=function(a,c){var b={};b.callback=c;b.time=this.time+a*this.beatLength;this.queue.push(b);return b};Scheduler.prototype.addAbsolute=function(b,c){if(b<this.beat||b==this.beat&&this.time>this.lastBeatTime){return null}var a={};a.callback=c;a.time=this.lastBeatTime+(b-this.beat)*this.beatLength;this.queue.push(a);return a};Scheduler.prototype.play=function(b,a,d){var c={};c.patterns=b;c.durationPattern=a;c.callback=d;c.time=this.audiolet.device.getWriteTime();this.queue.push(c);return c};Scheduler.prototype.playAbsolute=function(d,b,a,e){if(d<this.beat||d==this.beat&&this.time>this.lastBeatTime){return null}var c={};c.patterns=b;c.durationPattern=a;c.callback=e;c.time=this.lastBeatTime+(d-this.beat)*this.beatLength;this.queue.push(c);return c};Scheduler.prototype.remove=function(b){var a=this.queue.heap.indexOf(b);if(a!=-1){this.queue.heap.splice(a,1);this.queue=new PriorityQueue(this.queue.heap,function(d,c){return(d.time<c.time)})}};Scheduler.prototype.stop=function(a){this.remove(a)};Scheduler.prototype.tick=function(){PassThroughNode.prototype.tick.call(this);this.tickClock();while(!this.queue.isEmpty()&&this.queue.peek().time<=this.time){var a=this.queue.pop();this.processEvent(a)}};Scheduler.prototype.tickClock=function(){this.time+=1;this.seconds=this.time/this.audiolet.device.sampleRate;if(this.time>=this.lastBeatTime+this.beatLength){this.beat+=1;this.beatInBar+=1;if(this.beatInBar==this.beatsPerBar){this.bar+=1;this.beatInBar=0}this.lastBeatTime+=this.beatLength}};Scheduler.prototype.processEvent=function(a){var h=a.durationPattern;if(h){var g=[];var b=a.patterns;var e=b.length;for(var d=0;d<e;d++){var f=b[d];var j=f.next();if(j!=null){g.push(j)}else{return}}a.callback.apply(null,g);var c;if(h instanceof Pattern){c=h.next()}else{c=h}if(c){a.time+=c*this.beatLength;this.queue.push(a)}}else{a.callback()}};Scheduler.prototype.toString=function(){return"Scheduler"};var Int8Array,Uint8Array,Int16Array,Uint16Array;var Int32Array,Uint32Array,Float32Array,Float64Array;var types=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];var original,shim;for(var i=0;i<types.length;++i){if(types[i]){if(types[i].prototype.slice===undefined){original="subarray";shim="slice"}else{if(types[i].prototype.subarray===undefined){original="slice";shim="subarray"}}Object.defineProperty(types[i].prototype,shim,{value:types[i].prototype[original],enumerable:false})}}
/*!
 * @depends ../core/AudioletNode.js
 */
var Add=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||0)};extend(Add,AudioletNode);Add.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]+o}}};Add.prototype.toString=function(){return"Add"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Divide=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Divide,AudioletNode);Divide.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]/o}}};Divide.prototype.toString=function(){return"Divide"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Modulo=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Modulo,AudioletNode);Modulo.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]%o}}};Modulo.prototype.toString=function(){return"Modulo"};
/*!
 * @depends ../core/AudioletNode.js
 */
var MulAdd=function(a,c,b){AudioletNode.call(this,a,3,1);this.linkNumberOfOutputChannels(0,0);this.mul=new AudioletParameter(this,1,c||1);this.add=new AudioletParameter(this,2,b||0)};extend(MulAdd,AudioletNode);MulAdd.prototype.generate=function(m,q){var n=m[0];var c=q[0];if(n.isEmpty){c.isEmpty=true;return}var f=this.mul;var e,d;if(f.isStatic()){e=f.getValue()}else{d=f.getChannel()}var p=this.add;var r,l;if(p.isStatic()){r=p.getValue()}else{l=p.getChannel()}var o=n.numberOfChannels;for(var k=0;k<o;k++){var b=n.getChannelData(k);var h=c.getChannelData(k);var a=n.length;for(var g=0;g<a;g++){if(d){e=d[g]}if(l){r=l[g]}h[g]=b[g]*e+r}}};MulAdd.prototype.toString=function(){return"Multiplier/Adder"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Multiply=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Multiply,AudioletNode);Multiply.prototype.generate=function(d,f){var e=this.value.getValue();var a=this.inputs[0];var b=a.samples.length;for(var c=0;c<b;c++){this.outputs[0].samples[c]=a.samples[c]*e}};Multiply.prototype.toString=function(){return"Multiply"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Reciprocal=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(Reciprocal,AudioletNode);Reciprocal.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){e[d]=1/b[d]}}};Reciprocal.prototype.toString=function(){return"Reciprocal"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Subtract=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||0)};extend(Subtract,AudioletNode);Subtract.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]-o}}};Subtract.prototype.toString=function(){return"Subtract"};var Tanh=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(Tanh,AudioletNode);Tanh.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){var m=b[d];e[d]=(Math.exp(m)-Math.exp(-m))/(Math.exp(m)+Math.exp(-m))}}};Tanh.prototype.toString=function(){return("Tanh")};
/*!
 * @depends ../core/AudioletNode.js
 */
var Envelope=function(b,c,d,f,a,e){AudioletNode.call(this,b,1,1);this.gate=new AudioletParameter(this,0,c||1);this.levels=d;this.times=f;this.releaseStage=a;this.onComplete=e;this.stage=null;this.time=null;this.changeTime=null;this.level=this.levels[0];this.delta=0;this.gateOn=false};extend(Envelope,AudioletNode);Envelope.prototype.generate=function(c,d){var b=this.gate.getValue();var a=false;if(b&&!this.gateOn){this.gateOn=true;this.stage=0;this.time=0;this.delta=0;this.level=this.levels[0];if(this.stage!=this.releaseStage){a=true}}if(this.gateOn&&!b){this.gateOn=false;if(this.releaseStage!=null){this.stage=this.releaseStage;a=true}}if(this.changeTime){this.time+=1;if(this.time>=this.changeTime){this.stage+=1;if(this.stage!=this.releaseStage){a=true}else{this.changeTime=null;this.delta=0}}}if(a){if(this.stage!=this.times.length){this.delta=this.calculateDelta(this.stage,this.level);this.changeTime=this.calculateChangeTime(this.stage,this.time)}else{if(this.onComplete){this.onComplete()}this.stage=null;this.time=null;this.changeTime=null;this.delta=0}}this.level+=this.delta;this.outputs[0].samples[0]=this.level};Envelope.prototype.calculateDelta=function(b,d){var c=this.levels[b+1]-d;var a=this.times[b]*this.audiolet.device.sampleRate;return(c/a)};Envelope.prototype.calculateChangeTime=function(b,c){var a=this.times[b]*this.audiolet.device.sampleRate;return(c+a)};Envelope.prototype.toString=function(){return"Envelope"};
/*!
 * @depends Envelope.js
 */
var ADSREnvelope=function(j,e,c,d,g,f,b){var h=[0,1,g,0];var a=[c,d,f];Envelope.call(this,j,e,h,a,2,b)};extend(ADSREnvelope,Envelope);ADSREnvelope.prototype.toString=function(){return"ADSR Envelope"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BiquadFilter=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.frequency=new AudioletParameter(this,1,b||22100);this.lastFrequency=null;this.xValues=[];this.yValues=[];this.b0=0;this.b1=0;this.b2=0;this.a0=0;this.a1=0;this.a2=0};extend(BiquadFilter,AudioletNode);BiquadFilter.prototype.calculateCoefficients=function(a){};BiquadFilter.prototype.generate=function(c,q){var w=c[0];var E=q[0];if(w.isEmpty){E.isEmpty=true;return}var v=this.xValues;var A=this.yValues;var f=[];var s=[];var g=w.numberOfChannels;for(var y=0;y<g;y++){f.push(w.getChannelData(y));s.push(E.getChannelData(y));if(y>=v.length){v.push([0,0]);A.push([0,0])}}var p=this.frequency;var u,e;if(p.isStatic()){u=p.getValue()}else{e=p.getChannel()}var r=this.lastFrequency;var H=this.a0;var G=this.a1;var F=this.a2;var o=this.b0;var n=this.b1;var m=this.b2;var l=E.length;for(var y=0;y<l;y++){if(e){var u=e[y]}if(u!=r){this.calculateCoefficients(u);r=u;H=this.a0;G=this.a1;F=this.a2;o=this.b0;n=this.b1;m=this.b2}for(var x=0;x<g;x++){var k=f[x];var t=s[x];var C=v[x];var B=C[0];var z=C[1];var h=A[x];var b=h[0];var a=h[1];var D=k[y];var d=(o/H)*D+(n/H)*B+(m/H)*z-(G/H)*b-(F/H)*a;t[y]=d;C[0]=D;C[1]=B;h[0]=d;h[1]=b}}this.lastFrequency=r};BiquadFilter.prototype.toString=function(){return"Biquad Filter"};
/*!
 * @depends BiquadFilter.js
 */
var AllPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(AllPassFilter,BiquadFilter);AllPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1-d;this.b1=-2*a;this.b2=1+d;this.a0=1+d;this.a1=-2*a;this.a2=1-d};AllPassFilter.prototype.toString=function(){return"All Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Amplitude=function(c,d,a){AudioletNode.call(this,c,3,1);this.linkNumberOfOutputChannels(0,0);this.followers=[];var b=this.audiolet.device.sampleRate;this.attack=new AudioletParameter(this,1,d||0.01);this.release=new AudioletParameter(this,2,a||0.01)};extend(Amplitude,AudioletNode);Amplitude.prototype.generate=function(b,h){var p=b[0];var v=h[0];if(p.isEmpty){v.isEmpty=true;return}var d=this.followers;var e=d.length;var a=this.audiolet.device.sampleRate;var w=this.attack;var r,m;if(w.isStatic()){r=Math.pow(0.01,1/(w.getValue()*a))}else{m=w.getChannel()}var t=this.release;var u,n;if(t.isStatic()){u=Math.pow(0.01,1/(t.getValue()*a))}else{n=t.getChannel()}var c=p.numberOfChannels;for(var s=0;s<c;s++){if(s>=e){d.push(0)}var k=d[s];var f=p.getChannelData(s);var l=v.getChannelData(s);var g=p.length;for(var q=0;q<g;q++){var o=Math.abs(f[q]);if(m){r=Math.pow(0.01,1/(m[q]*a))}if(n){u=Math.pow(0.01,1/(n[q]*a))}if(o>k){k=r*(k-o)+o}else{k=u*(k-o)+o}l[q]=k}d[s]=k}};Amplitude.prototype.toString=function(){return("Amplitude")};
/*!
 * @depends ../core/PassThroughNode.js
 */
var BadValueDetector=function(a,b){PassThroughNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0);if(b){this.callback=b}};extend(BadValueDetector,PassThroughNode);BadValueDetector.prototype.callback=function(c,b,a){console.error(c+" detected at channel "+b+" index "+a)};BadValueDetector.prototype.generate=function(d,g){var e=d[0];if(e.isEmpty){return}var h=e.numberOfChannels;for(var c=0;c<h;c++){var f=e.getChannelData(c);var a=e.length;for(var b=0;b<a;b++){var k=f[b];if(typeof k=="undefined"||k==null||isNaN(k)||k==Infinity||k==-Infinity){this.callback(k,c,b)}}}};BadValueDetector.prototype.toString=function(){return"Bad Value Detector"};
/*!
 * @depends BiquadFilter.js
 */
var BandPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(BandPassFilter,BiquadFilter);BandPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=d;this.b1=0;this.b2=-d;this.a0=1+d;this.a1=-2*a;this.a2=1-d};BandPassFilter.prototype.toString=function(){return"Band Pass Filter"};
/*!
 * @depends BiquadFilter.js
 */
var BandRejectFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(BandRejectFilter,BiquadFilter);BandRejectFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1;this.b1=-2*a;this.b2=1;this.a0=1+d;this.a1=-2*a;this.a2=1-d};BandRejectFilter.prototype.toString=function(){return"Band Reject Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BitCrusher=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.bits=new AudioletParameter(this,1,b)};extend(BitCrusher,AudioletNode);BitCrusher.prototype.generate=function(d,f){var a=this.inputs[0];var e=Math.pow(2,this.bits.getValue())-1;var b=a.samples.length;for(var c=0;c<b;c++){this.outputs[0].samples[c]=Math.floor(a.samples[c]*e)/e}};BitCrusher.prototype.toString=function(){return"BitCrusher"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BufferPlayer=function(c,b,e,d,a,f){AudioletNode.call(this,c,3,1);this.buffer=b;this.setNumberOfOutputChannels(0,this.buffer.numberOfChannels);this.position=d||0;this.playbackRate=new AudioletParameter(this,0,e||1);this.restartTrigger=new AudioletParameter(this,1,0);this.startPosition=new AudioletParameter(this,2,d||0);this.loop=new AudioletParameter(this,3,a||0);this.onComplete=f;this.restartTriggerOn=false;this.playing=true};extend(BufferPlayer,AudioletNode);BufferPlayer.prototype.generate=function(c,o){var x=o[0];var u=this.buffer;var A=this.position;var h=this.playing;var z=this.restartTriggerOn;var t=this.playbackRate;var m,r;if(t.isStatic()){m=t.getValue()}else{r=t.getChannel()}var n=this.restartTrigger;var d,b;if(n.isStatic()){d=n.getValue()}else{b=n.getChannel()}var g=this.startPosition;var p,s;if(g.isStatic()){p=g.getValue()}else{s=g.getChannel()}var e=this.loop;var y,a;if(e.isStatic()){y=e.getValue()}else{a=e.getChannel()}if(u.length==0||(!b&&!h)){x.isEmpty=true;return}var f=u.numberOfChannels;var l=x.length;for(var w=0;w<l;w++){if(r){m=r[w]}if(b){d=b[w]}if(a){y=a[w]}if(d>0&&!z){A=p;z=true;h=true}if(d<=0&&z){z=false}if(h){for(var v=0;v<f;v++){var k=u.channels[v];var q=x.channels[v];q[w]=k[Math.floor(A)]}A+=m;if(A>=u.length){if(y){A%=u.length}else{h=false;if(this.onComplete){this.onComplete()}}}}else{for(var v=0;v<f;v++){var q=x.channels[v];q[w]=0}}}this.playing=h;this.position=A;this.restartTriggerOn=z};BufferPlayer.prototype.toString=function(){return("Buffer player")};
/*!
 * @depends ../core/AudioletNode.js
 */
var CombFilter=function(a,d,c,b){AudioletNode.call(this,a,3,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=d;this.delayTime=new AudioletParameter(this,1,c||1);this.decayTime=new AudioletParameter(this,2,b);var e=d*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(CombFilter,AudioletNode);CombFilter.prototype.generate=function(d,p){var s=d[0];var y=p[0];if(s.isEmpty){y.isEmpty=true;return}var w=this.maximumDelayTime;var c=this.audiolet.device.sampleRate;var C=this.delayTime;var a,x;if(C.isStatic()){a=Math.floor(C.getValue()*c)}else{x=C.getChannel()}var b=this.decayTime;var e,n;if(b.isStatic()){e=Math.floor(b.getValue()*c)}else{n=b.getChannel()}var f;if(C.isStatic()&&b.isStatic()){f=Math.exp(-3*a/e)}var A=this.buffers;var B=this.readWriteIndex;var h=s.channels;var q=y.channels;var g=s.numberOfChannels;var z=A.length;for(var v=z;v<g;v++){var l=w*c;A.push(new Float32Array(l))}var m=s.length;for(var v=0;v<m;v++){if(x){a=Math.floor(x[v]*c)}if(n){e=Math.floor(n[v]*c)}if(x||n){f=Math.exp(-3*a/e)}for(var u=0;u<g;u++){var k=h[u];var r=q[u];var t=A[u];var o=t[B];r[v]=o;t[B]=k[v]+f*o}B+=1;if(B>=a){B=0}}this.readWriteIndex=B};CombFilter.prototype.toString=function(){return"Comb Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var TableLookupOscillator=function(a,b,c){AudioletNode.call(this,a,1,1);this.table=b;this.frequency=new AudioletParameter(this,0,c||440);this.phase=0};extend(TableLookupOscillator,AudioletNode);TableLookupOscillator.prototype.generate=function(){this.outputs[0].samples[0]=this.table[Math.floor(this.phase)];var b=this.audiolet.device.sampleRate;var c=this.frequency.getValue();var a=this.table.length;this.phase+=c*a/b;if(this.phase>a){this.phase%=a}};TableLookupOscillator.prototype.toString=function(){return"Table Lookup Oscillator"};
/*!
 * @depends TableLookupOscillator.js
 */
var Sine=function(a,b){TableLookupOscillator.call(this,a,Sine.TABLE,b)};extend(Sine,TableLookupOscillator);Sine.prototype.toString=function(){return"Sine"};Sine.TABLE=[];for(var i=0;i<8192;i++){Sine.TABLE.push(Math.sin(i*2*Math.PI/8192))}
/*!
 * @depends ../core/AudioletNode.js
 * @depends Sine.js
 */
var CrossFade=function(b,a){AudioletNode.call(this,b,3,1);this.linkNumberOfOutputChannels(0,0);this.position=new AudioletParameter(this,2,a||0.5)};extend(CrossFade,AudioletNode);CrossFade.prototype.generate=function(f,r){var n=f[0];var m=f[1];var y=r[0];var c=n.channels;var b=m.channels;var s=y.channels;if(n.isEmpty&&m.isEmpty){y.isEmpty=true;return}var v=this.position;var z,w;if(v.isStatic()){z=v.getValue()}else{w=v.getChannel()}var q=y.length;for(var x=0;x<q;x++){if(w){z=w[x]}var a=Sine.TABLE.length/4;var k=Math.floor(z*a);var g=Sine.TABLE[k+a];var d=Sine.TABLE[k];var l=n.numberOfChannels;for(var u=0;u<l;u++){var p=c[u];var o=b[u];var t=s[u];var h,e;if(!n.isEmpty){h=p[x]}else{h=0}if(!m.isEmpty){e=o[x]}else{e=0}t[x]=h*g+e*d}}};CrossFade.prototype.toString=function(){return"Cross Fader"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DampedCombFilter=function(b,e,d,c,a){AudioletNode.call(this,b,4,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=e;this.delayTime=new AudioletParameter(this,1,d||1);this.decayTime=new AudioletParameter(this,2,c);this.damping=new AudioletParameter(this,3,a);var f=e*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0;this.filterStore=0};extend(DampedCombFilter,AudioletNode);DampedCombFilter.prototype.generate=function(d,r){var v=d[0];var B=r[0];if(v.isEmpty){B.isEmpty=true;return}var z=this.maximumDelayTime;var c=this.audiolet.device.sampleRate;var F=this.delayTime;var a,A;if(F.isStatic()){a=Math.floor(F.getValue()*c)}else{A=F.getChannel()}var b=this.decayTime;var e,o;if(b.isStatic()){e=Math.floor(b.getValue()*c)}else{o=b.getChannel()}var p=this.damping;var f,G;if(p.isStatic()){f=p.getValue()}else{G=p.getChannel()}var g;if(F.isStatic()&&b.isStatic()){g=Math.exp(-3*a/e)}var E=this.buffers;var D=this.readWriteIndex;var t=this.filterStore;var k=v.channels;var s=B.channels;var h=v.numberOfChannels;var C=E.length;for(var y=C;y<h;y++){var m=z*c;E.push(new Float32Array(m))}var n=v.length;for(var y=0;y<n;y++){if(A){a=Math.floor(A[y]*c)}if(o){e=Math.floor(o[y]*c)}if(G){f=G[y]}if(A||o){g=Math.exp(-3*a/e)}for(var x=0;x<h;x++){var l=k[x];var u=s[x];var w=E[x];var q=w[D];t=(q*(1-f))+(t*f);u[y]=q;w[D]=l[y]+g*t}D+=1;if(D>=a){D=0}}this.readWriteIndex=D;this.filterStore=t};DampedCombFilter.prototype.toString=function(){return"Damped Comb Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DCFilter=function(b,a){AudioletNode.call(this,b,2,1);this.linkNumberOfOutputChannels(0,0);this.coefficient=new AudioletParameter(this,1,a||0.995);this.xValues=[];this.yValues=[]};extend(DCFilter,AudioletNode);DCFilter.prototype.generate=function(f,h){var c=this.coefficient.getValue();var a=this.inputs[0];var b=a.samples.length;for(var e=0;e<b;e++){if(e>=this.xValues.length){this.xValues.push(0)}if(e>=this.yValues.length){this.yValues.push(0)}var d=a.samples[e];var g=d-this.xValues[e]+c*this.yValues[e];this.outputs[0].samples[e]=g;this.xValues[e]=d;this.yValues[e]=g}};DCFilter.prototype.toString=function(){return"DC Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Delay=function(a,c,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=c;this.delayTime=new AudioletParameter(this,1,b||1);var d=c*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(Delay,AudioletNode);Delay.prototype.generate=function(c,k){var n=c[0];var t=k[0];var r=this.maximumDelayTime;var b=this.audiolet.device.sampleRate;var w=this.delayTime;var a,s;if(w.isStatic()){a=Math.floor(w.getValue()*b)}else{s=w.getChannel()}var u=this.buffers;var v=this.readWriteIndex;var d=[];var l=[];var e=n.numberOfChannels;for(var q=0;q<e;q++){d.push(n.getChannelData(q));l.push(t.getChannelData(q));if(q>=u.length){var g=r*b;u.push(new Float32Array(g))}}var h=n.length;for(var q=0;q<h;q++){if(s){a=Math.floor(s[q]*b)}for(var p=0;p<e;p++){var f=d[p];var m=l[p];var o=u[p];m[q]=o[v];if(!n.isEmpty){o[v]=f[q]}else{o[v]=0}}v+=1;if(v>=a){v=0}}this.readWriteIndex=v};Delay.prototype.toString=function(){return"Delay"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DiscontinuityDetector=function(b,a,c){AudioletNode.call(this,b,1,1);this.linkNumberOfOutputChannels(0,0);this.threshold=a||0.2;if(c){this.callback=c}this.lastValues=[]};extend(DiscontinuityDetector,AudioletNode);DiscontinuityDetector.prototype.callback=function(b,c,a){console.error("Discontinuity of "+b+" detected on channel "+c+" index "+a)};DiscontinuityDetector.prototype.generate=function(d,l){var g=d[0];if(g.isEmpty){this.lastValues=[];return}var f=this.lastValues;var e=this.threshold;var m=g.numberOfChannels;for(var c=0;c<m;c++){var h=g.getChannelData(c);if(c>=f.length){f.push(null)}var k=f[c];var a=g.length;for(var b=0;b<a;b++){var n=h[b];if(k!=null){if(Math.abs(k-n)>e){this.callback(Math.abs(k-n),c,b)}}k=n}f[c]=k}};DiscontinuityDetector.prototype.toString=function(){return"Discontinuity Detector"};
/*!
 * @depends ../core/AudioletNode.js
 */
var FeedbackDelay=function(b,e,d,a,c){AudioletNode.call(this,b,4,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=e;this.delayTime=new AudioletParameter(this,1,d||1);this.feedback=new AudioletParameter(this,2,a||0.5);this.mix=new AudioletParameter(this,3,c||1);var f=e*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(FeedbackDelay,AudioletNode);FeedbackDelay.prototype.generate=function(h,k){var l=this.inputs[0];var c=this.outputs[0];var g=this.delayTime.getValue();var a=this.feedback.getValue();var p=this.mix.getValue();var m=this.audiolet.output.device.sampleRate;var j=l.samples.length;var d=this.buffers.length;for(var f=0;f<j;f++){if(f>=d){var b=this.maximumDelayTime*m;this.buffers.push(new Float32Array(b))}var e=this.buffers[f];var o=l.samples[f];var n=e[this.readWriteIndex];c.samples[f]=p*n+(1-p)*o;e[this.readWriteIndex]=o+a*n}this.readWriteIndex+=1;if(this.readWriteIndex>=g){this.readWriteIndex=0}};FeedbackDelay.prototype.toString=function(){return"Feedback Delay"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Gain=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.gain=new AudioletParameter(this,1,b||1)};extend(Gain,AudioletNode);Gain.prototype.generate=function(d,f){var e=this.gain.getValue();var a=this.inputs[0];var b=a.samples.length;for(var c=0;c<b;c++){this.outputs[0].samples[c]=a.samples[c]*e}};Gain.prototype.toString=function(){return("Gain")};
/*!
 * @depends BiquadFilter.js
 */
var HighPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(HighPassFilter,BiquadFilter);HighPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1+a)/2;this.b1=-(1+a);this.b2=this.b0;this.a0=1+d;this.a1=-2*a;this.a2=1-d};HighPassFilter.prototype.toString=function(){return"High Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Lag=function(a,c,b){AudioletNode.call(this,a,2,1);this.value=new AudioletParameter(this,0,c||0);this.lag=new AudioletParameter(this,1,b||1);this.lastValue=c||0;this.log001=Math.log(0.001)};extend(Lag,AudioletNode);Lag.prototype.generate=function(l,p){var d=p[0];var j=d.getChannelData(0);var r=this.audiolet.device.sampleRate;var f=this.log001;var n=this.value;var q,b;if(n.isStatic()){q=n.getValue()}else{b=n.getChannel()}var m=this.lag;var g,c,h;if(m.isStatic()){g=m.getValue();h=Math.exp(f/(g*r))}else{c=m.getChannel()}var o=this.lastValue;var a=d.length;for(var k=0;k<a;k++){if(b){q=b[k];h=Math.exp(f/(g*r))}if(c){g=c[k]}var e=((1-h)*q)+(h*o);j[k]=e;o=e}this.lastValue=o};Lag.prototype.toString=function(){return"Lag"};
/*!
 * @depends ../core/AudioletGroup.js
 */
var Limiter=function(c,b,d,a){AudioletNode.call(this,c,4,1);this.linkNumberOfOutputChannels(0,0);this.threshold=new AudioletParameter(this,1,b||0.95);this.attack=new AudioletParameter(this,2,d||0.01);this.release=new AudioletParameter(this,2,a||0.4);this.followers=[]};extend(Limiter,AudioletNode);Limiter.prototype.generate=function(b,m){var t=b[0];var A=m[0];if(t.isEmpty){A.isEmpty=true;return}var e=this.followers;var g=e.length;var a=this.audiolet.device.sampleRate;var B=this.attack;var w,q;if(B.isStatic()){w=Math.pow(0.01,1/(B.getValue()*a))}else{q=B.getChannel()}var x=this.release;var y,r;if(x.isStatic()){y=Math.pow(0.01,1/(x.getValue()*a))}else{r=x.getChannel()}var z=this.threshold;var f,l;if(z.isStatic()){f=z.getValue()}else{l=z.getChannel()}var d=t.numberOfChannels;for(var v=0;v<d;v++){if(v>=g){e.push(0)}var n=e[v];var h=t.getChannelData(v);var p=A.getChannelData(v);var k=t.length;for(var u=0;u<k;u++){var s=h[u];if(q){w=Math.pow(0.01,1/(q[u]*a))}if(r){y=Math.pow(0.01,1/(r[u]*a))}if(l){f=l[u]}var c=Math.abs(s);if(c>n){n=w*(n-c)+c}else{n=y*(n-c)+c}var o=n-f;if(o>0){p[u]=s/(1+o)}else{p[u]=s}}e[v]=n}};Limiter.prototype.toString=function(){return"Limiter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var LinearCrossFade=function(b,a){AudioletNode.call(this,b,3,1);this.linkNumberOfOutputChannels(0,0);this.position=new AudioletParameter(this,2,a||0.5)};extend(LinearCrossFade,AudioletNode);LinearCrossFade.prototype.generate=function(d,n){var h=d[0];var g=d[1];var u=n[0];var b=h.channels;var a=g.channels;var o=u.channels;if(h.isEmpty||g.isEmpty){u.isEmpty=true;return}var q=this.position;var v,s;if(q.isStatic()){v=q.getValue()}else{s=q.getChannel()}var m=u.length;for(var t=0;t<m;t++){if(s){v=s[t]}var e=1-v;var c=v;var f=h.numberOfChannels;for(var r=0;r<f;r++){var l=b[r];var k=a[r];var p=o[r];p[t]=l[t]*e+k[t]*c}}};LinearCrossFade.prototype.toString=function(){return"Linear Cross Fader"};
/*!
 * @depends BiquadFilter.js
 */
var LowPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(LowPassFilter,BiquadFilter);LowPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1-a)/2;this.b1=1-a;this.b2=this.b0;this.a0=1+d;this.a1=-2*a;this.a2=1-d};LowPassFilter.prototype.toString=function(){return"Low Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Pan=function(a,b){AudioletNode.call(this,a,2,1);this.setNumberOfOutputChannels(0,2);if(b==null){var b=0.5}this.pan=new AudioletParameter(this,1,b)};extend(Pan,AudioletNode);Pan.prototype.generate=function(j,l){var k=j[0];var e=l[0];if(k.isEmpty){e.isEmpty=true;return}var b=k.getChannelData(0);var f=e.getChannelData(0);var d=e.getChannelData(1);var c=this.pan;var o,h;if(c.isStatic()){o=c.getValue()}else{h=c.getChannel()}var a=e.length;for(var g=0;g<a;g++){if(h){o=h[g]}var n=o*Math.PI/2;var m=b[g];f[g]=m*Math.cos(n);d[g]=m*Math.sin(n)}};Pan.prototype.toString=function(){return"Stereo Panner"};
/*!
 * @depends Envelope.js
 */
var PercussiveEnvelope=function(b,c,g,a,e){var d=[0,1,0];var f=[g,a];Envelope.call(this,b,c,d,f,null,e)};extend(PercussiveEnvelope,Envelope);PercussiveEnvelope.prototype.toString=function(){return"Percussive Envelope"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Pulse=function(a,b,c){AudioletNode.call(this,a,2,1);this.frequency=new AudioletParameter(this,0,b||440);this.pulseWidth=new AudioletParameter(this,1,c||0.5);this.phase=0};extend(Pulse,AudioletNode);Pulse.prototype.generate=function(b,d){var e=this.pulseWidth.getValue();this.outputs[0].samples[0]=(this.phase<e)?1:-1;var c=this.frequency.getValue();var a=this.audiolet.device.sampleRate;this.phase+=c/a;if(this.phase>1){this.phase%=1}};Pulse.prototype.toString=function(){return"Pulse"};
/*!
 * @depends ../core/AudioletNode.js
 * @depends ../core/AudioletGroup.js
 */
var ReverbB=function(c,f,a,b){AudioletGroup.call(this,c,4,1);this.initialMix=0.33;this.fixedGain=0.015;this.initialDamping=0.5;this.scaleDamping=0.4;this.initialRoomSize=0.5;this.scaleRoom=0.28;this.offsetRoom=0.7;this.combTuning=[1116,1188,1277,1356,1422,1491,1557,1617];this.allPassTuning=[556,441,341,225];var a=a||this.initialRoomSize;this.roomSizeNode=new ParameterNode(c,a);this.roomSizeMulAdd=new MulAdd(c,this.scaleRoom,this.offsetRoom);var b=b||this.initialDamping;this.dampingNode=new ParameterNode(c,b);this.dampingMulAdd=new MulAdd(c,this.scaleDamping);this.roomSize=this.roomSizeNode.parameter;this.damping=this.dampingNode.parameter;this.gain=new Gain(c,this.fixedGain);this.combFilters=[];this.fgConverters=[];for(var e=0;e<this.combTuning.length;e++){var h=this.combTuning[e]/this.audiolet.device.sampleRate;this.combFilters[e]=new DampedCombFilter(c,h,h);this.fgConverters[e]=new FeedbackGainToDecayTime(c,h)}this.allPassFilters=[];for(var e=0;e<this.allPassTuning.length;e++){this.allPassFilters[e]=new AllPassFilter(c,this.allPassTuning[e])}var f=f||this.initialMix;this.mixer=new LinearCrossFade(c,f);this.mix=this.mixer.position;this.inputs[1].connect(this.mixer,0,2);this.inputs[2].connect(this.roomSizeNode);this.roomSizeNode.connect(this.roomSizeMulAdd);this.inputs[3].connect(this.dampingNode);this.dampingNode.connect(this.dampingMulAdd);this.inputs[0].connect(this.gain);for(var e=0;e<this.combFilters.length;e++){this.gain.connect(this.combFilters[e]);this.combFilters[e].connect(this.allPassFilters[0]);this.roomSizeMulAdd.connect(this.fgConverters[e]);this.fgConverters[e].connect(this.combFilters[e],0,2);this.dampingMulAdd.connect(this.combFilters[e],0,3)}var d=this.allPassFilters.length;for(var e=0;e<d-1;e++){this.allPassFilters[e].connect(this.allPassFilters[e+1])}this.inputs[0].connect(this.mixer);var g=d-1;this.allPassFilters[g].connect(this.mixer,0,1);this.mixer.connect(this.outputs[0])};extend(ReverbB,AudioletGroup);ReverbB.prototype.toString=function(){return"Reverb B"};var FeedbackGainToDecayTime=function(a,b){AudioletNode.call(this,a,1,1);this.delayTime=b;this.lastFeedbackGain=null;this.decayTime=null};extend(FeedbackGainToDecayTime,AudioletNode);FeedbackGainToDecayTime.prototype.generate=function(h,k){var j=h[0];var d=k[0];var c=j.channels[0];var e=d.channels[0];var g=this.lastDelayTime;var l=this.decayTime;var m=this.lastFeedbackGain;var b=d.length;for(var f=0;f<b;f++){var a=c[f];if(a!=m){l=-3*g/Math.log(a);m=a}e[f]=a}this.decayTime=l;this.lastFeedbackGain=m};
/*!
 * @depends ../core/AudioletNode.js
 * @depends ../core/AudioletGroup.js
 */
var Reverb=function(d,g,a,c){AudioletNode.call(this,d,4,1);this.initialMix=0.33;this.fixedGain=0.015;this.initialDamping=0.5;this.scaleDamping=0.4;this.initialRoomSize=0.5;this.scaleRoom=0.28;this.offsetRoom=0.7;this.combTuning=[1116,1188,1277,1356,1422,1491,1557,1617];this.allPassTuning=[556,441,341,225];var g=g||this.initialMix;this.mix=new AudioletParameter(this,1,g);var a=a||this.initialRoomSize;this.roomSize=new AudioletParameter(this,2,a);var c=c||this.initialDamping;this.damping=new AudioletParameter(this,3,c);this.combBuffers=[];this.combIndices=[];this.filterStores=[];var b=this.combTuning.length;for(var f=0;f<b;f++){this.combBuffers.push(new Float32Array(this.combTuning[f]));this.combIndices.push(0);this.filterStores.push(0)}this.allPassBuffers=[];this.allPassIndices=[];var e=this.allPassTuning.length;for(var f=0;f<e;f++){this.allPassBuffers.push(new Float32Array(this.allPassTuning[f]));this.allPassIndices.push(0)}};extend(Reverb,AudioletNode);Reverb.prototype.generate=function(d,k){var n=this.mix.getValue();var o=this.roomSize.getValue();var e=this.damping.getValue();var a=this.combTuning.length;var u=this.allPassTuning.length;var s=this.inputs[0].samples[0];var l=s;s*=this.fixedGain;var c=s;var e=e*this.scaleDamping;var f=o*this.scaleRoom+this.offsetRoom;for(var t=0;t<a;t++){var q=this.combIndices[t];var r=this.combBuffers[t];var p=this.filterStores[t];var j=r[q];p=(j*(1-e))+(p*e);s+=j;r[q]=c+f*p;q+=1;if(q>=r.length){q=0}this.combIndices[t]=q;this.filterStores[t]=p}for(var t=0;t<u;t++){var b=this.allPassBuffers[t];var h=this.allPassIndices[t];var m=s;var g=b[h];s=-s+g;b[h]=m+(g*0.5);h+=1;if(h>=b.length){h=0}this.allPassIndices[t]=h}this.outputs[0].samples[0]=n*s+(1-n)*l};Reverb.prototype.toString=function(){return"Reverb"};
/*!
 * @depends TableLookupOscillator.js
 */
var Saw=function(a,b){TableLookupOscillator.call(this,a,Saw.TABLE,b)};extend(Saw,TableLookupOscillator);Saw.prototype.toString=function(){return"Saw"};Saw.TABLE=[];for(var i=0;i<8192;i++){Saw.TABLE.push(((((i-4096)/8192)%1)+1)%1*2-1)}
/*!
 * @depends ../core/AudioletNode.js
 */
var SoftClip=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(SoftClip,AudioletNode);SoftClip.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){var m=b[d];if(m>0.5){e[d]=(m-0.25)/m}else{if(m<-0.5){e[d]=(-m-0.25)/m}else{e[d]=m}}}}};SoftClip.prototype.toString=function(){return("SoftClip")};
/*!
 * @depends TableLookupOscillator.js
 */
var Square=function(a,b){TableLookupOscillator.call(this,a,Square.TABLE,b)};extend(Square,TableLookupOscillator);Square.prototype.toString=function(){return"Square"};Square.TABLE=[];for(var i=0;i<8192;i++){Square.TABLE.push(((i-4096)/8192)<0?1:-1)}
/*!
 * @depends TableLookupOscillator.js
 */
var Triangle=function(a,b){TableLookupOscillator.call(this,a,Triangle.TABLE,b)};extend(Triangle,TableLookupOscillator);Triangle.prototype.toString=function(){return"Triangle"};Triangle.TABLE=[];for(var i=0;i<8192;i++){Triangle.TABLE.push(Math.abs(((((i-2048)/8192)%1)+1)%1*2-1)*2-1)}
/*!
 * @depends ../core/AudioletNode.js
 */
var TriggerControl=function(b,a){AudioletNode.call(this,b,0,1);this.trigger=new AudioletParameter(this,null,a||0)};extend(TriggerControl,AudioletNode);TriggerControl.prototype.generate=function(a,b){if(this.trigger.getValue()>0){this.outputs[0].samples[0]=1;this.trigger.setValue(0)}else{this.outputs[0].samples[0]=0}};TriggerControl.prototype.toString=function(){return"Trigger Control"};
/*!
 * @depends ../core/AudioletNode.js
 */
var UpMixer=function(a,b){AudioletNode.call(this,a,1,1);this.outputs[0].numberOfChannels=b};extend(UpMixer,AudioletNode);UpMixer.prototype.generate=function(){var c=this.inputs[0];var b=this.outputs[0];var e=c.samples.length;var a=b.samples.length;if(e==a){b.samples=c.samples}else{for(var d=0;d<a;d++){b.samples[d]=c.samples[d%e]}}};UpMixer.prototype.toString=function(){return"UpMixer"};var WebKitBufferPlayer=function(b,a){AudioletNode.call(this,b,0,1);this.isWebKit=this.audiolet.device.sink instanceof Sink.sinks.webkit;this.context=this.audiolet.device.sink._context;if(this.isWebKit){this.xhr=new XMLHttpRequest();this.xhr.open("GET",a,true);this.xhr.responseType="arraybuffer";this.xhr.onload=this.onLoad.bind(this);this.xhr.send()}this.ready=false};extend(WebKitBufferPlayer,AudioletNode);WebKitBufferPlayer.prototype.onLoad=function(){this.fileBuffer=this.context.createBuffer(this.xhr.response,false);this.setNumberOfOutputChannels(0,this.fileBuffer.numberOfChannels);this.jsNode=this.context.createJavaScriptNode(4096,this.fileBuffer.numberOfChannels,0);this.jsNode.onaudioprocess=this.onData.bind(this);this.source=this.context.createBufferSource();this.source.buffer=this.fileBuffer;this.source.connect(this.jsNode);this.jsNode.connect(this.context.destination);this.source.noteOn(0);this.buffer=new AudioletBuffer(this.fileBuffer.numberOfChannels,1024);this.ready=true};WebKitBufferPlayer.prototype.onData=function(g){var e=this.buffer.length;var h=e+g.inputBuffer.length;this.buffer.resize(this.buffer.numberOfChannels,h);for(var b=0;b<g.inputBuffer.numberOfChannels;b++){var f=g.inputBuffer.getChannelData(b);var d=this.buffer.getChannelData(b);var c=g.inputBuffer.length;for(var a=0;a<g.inputBuffer.length;a++){d[e+a]=f[a]}}};WebKitBufferPlayer.prototype.generate=function(b,c){var a=c[0];if(!this.ready){a.isEmpty=true;return}if(this.buffer.length>a.length){this.buffer.shift(a)}else{a.isEmpty=true}};
/*!
 * @depends ../core/AudioletNode.js
 */
var WhiteNoise=function(a){AudioletNode.call(this,a,0,1)};extend(WhiteNoise,AudioletNode);WhiteNoise.prototype.generate=function(d,f){var a=f[0];var e=a.getChannelData(0);var c=a.length;for(var b=0;b<c;b++){e[b]=Math.random()*2-1}};WhiteNoise.prototype.toString=function(){return"White Noise"};var Pattern=function(){};Pattern.prototype.next=function(){return null};Pattern.prototype.valueOf=function(a){if(a instanceof Pattern){return(a.next())}else{return(a)}};Pattern.prototype.reset=function(){};
/*!
 * @depends Pattern.js
 */
var PArithmetic=function(c,b,a){Pattern.call(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0};extend(PArithmetic,Pattern);PArithmetic.prototype.next=function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value+=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)};PArithmetic.prototype.reset=function(){this.value=this.start;this.position=0;if(this.step instanceof Pattern){this.step.reset()}};var Pseries=PArithmetic;
/*!
 * @depends Pattern.js
 */
var PChoose=function(b,a){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0};extend(PChoose,Pattern);PChoose.prototype.next=function(){var b;if(this.position<this.repeats){var a=Math.floor(Math.random()*this.list.length);var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PChoose.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Prand=PChoose;
/*!
 * @depends Pattern.js
 */
var PGeometric=function(c,b,a){Pattern.call(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0};extend(PGeometric,Pattern);PGeometric.prototype.next=function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value*=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)};PGeometric.prototype.reset=function(){this.value=this.start;this.position=0;if(this.step instanceof Pattern){this.step.reset()}};var Pgeom=PGeometric;
/*!
 * @depends Pattern.js
 */
var PProxy=function(a){Pattern.call(this);if(a){this.pattern=a}};extend(PProxy,Pattern);PProxy.prototype.next=function(){var a;if(this.pattern){var a=this.pattern.next()}else{a=null}return a};var Pp=PProxy;
/*!
 * @depends Pattern.js
 */
var PRandom=function(a,c,b){Pattern.call(this);this.low=a;this.high=c;this.repeats=b;this.position=0};extend(PRandom,Pattern);PRandom.prototype.next=function(){var b;if(this.position<this.repeats){var a=this.valueOf(this.low);var c=this.valueOf(this.high);if(a!=null&&c!=null){b=a+Math.random()*(c-a);this.position+=1}else{b=null}}else{b=null}return(b)};PRandom.prototype.reset=function(){this.position=0};var Pwhite=PRandom;
/*!
 * @depends Pattern.js
 */
var PSequence=function(b,a,c){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0};extend(PSequence,Pattern);PSequence.prototype.next=function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PSequence.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Pseq=PSequence;
/*!
 * @depends Pattern.js
 */
var PSeries=function(b,a,c){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0};extend(PSeries,Pattern);PSeries.prototype.next=function(){var b;if(this.position<this.repeats){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PSeries.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Pser=PSeries;
/*!
 * @depends Pattern.js
 */
var PShuffle=function(d,a){Pattern.call(this);this.list=[];while(d.length){var b=Math.floor(Math.random()*d.length);var c=d.splice(b,1);this.list.push(c)}this.repeats=a;this.position=0};extend(PShuffle,Pattern);PShuffle.prototype.next=function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};var Pshuffle=PShuffle;var Scale=function(b,a){this.degrees=b;this.tuning=a||new EqualTemperamentTuning(12)};Scale.prototype.getFrequency=function(d,a,b){var c=a;b+=Math.floor(d/this.degrees.length);d%=this.degrees.length;c*=Math.pow(this.tuning.octaveRatio,b);c*=this.tuning.ratios[this.degrees[d]];return c};
/*!
 * @depends Scale.js
 */
var MajorScale=function(){Scale.call(this,[0,2,4,5,7,9,11])};extend(MajorScale,Scale);
/*!
 * @depends Scale.js
 */
var MinorScale=function(){Scale.call(this,[0,2,3,5,7,8,10])};extend(MinorScale,Scale);var Tuning=function(d,c){this.semitones=d;this.octaveRatio=c||2;this.ratios=[];var b=this.semitones.length;for(var a=0;a<b;a++){this.ratios.push(Math.pow(2,this.semitones[a]/b))}};
/*!
 * @depends Tuning.js
 */
var EqualTemperamentTuning=function(b){var c=[];for(var a=0;a<b;a++){c.push(a)}Tuning.call(this,c,2)};extend(EqualTemperamentTuning,Tuning);var Sink=this.Sink=(function(d){function c(j,h,l,g){var e=c.sinks,f;for(f in e){if(e.hasOwnProperty(f)&&e[f].enabled){try{return new e[f](j,h,l,g)}catch(k){}}}throw c.Error(2)}function b(){}c.SinkClass=b;b.prototype=c.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,channelMode:"interleaved",start:function(g,f,h,e){this.channelCount=isNaN(f)||f===null?this.channelCount:f;this.bufferSize=isNaN(h)||h===null?this.bufferSize:h;this.sampleRate=isNaN(e)||e===null?this.sampleRate:e;this.readFn=g;this.activeRecordings=[];this.previousHit=+new Date;c.EventEmitter.call(this);c.emit("init",[this].concat([].slice.call(arguments)))},process:function(g,h){this.emit("preprocess",arguments);this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);if(this.channelMode==="interleaved"){this.emit("audioprocess",arguments);this.readFn&&this.readFn.apply(this,arguments)}else{var e=c.deinterleave(g,this.channelCount),f=[e].concat([].slice.call(arguments,1));this.emit("audioprocess",f);this.readFn&&this.readFn.apply(this,f);c.interleave(e,this.channelCount,g)}this.emit("postprocess",arguments);this.previousHit=+new Date;this.writePosition+=g.length/h},getPlaybackTime:function(){return this.writePosition-this.bufferSize},};function a(h,g,e,f){e=e||g.prototype;g.prototype=new c.SinkClass();g.prototype.type=h;g.enabled=!f;for(f in e){if(e.hasOwnProperty(f)){g.prototype[f]=e[f]}}a[h]=g}c.sinks=c.devices=a;c.singleton=function(){var e=c.apply(null,arguments);c.singleton=function(){return e};return e};d.Sink=c;return c}(function(){return this}()));(function(a){function b(){var c;for(c in b.prototype){if(b.prototype.hasOwnProperty(c)){this[c]=b.prototype[c]}}this._listeners={}}b.prototype={_listeners:null,emit:function(d,c){if(this._listeners[d]){for(var e=0;e<this._listeners[d].length;e++){this._listeners[d][e].apply(this,c)}}return this},on:function(c,d){this._listeners[c]=this._listeners[c]||[];this._listeners[c].push(d);return this},off:function(c,e){if(this._listeners[c]){if(!e){delete this._listeners[c];return this}for(var d=0;d<this._listeners[c].length;d++){if(this._listeners[c][d]===e){this._listeners[c].splice(d--,1)}}this._listeners[c].length||delete this._listeners[c]}return this},};a.EventEmitter=b;b.call(a)}(this.Sink));(function(a){a.doInterval=function(f,d){var e,c;function b(g){if(a.inlineWorker.working&&!g){e=a.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+d+");");e.onmessage=function(){f()};c=function(){e.terminate()}}else{e=setInterval(f,d);c=function(){clearInterval(e)}}}a.inlineWorker.ready?b():a.inlineWorker.on("ready",function(){b()});return function(){if(!c){a.inlineWorker.ready||a.inlineWorker.on("ready",function(){c&&c()})}else{c()}}}}(this.Sink));(function(a){function b(d){if(!b.hasOwnProperty(d)){throw b(1)}if(!(this instanceof b)){return new b(d)}var c;for(c in b[d]){if(b[d].hasOwnProperty(c)){this[c]=b[d][c]}}this.code=d}b.prototype=new Error();b.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message};b[1]={message:"No such error code.",explanation:"The error code does not exist.",};b[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser.",};b[16]={message:"Buffer underflow.",explanation:"Trying to recover...",};b[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway.",};b[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate.",};a.Error=b}(this.Sink));(function(c){var d=typeof window==="undefined"?undefined:window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,b=typeof window==="undefined"?undefined:(window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL);function a(f){var k=null,g,j;try{j=new d();j.append(f);g=b.createObjectURL(j.getBlob());k=new Worker(g);k._terminate=k.terminate;k._url=g;j=null;k.terminate=function(){this._terminate;b.revokeObjectURL(this._url)};a.type="blob";return k}catch(h){}try{k=new Worker("data:text/javascript;base64,"+btoa(f));a.type="data";return k}catch(h){}return k}a.ready=a.working=false;c.EventEmitter.call(a);a.test=function(){var g=a("this.onmessage=function (e){postMessage(e.data)}"),f="inlineWorker";a.ready=a.working=false;function e(h){if(a.ready){return}a.ready=true;a.working=h;a.emit("ready",[h]);a.off("ready");h&&g&&g.terminate();g=null}if(!g){e(false)}else{g.onmessage=function(h){e(h.data===f)};g.postMessage(f);setTimeout(function(){e(false)},1000)}};c.inlineWorker=a;a.test()}(this.Sink));(function(a){a.sinks("audiodata",function(){var m=this,d=0,k=null,j=new Audio(),h,g,e,f,l,b;m.start.apply(m,arguments);m.preBufferSize=isNaN(arguments[4])||arguments[4]===null?this.preBufferSize:arguments[4];function c(){if(k){h=j.mozWriteAudio(k);d+=h;if(h<k.length){k=k.subarray(h);return k}k=null}g=j.mozCurrentSampleOffset();e=Number(g+(l!==g?m.bufferSize:m.preBufferSize)*m.channelCount-d);g===l&&m.emit("error",[a.Error(16)]);if(e>0||l===g){try{f=new Float32Array(l===g?m.preBufferSize*m.channelCount:m.forceBufferSize?e<m.bufferSize*2?m.bufferSize*2:e:e)}catch(n){m.emit("error",[a.Error(18)]);m.kill();return}m.process(f,m.channelCount);h=m._audio.mozWriteAudio(f);if(h<f.length){k=f.subarray(h)}d+=h}l=g}j.mozSetup(m.channelCount,m.sampleRate);this._timers=[];this._timers.push(a.doInterval(function(){if(+new Date-m.previousHit>2000){m._audio=j=new Audio();j.mozSetup(m.channelCount,m.sampleRate);d=0;m.emit("error",[a.Error(17)])}},1000));this._timers.push(a.doInterval(c,m.interval));m._bufferFill=c;m._audio=j},{bufferSize:24576,preBufferSize:24576,forceBufferSize:false,interval:20,kill:function(){while(this._timers.length){this._timers[0]();this._timers.splice(0,1)}this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount},});a.sinks.moz=a.sinks.audiodata}(this.Sink));(function(a){a.sinks("dummy",function(){var b=this;b.start.apply(b,arguments);function c(){var d=new Float32Array(b.bufferSize*b.channelCount);b.process(d,b.channelCount)}b._kill=a.doInterval(c,b.bufferSize/b.sampleRate*1000);b._callback=c},{kill:function(){this._kill();this.emit("kill")},},true)}(this.Sink));(function(b,a){var a=b.sinks;function d(f){var e=document.createElement("audio");if(f){e.src=f}return e}a("wav",function(){var e=this,j=new a.wav.wavAudio,k=typeof k==="undefined"?audioLib.PCMData:k;e.start.apply(e,arguments);var g=new Float32Array(e.bufferSize*e.channelCount),h=new Float32Array(e.bufferSize*e.channelCount);if(!d().canPlayType("audio/wav; codecs=1")||!btoa){throw 0}function f(){if(e._audio.hasNextFrame){return}b.memcpy(h,0,g,0);e.process(g,e.channelCount);e._audio.setSource("data:audio/wav;base64,"+btoa(audioLib.PCMData.encode({data:g,sampleRate:e.sampleRate,channelCount:e.channelCount,bytesPerSample:e.quality,})));if(!e._audio.currentFrame.src){e._audio.nextClip()}}e.kill=b.doInterval(f,40);e._bufferFill=f;e._audio=j},{quality:1,bufferSize:22050,getPlaybackTime:function(){var e=this._audio;return(e.currentFrame?e.currentFrame.currentTime*this.sampleRate:0)+e.samples},});function c(){var e=this;e.currentFrame=d();e.nextFrame=d();e._onended=function(){e.samples+=e.bufferSize;e.nextClip()}}c.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:false,nextClip:function(){var e=this.currentFrame;this.currentFrame=this.nextFrame;this.nextFrame=e;this.hasNextFrame=false;this.currentFrame.play()},setSource:function(e){this.nextFrame.src=e;this.nextFrame.addEventListener("ended",this._onended,true);this.hasNextFrame=true},};a.wav.wavAudio=c}(this.Sink));(function(a,b){a("webaudio",function(k,j,f,l){var m=this,c=a.webaudio.getContext(),h=c.createJavaScriptNode(f,0,j),g=null,e=null;m.start.apply(m,arguments);function d(v){var o=v.outputBuffer,q=o.numberOfChannels,s,p,r=o.length,w=o.size,t=new Array(q),u;g=g&&g.length===r*q?g:new Float32Array(r*q);e=e&&e.length===g.length?e:new Float32Array(r*q);g.set(e);for(s=0;s<q;s++){t[s]=o.getChannelData(s)}m.process(g,m.channelCount);for(s=0;s<r;s++){for(p=0;p<q;p++){t[p][s]=g[s*m.channelCount+p]}}}m.sampleRate=c.sampleRate;h.onaudioprocess=d;h.connect(c.destination);m._context=c;m._node=h;m._callback=d;b.push(h)},{kill:function(){this._node.disconnect(0);for(var c=0;c<b.length;c++){b[c]===this._node&&b.splice(c--,1)}this._node=this._context=null;this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate},});a.webkit=a.webaudio;a.webaudio.fix82795=b;a.webaudio.getContext=function(){var c=new (window.AudioContext||webkitAudioContext)();a.webaudio.getContext=function(){return c};return c}}(this.Sink.sinks,[]));(function(a){a.sinks("worker",function(){var b=this,e=(function(){return this}()),c=null,h=null,d=null;b.start.apply(b,arguments);importScripts();function f(o){b.ready||b.initMSP(o);var m=b.channelCount,j=o.audioLength,p,k;c=c&&c.length===j*m?c:new Float32Array(j*m);h=h&&h.length===c.length?h:new Float32Array(j*m);d=d&&d.length===c.length?d:new Float32Array(j*m);c.set(d);h.set(d);b.process(c,b.channelCount);for(p=0;p<m;p++){for(k=0;k<j;k++){h[p*o.audioLength+k]=c[p+k*m]}}o.writeAudio(h)}function g(s){b.ready||b.initWA(s);var j=s.outputBuffer,m=j.numberOfChannels,p,k,o=j.length,t=j.size,q=new Array(m),r;c=c&&c.length===o*m?c:new Float32Array(o*m);d=d&&d.length===c.length?d:new Float32Array(o*m);c.set(d);for(p=0;p<m;p++){q[p]=j.getChannelData(p)}b.process(c,b.channelCount);for(p=0;p<o;p++){for(k=0;k<m;k++){q[k][p]=c[p*b.channelCount+k]}}}e.onprocessmedia=f;e.onaudioprocess=g;b._mspBufferFill=f;b._waBufferFill=g},{ready:false,initMSP:function(b){this.channelCount=b.audioChannels;this.sampleRate=b.audioSampleRate;this.bufferSize=b.audioLength*this.channelCount;this.ready=true;this.emit("ready",[])},initWA:function(d){var c=d.outputBuffer;this.channelCount=c.numberOfChannels;this.sampleRate=c.sampleRate;this.bufferSize=c.length*this.channelCount;this.ready=true;this.emit("ready",[])},})}(this.Sink));(function(a){a.deinterleave=function(c,g){var b=c.length,f=b/g,d=[],e,h;for(e=0;e<g;e++){d[e]=new Float32Array(f);for(h=0;h<f;h++){d[e][h]=c[h*g+e]}}return d};a.interleave=function(d,g,c){g=g||d.length;var b=d[0].length,f=d.length,e,h;c=c||new Float32Array(b*g);for(e=0;e<f;e++){for(h=0;h<b;h++){c[e+h*g]=d[e][h]}}return c};a.mix=function(e){var d=[].slice.call(arguments,1),b,f,g;for(g=0;g<d.length;g++){b=Math.max(e.length,d[g].length);for(f=0;f<b;f++){e[f]+=d[g][f]}}return e};a.resetBuffer=function(c){var b=c.length,d;for(d=0;d<b;d++){c[d]=0}return c};a.clone=function(d,b){var c=d.length,e;b=b||new Float32Array(c);for(e=0;e<c;e++){b[e]=d[e]}return b};a.createDeinterleaved=function(e,d){var b=new Array(d),c;for(c=0;c<d;c++){b[c]=new Float32Array(e)}return b};a.memcpy=function(f,b,g,d,e){f=f.subarray||f.slice?f:f.buffer;g=g.subarray||g.slice?g:g.buffer;f=b?f.subarray?f.subarray(b,e&&b+e):f.slice(b,e&&b+e):f;if(g.set){g.set(f,d)}else{for(var c=0;c<f.length;c++){g[c+d]=f[c]}}return g};a.memslice=function(b,d,c){return b.subarray?b.subarray(d,c):b.slice(d,c)};a.mempad=function(b,c,d){c=c.length?c:new (b.constructor)(c);a.memcpy(b,0,c,d);return c};a.linspace=function(h,c,d){var b,e,g,f;d=d.length?(b=d.length)&&d:Array(b=d);f=(c-h)/--b;for(g=h+f,e=1;e<b;e++,g+=f){d[e]=g}d[0]=h;d[b]=c;return d};a.ftoi=function(d,f,c){var e,b=Math.pow(2,f-1);c=c||new (d.constructor)(d.length);for(e=0;e<d.length;e++){c[e]=~~(b*d[e])}return c}}(this.Sink));(function(a){function b(e,d){a.EventEmitter.call(this);this.bufferSize=isNaN(e)||e===null?this.bufferSize:e;this.channelCount=isNaN(d)||d===null?this.channelCount:d;var c=this;this.callback=function(){return c.process.apply(c,arguments)};this.resetBuffer()}b.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new Float32Array(this.bufferSize);this.zeroBuffer=new Float32Array(this.bufferSize)},process:function(c,e){this.offset===null&&this.loadBuffer();for(var d=0;d<c.length;d++){this.offset>=this.buffer.length&&this.loadBuffer();c[d]=this.buffer[this.offset++]}},loadBuffer:function(){this.offset=0;a.memcpy(this.zeroBuffer,0,this.buffer,0);this.emit("audioprocess",[this.buffer,this.channelCount])},};a.Proxy=b;a.prototype.createProxy=function(d){var c=new a.Proxy(d,this.channelCount);c.parentSink=this;this.on("audioprocess",c.callback);return c}}(this.Sink));(function(a){(function(){function b(c,d){if(c&&d){b[c]=d}else{if(c&&b[c] instanceof Function){a.interpolate=b[c]}}return b[c]}a.interpolation=b;b("linear",function(c,g){var f=Math.floor(g),e=f+1,d=g-f;e=e<c.length?e:0;return c[f]*(1-d)+c[e]*d});b("nearest",function(c,d){return d>=c.length-0.5?c[0]:c[Math.round(d)]});b("linear")}());a.resample=function(j,b,o,p,d){var h=arguments.length,f=h===2?b:h===3?b/o:p/b*d/o,g=j.length,c=Math.ceil(g/f),m=new Float32Array(c),k,e;for(k=0,e=0;k<g;k+=f){m[e++]=a.interpolate(j,k)}return m}}(this.Sink));(function(b){b.on("init",function(c){c.activeRecordings=[];c.on("postprocess",c.recordData)});b.prototype.activeRecordings=null;b.prototype.record=function(){var c=new b.Recording(this);this.emit("record",[c]);return c};b.prototype.recordData=function(d){var f=this.activeRecordings,e,c=f.length;for(e=0;e<c;e++){f[e].add(d)}};function a(c){this.boundTo=c;this.buffers=[];c.activeRecordings.push(this)}a.prototype={add:function(c){this.buffers.push(c)},clear:function(){this.buffers=[]},stop:function(){var c=this.boundTo.activeRecordings,d;for(d=0;d<c.length;d++){if(c[d]===this){c.splice(d--,1)}}},join:function(){var g=0,h=0,e=this.buffers,c,j,f,d=e.length;for(f=0;f<d;f++){g+=e[f].length}c=new Float32Array(g);for(f=0;f<d;f++){for(j=0;j<e[f].length;j++){c[h+j]=e[f][j]}h+=e[f].length}return c},};b.Recording=a}(this.Sink));(function(b){function a(){this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}b.on("init",function(c){c.on("preprocess",a)});b.prototype.ringBuffer=null;b.prototype.ringSpin=function(e){var f=this.ringBuffer,d=e.length,c=f.length,h=this.ringOffset,g;for(g=0;g<d;g++){e[g]+=f[h];h=(h+1)%c}this.ringOffset=h};b.prototype.ringSpinDeinterleaved=function(j){var h=this.ringBuffer,g=j.length,c=h.length,f=h[0].length,o=c*f,e=this.ringOffset,k,d;for(k=0;k<g;k+=c){for(d=0;d<c;d++){j[k+d]+=h[d][e]}e=(e+1)%f}this.ringOffset=d}}(this.Sink));(function(a,b){b=a.prototype;a.on("init",function(c){c.asyncBuffers=[];c.syncBuffers=[];c.on("preprocess",c.writeBuffersSync);c.on("postprocess",c.writeBuffersAsync)});b.writeMode="async";b.asyncBuffers=b.syncBuffers=null;b.writeBuffersAsync=function(e){var d=this.asyncBuffers,c=e.length,f,h,g,k,j;if(d){for(g=0;g<d.length;g++){f=d[g];h=f.b.length;j=f.d;f.d-=Math.min(j,c);for(k=0;k+j<c&&k<h;k++){e[k+j]+=f.b[k]}f.b=f.b.subarray(k+j);g>=h&&d.splice(g--,1)}}};b.writeBuffersSync=function(e){var d=this.syncBuffers,c=e.length,f=0,g=0;for(;f<c&&d.length;f++){e[f]+=d[0][g];if(d[0].length<=g){d.splice(0,1);g=0;continue}g++}if(d.length){d[0]=d[0].subarray(g)}};b.writeBufferAsync=function(d,e){d=this.mode==="deinterleaved"?a.interleave(d,this.channelCount):d;var c=this.asyncBuffers;c.push({b:d,d:isNaN(e)?~~((+new Date-this.previousHit)/1000*this.sampleRate):e});return c.length};b.writeBufferSync=function(d){d=this.mode==="deinterleaved"?a.interleave(d,this.channelCount):d;var c=this.syncBuffers;c.push(d);return c.length};b.writeBuffer=function(){return this[this.writeMode==="async"?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)};b.getSyncWriteOffset=function(){var c=this.syncBuffers,e=0,d;for(d=0;d<c.length;d++){e+=c[d].length}return e}}(this.Sink));