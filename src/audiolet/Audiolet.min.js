var AudioletBuffer=function(a,c){this.numberOfChannels=a;this.length=c;this.channels=[];for(var b=0;b<this.numberOfChannels;b++){this.channels.push(new Float32Array(c))}this.unslicedChannels=[];for(var b=0;b<this.numberOfChannels;b++){this.unslicedChannels.push(this.channels[b])}this.isEmpty=false;this.channelOffset=0};AudioletBuffer.prototype.getChannelData=function(a){return(this.channels[a])};AudioletBuffer.prototype.set=function(a){var b=a.numberOfChannels;for(var c=0;c<b;c++){this.channels[c].set(a.getChannelData(c))}};AudioletBuffer.prototype.setSection=function(c,g,f,b){f=f||0;b=b||0;var d=c.numberOfChannels;for(var e=0;e<d;e++){f+=c.channelOffset;b+=this.channelOffset;var a=this.unslicedChannels[e].subarray(b,b+g);var h=c.unslicedChannels[e].subarray(f,f+g);
/*!
           var channel1 = this.getChannelData(i).subarray(outputOffset,
           outputOffset +
           length);
           var channel2 = buffer.getChannelData(i).subarray(inputOffset,
           inputOffset +
           length);
         */
a.set(h)}};AudioletBuffer.prototype.add=function(b){var f=this.length;var d=b.numberOfChannels;for(var e=0;e<d;e++){var a=this.getChannelData(e);var g=b.getChannelData(e);for(var c=0;c<f;c++){a[c]+=g[c]}}};AudioletBuffer.prototype.addSection=function(f,b,h,a){h=h||0;a=a||0;var k=f.numberOfChannels;for(var g=0;g<k;g++){var d=this.getChannelData(g);var c=f.getChannelData(g);for(var e=0;e<b;e++){d[e+a]+=c[e+h]}}};AudioletBuffer.prototype.resize=function(n,c,e,g){g=g||0;var j=this.channels;var b=this.unslicedChannels;var d=this.length;var f=this.channelOffset+g;for(var h=0;h<n;h++){var k=j[h];var m=b[h];if(c>d){var l=k;if(!e||!m||m.length<c){m=new Float32Array(c)}k=m.subarray(0,c);if(!e&&l){k.set(l,g)}f=0}else{if(!m){var a=b[0].length;m=new Float32Array(a)}g=f;k=m.subarray(g,g+c)}j[h]=k;b[h]=m}this.channels=j.slice(0,n);this.unslicedChannels=b.slice(0,n);this.length=c;this.numberOfChannels=n;this.channelOffset=f};AudioletBuffer.prototype.push=function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b);this.setSection(a,b,0,this.length-b)};AudioletBuffer.prototype.pop=function(a){var b=a.length;var c=this.length-b;a.setSection(this,b,c,0);this.resize(this.numberOfChannels,c)};AudioletBuffer.prototype.unshift=function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b,false,b);this.setSection(a,b,0,0)};AudioletBuffer.prototype.shift=function(a){var b=a.length;a.setSection(this,b,0,0);this.resize(this.numberOfChannels,this.length-b,false,b)};AudioletBuffer.prototype.zero=function(){var b=this.numberOfChannels;for(var c=0;c<b;c++){var e=this.getChannelData(c);var d=this.length;for(var a=0;a<d;a++){e[a]=0}}};AudioletBuffer.prototype.combined=function(){var a=this.channels;var b=this.numberOfChannels;var e=this.length;var d=new Float32Array(b*e);for(var c=0;c<b;c++){d.set(a[c],c*e)}return d};AudioletBuffer.prototype.interleaved=function(){var a=this.channels;var c=this.numberOfChannels;var e=this.length;var f=new Float32Array(c*e);for(var d=0;d<e;d++){for(var b=0;b<c;b++){f[c*d+b]=a[b][d]}}return f};AudioletBuffer.prototype.copy=function(){var a=new AudioletBuffer(this.numberOfChannels,this.length);a.set(this);return a};AudioletBuffer.prototype.load=function(c,a,d){var b=new AudioFileRequest(c,a);b.onSuccess=function(e){this.length=e.length;this.numberOfChannels=e.channels.length;this.unslicedChannels=e.channels;this.channels=e.channels;this.channelOffset=0;if(d){d()}}.bind(this);b.onFailure=function(){console.error("Could not load",c)}.bind(this);b.send()};var AudioletGroup=function(b,a,d){this.audiolet=b;this.inputs=[];for(var c=0;c<a;c++){this.inputs.push(new PassThroughNode(this.audiolet,1,1))}this.outputs=[];for(var c=0;c<d;c++){this.outputs.push(new PassThroughNode(this.audiolet,1,1))}};AudioletGroup.prototype.connect=function(c,b,a){this.outputs[b||0].connect(c,0,a)};AudioletGroup.prototype.disconnect=function(c,b,a){this.outputs[b||0].disconnect(c,0,a)};AudioletGroup.prototype.remove=function(){var a=this.inputs.length;for(var b=0;b<a;b++){this.inputs[b].remove()}var c=this.outputs.length;for(var b=0;b<c;b++){this.outputs[b].remove()}};
/*!
 * @depends AudioletGroup.js
 */
var AudioletDestination=function(c,b,a,d){AudioletGroup.call(this,c,1,0);this.device=new AudioletDevice(c,b,a,d);c.device=this.device;this.scheduler=new Scheduler(c);c.scheduler=this.scheduler;this.upMixer=new UpMixer(c,this.device.numberOfChannels);this.inputs[0].connect(this.scheduler);this.scheduler.connect(this.upMixer);this.upMixer.connect(this.device)};extend(AudioletDestination,AudioletGroup);AudioletDestination.prototype.toString=function(){return"Destination"};var AudioletNode=function(c,b,e,a){this.audiolet=c;this.inputs=[];for(var d=0;d<b;d++){this.inputs.push(new AudioletInput(this,d))}this.outputs=[];for(var d=0;d<e;d++){this.outputs.push(new AudioletOutput(this,d))}if(a){this.generate=a}this.timestamp=null};AudioletNode.prototype.connect=function(d,c,b){if(d instanceof AudioletGroup){d=d.inputs[b||0];b=0}var a=this.outputs[c||0];var e=d.inputs[b||0];a.connect(e);e.connect(a);this.audiolet.device.needTraverse=true};AudioletNode.prototype.disconnect=function(d,c,b){if(d instanceof AudioletGroup){d=d.inputs[b||0];b=0}var a=this.outputs[c||0];var e=d.inputs[b||0];e.disconnect(a);a.disconnect(e);this.audiolet.device.needTraverse=true};AudioletNode.prototype.setNumberOfOutputChannels=function(a,b){this.outputs[a].numberOfChannels=b};AudioletNode.prototype.linkNumberOfOutputChannels=function(b,a){this.outputs[b].linkNumberOfChannels(this.inputs[a])};AudioletNode.prototype.tick=function(){this.createInputSamples();this.createOutputSamples();this.generate()};AudioletNode.prototype.traverse=function(a){a=this.traverseParents(a);if(a.indexOf(this)==-1){a.push(this)}return a};AudioletNode.prototype.traverseParents=function(c){var a=this.inputs.length;for(var e=0;e<a;e++){var b=this.inputs[e];var f=b.connectedFrom.length;for(var d=0;d<f;d++){c=b.connectedFrom[d].node.traverse(c)}}return c};AudioletNode.prototype.generate=function(){};AudioletNode.prototype.createInputSamples=function(){var f=this.inputs.length;for(var e=0;e<f;e++){var l=this.inputs[e];var b=0;var h=l.connectedFrom;var g=h.length;for(var d=0;d<g;d++){var a=h[d];var m=a.samples.length;for(var c=0;c<m;c++){if(c<b){l.samples[c]+=a.samples[c]}else{l.samples[c]=a.samples[c];b+=1}}}if(l.samples.length>b){l.samples.splice(b,l.samples.length-b)}}};AudioletNode.prototype.createOutputSamples=function(){var e=this.outputs.length;for(var d=0;d<e;d++){var a=this.outputs[d];var c=a.getNumberOfChannels();for(var b=0;b<c;b++){a.samples[b]=0}if(a.samples.length>c){a.samples.splice(c,a.samples.length-c)}}};AudioletNode.prototype.remove=function(){var g=this.inputs.length;for(var e=0;e<g;e++){var h=this.inputs[e];var c=h.connectedFrom.length;for(var d=0;d<c;d++){var a=h.connectedFrom[d];var b=a.node;b.disconnect(this,a.index,e)}}var f=this.outputs.length;for(var e=0;e<f;e++){var b=this.outputs[e];var c=b.connectedTo.length;for(var d=0;d<c;d++){var k=b.connectedTo[d];var h=k.node;this.disconnect(h,e,k.index)}}};
/*!
 * @depends AudioletNode.js
 */
function AudioletDevice(c,b,a,d){AudioletNode.call(this,c,1,0);this.sink=Sink(this.tick.bind(this),a,d,b);this.sampleRate=this.sink.sampleRate;this.numberOfChannels=this.sink.channelCount;this.bufferSize=this.sink.preBufferSize;this.writePosition=0;this.buffer=null;this.paused=false;this.needTraverse=true;this.nodes=[]}extend(AudioletDevice,AudioletNode);AudioletDevice.prototype.tick=function(a,d){if(!this.paused){var b=this.inputs[0];var f=a.length/d;for(var e=0;e<f;e++){if(this.needTraverse){this.nodes=this.traverse([]);this.needTraverse=false}for(var c=0;c<this.nodes.length-1;c++){this.nodes[c].tick()}AudioletNode.prototype.tick.call(this);for(var c=0;c<d;c++){a[e*d+c]=b.samples[c]}this.writePosition+=1}}};AudioletDevice.prototype.getPlaybackTime=function(){return this.sink.getPlaybackTime()};AudioletDevice.prototype.getWriteTime=function(){return this.writePosition};AudioletDevice.prototype.pause=function(){this.paused=true};AudioletDevice.prototype.play=function(){this.paused=false};AudioletDevice.prototype.toString=function(){return"Audio Output Device"};var AudioletInput=function(b,a){this.node=b;this.index=a;this.connectedFrom=[];this.samples=[]};AudioletInput.prototype.connect=function(a){this.connectedFrom.push(a)};AudioletInput.prototype.disconnect=function(a){var c=this.connectedFrom.length;for(var b=0;b<c;b++){if(a==this.connectedFrom[b]){this.connectedFrom.splice(b,1);break}}};AudioletInput.prototype.toString=function(){return this.node.toString()+"Input #"+this.index};var Audiolet=function(b,a,c){this.output=new AudioletDestination(this,b,a,c)};var AudioletOutput=function(b,a){this.node=b;this.index=a;this.connectedTo=[];this.samples=[];this.linkedInput=null;this.numberOfChannels=1};AudioletOutput.prototype.connect=function(a){this.connectedTo.push(a)};AudioletOutput.prototype.disconnect=function(a){var c=this.connectedTo.length;for(var b=0;b<c;b++){if(a==this.connectedTo[b]){this.connectedTo.splice(b,1);break}}};AudioletOutput.prototype.linkNumberOfChannels=function(a){this.linkedInput=a};AudioletOutput.prototype.unlinkNumberOfChannels=function(){this.linkedInput=null};AudioletOutput.prototype.getNumberOfChannels=function(){if(this.linkedInput&&this.linkedInput.connectedFrom.length){return(this.linkedInput.samples.length)}return(this.numberOfChannels)};AudioletOutput.prototype.toString=function(){return this.node.toString()+"Output #"+this.index+" - "};var AudioletParameter=function(a,c,b){this.node=a;if(typeof c!="undefined"&&c!=null){this.input=a.inputs[c]}else{this.input=null}this.value=b||0};AudioletParameter.prototype.isStatic=function(){return(this.input.samples.length==0)};AudioletParameter.prototype.isDynamic=function(){return(this.input.samples.length>0)};AudioletParameter.prototype.setValue=function(a){this.value=a};AudioletParameter.prototype.getValue=function(){if(this.input!=null&&this.input.samples.length>0){return this.input.samples[0]}else{return this.value}};function extend(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b();a.prototype.constructor=a}
/*!
 * @depends ../core/AudioletNode.js
 */
var ParameterNode=function(a,b){AudioletNode.call(this,a,1,1);this.parameter=new AudioletParameter(this,0,b)};extend(ParameterNode,AudioletNode);ParameterNode.prototype.generate=function(){output.samples[0]=this.parameter.getValue()};ParameterNode.prototype.toString=function(){return"Parameter Node"};
/*!
 * @depends AudioletNode.js
 */
var PassThroughNode=function(b,a,c){AudioletNode.call(this,b,a,c)};extend(PassThroughNode,AudioletNode);PassThroughNode.prototype.createOutputSamples=function(e){var f=this.outputs.length;var a=this.inputs.length;for(var d=0;d<f;d++){var c=this.outputs[d];if(d<a){var b=this.inputs[d];c.samples=b.samples}else{c.samples=new Array(c.getNumberOfChannels())}}};PassThroughNode.prototype.toString=function(){return"Pass Through Node"};var PriorityQueue=function(c,b){if(b){this.compare=b}if(c){this.heap=c;for(var a=0;a<Math.floor(this.heap.length/2);a++){this.siftUp(a)}}else{this.heap=[]}};PriorityQueue.prototype.push=function(a){this.heap.push(a);this.siftDown(0,this.heap.length-1)};PriorityQueue.prototype.pop=function(){var b,a;b=this.heap.pop();if(this.heap.length){var a=this.heap[0];this.heap[0]=b;this.siftUp(0)}else{a=b}return(a)};PriorityQueue.prototype.peek=function(){return(this.heap[0])};PriorityQueue.prototype.isEmpty=function(){return(this.heap.length==0)};PriorityQueue.prototype.siftDown=function(d,a){var b=this.heap[a];while(a>d){var e=(a-1)>>1;var c=this.heap[e];if(this.compare(b,c)){this.heap[a]=c;a=e;continue}break}this.heap[a]=b};PriorityQueue.prototype.siftUp=function(a){var e=this.heap.length;var d=a;var c=this.heap[a];var b=2*a+1;while(b<e){var f=b+1;if(f<e&&!this.compare(this.heap[b],this.heap[f])){b=f}this.heap[a]=this.heap[b];a=b;b=2*a+1}this.heap[a]=c;this.siftDown(d,a)};PriorityQueue.prototype.compare=function(d,c){return(d<c)};
/*!
 * @depends PassThroughNode.js
 */
var Scheduler=function(a,b){PassThroughNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0);this.bpm=b||120;this.queue=new PriorityQueue(null,function(d,c){return(d.time<c.time)});this.time=0;this.beat=0;this.beatInBar=0;this.bar=0;this.seconds=0;this.beatsPerBar=0;this.lastBeatTime=0;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate};extend(Scheduler,PassThroughNode);Scheduler.prototype.setTempo=function(a){this.bpm=a;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate};Scheduler.prototype.addRelative=function(a,c){var b={};b.callback=c;b.time=this.time+a*this.beatLength;this.queue.push(b);return b};Scheduler.prototype.addAbsolute=function(b,c){if(b<this.beat||b==this.beat&&this.time>this.lastBeatTime){return null}var a={};a.callback=c;a.time=this.lastBeatTime+(b-this.beat)*this.beatLength;this.queue.push(a);return a};Scheduler.prototype.play=function(b,a,d){var c={};c.patterns=b;c.durationPattern=a;c.callback=d;c.time=this.audiolet.device.getWriteTime();this.queue.push(c);return c};Scheduler.prototype.playAbsolute=function(d,b,a,e){if(d<this.beat||d==this.beat&&this.time>this.lastBeatTime){return null}var c={};c.patterns=b;c.durationPattern=a;c.callback=e;c.time=this.lastBeatTime+(d-this.beat)*this.beatLength;this.queue.push(c);return c};Scheduler.prototype.remove=function(b){var a=this.queue.heap.indexOf(b);if(a!=-1){this.queue.heap.splice(a,1);this.queue=new PriorityQueue(this.queue.heap,function(d,c){return(d.time<c.time)})}};Scheduler.prototype.stop=function(a){this.remove(a)};Scheduler.prototype.tick=function(){PassThroughNode.prototype.tick.call(this);this.tickClock();while(!this.queue.isEmpty()&&this.queue.peek().time<=this.time){var a=this.queue.pop();this.processEvent(a)}};Scheduler.prototype.tickClock=function(){this.time+=1;this.seconds=this.time*this.audiolet.device.sampleRate;if(this.time>=this.lastBeatTime+this.beatLength){this.beat+=1;this.beatInBar+=1;if(this.beatInBar==this.beatsPerBar){this.bar+=1;this.beatInBar=0}this.lastBeatTime+=this.beatLength}};Scheduler.prototype.processEvent=function(a){var h=a.durationPattern;if(h){var g=[];var b=a.patterns;var e=b.length;for(var d=0;d<e;d++){var f=b[d];var j=f.next();if(j!=null){g.push(j)}else{return}}a.callback.apply(null,g);var c;if(h instanceof Pattern){c=h.next()}else{c=h}if(c){a.time+=c*this.beatLength;this.queue.push(a)}}else{a.callback()}};Scheduler.prototype.toString=function(){return"Scheduler"};var Int8Array,Uint8Array,Int16Array,Uint16Array;var Int32Array,Uint32Array,Float32Array,Float64Array;var types=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];var original,shim;for(var i=0;i<types.length;++i){if(types[i]){if(types[i].prototype.slice===undefined){original="subarray";shim="slice"}else{if(types[i].prototype.subarray===undefined){original="slice";shim="subarray"}}Object.defineProperty(types[i].prototype,shim,{value:types[i].prototype[original],enumerable:false})}}
/*!
 * @depends ../core/AudioletNode.js
 */
var Add=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||0)};extend(Add,AudioletNode);Add.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]+o}}};Add.prototype.toString=function(){return"Add"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Divide=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Divide,AudioletNode);Divide.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]/o}}};Divide.prototype.toString=function(){return"Divide"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Modulo=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Modulo,AudioletNode);Modulo.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]%o}}};Modulo.prototype.toString=function(){return"Modulo"};
/*!
 * @depends ../core/AudioletNode.js
 */
var MulAdd=function(a,c,b){AudioletNode.call(this,a,3,1);this.linkNumberOfOutputChannels(0,0);this.mul=new AudioletParameter(this,1,c||1);this.add=new AudioletParameter(this,2,b||0)};extend(MulAdd,AudioletNode);MulAdd.prototype.generate=function(m,q){var n=m[0];var c=q[0];if(n.isEmpty){c.isEmpty=true;return}var f=this.mul;var e,d;if(f.isStatic()){e=f.getValue()}else{d=f.getChannel()}var p=this.add;var r,l;if(p.isStatic()){r=p.getValue()}else{l=p.getChannel()}var o=n.numberOfChannels;for(var k=0;k<o;k++){var b=n.getChannelData(k);var h=c.getChannelData(k);var a=n.length;for(var g=0;g<a;g++){if(d){e=d[g]}if(l){r=l[g]}h[g]=b[g]*e+r}}};MulAdd.prototype.toString=function(){return"Multiplier/Adder"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Multiply=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Multiply,AudioletNode);Multiply.prototype.generate=function(d,f){var e=this.value.getValue();var a=this.inputs[0];var b=a.samples.length;for(var c=0;c<b;c++){this.outputs[0].samples[c]=a.samples[c]*e}};Multiply.prototype.toString=function(){return"Multiply"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Reciprocal=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(Reciprocal,AudioletNode);Reciprocal.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){e[d]=1/b[d]}}};Reciprocal.prototype.toString=function(){return"Reciprocal"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Subtract=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||0)};extend(Subtract,AudioletNode);Subtract.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]-o}}};Subtract.prototype.toString=function(){return"Subtract"};var Tanh=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(Tanh,AudioletNode);Tanh.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){var m=b[d];e[d]=(Math.exp(m)-Math.exp(-m))/(Math.exp(m)+Math.exp(-m))}}};Tanh.prototype.toString=function(){return("Tanh")};
/*!
 * @depends ../core/AudioletNode.js
 */
var Envelope=function(b,c,d,f,a,e){AudioletNode.call(this,b,1,1);this.gate=new AudioletParameter(this,0,c||1);this.levels=d;this.times=f;this.releaseStage=a;this.onComplete=e;this.stage=null;this.time=null;this.changeTime=null;this.level=0;this.delta=0;this.gateOn=false};extend(Envelope,AudioletNode);Envelope.prototype.generate=function(c,d){var b=this.gate.getValue();var a=false;if(b&&!this.gateOn){this.gateOn=true;this.stage=0;this.time=0;a=true}if(this.gateOn&&!b){this.gateOn=false;if(this.releaseStage){this.stage=this.releaseStage;a=true}}if(this.changeTime){this.time+=1;if(this.time>=this.changeTime){this.stage+=1;if(this.stage!=this.releaseStage){a=true}else{this.changeTime=null;this.delta=0}}}if(a){if(this.stage!=this.times.length){this.delta=this.calculateDelta(this.stage,this.level);this.changeTime=this.calculateChangeTime(this.stage,this.time)}else{if(this.onComplete){this.onComplete()}this.stage=null;this.time=null;this.changeTime=null;this.delta=0}}this.level+=this.delta;this.outputs[0].samples[0]=this.level};Envelope.prototype.calculateDelta=function(b,d){var c=this.levels[b+1]-d;var a=this.times[b]*this.audiolet.device.sampleRate;return(c/a)};Envelope.prototype.calculateChangeTime=function(b,c){var a=this.times[b]*this.audiolet.device.sampleRate;return(c+a)};Envelope.prototype.toString=function(){return"Envelope"};
/*!
 * @depends Envelope.js
 */
var ADSREnvelope=function(j,e,c,d,g,f,b){var h=[0,1,g,0];var a=[c,d,f];Envelope.call(this,j,e,h,a,2,b)};extend(ADSREnvelope,Envelope);ADSREnvelope.prototype.toString=function(){return"ADSR Envelope"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BiquadFilter=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.frequency=new AudioletParameter(this,1,b||22100);this.lastFrequency=null;this.xValues=[];this.yValues=[];this.b0=0;this.b1=0;this.b2=0;this.a0=0;this.a1=0;this.a2=0};extend(BiquadFilter,AudioletNode);BiquadFilter.prototype.calculateCoefficients=function(a){};BiquadFilter.prototype.generate=function(c,q){var w=c[0];var E=q[0];if(w.isEmpty){E.isEmpty=true;return}var v=this.xValues;var A=this.yValues;var f=[];var s=[];var g=w.numberOfChannels;for(var y=0;y<g;y++){f.push(w.getChannelData(y));s.push(E.getChannelData(y));if(y>=v.length){v.push([0,0]);A.push([0,0])}}var p=this.frequency;var u,e;if(p.isStatic()){u=p.getValue()}else{e=p.getChannel()}var r=this.lastFrequency;var H=this.a0;var G=this.a1;var F=this.a2;var o=this.b0;var n=this.b1;var m=this.b2;var l=E.length;for(var y=0;y<l;y++){if(e){var u=e[y]}if(u!=r){this.calculateCoefficients(u);r=u;H=this.a0;G=this.a1;F=this.a2;o=this.b0;n=this.b1;m=this.b2}for(var x=0;x<g;x++){var k=f[x];var t=s[x];var C=v[x];var B=C[0];var z=C[1];var h=A[x];var b=h[0];var a=h[1];var D=k[y];var d=(o/H)*D+(n/H)*B+(m/H)*z-(G/H)*b-(F/H)*a;t[y]=d;C[0]=D;C[1]=B;h[0]=d;h[1]=b}}this.lastFrequency=r};BiquadFilter.prototype.toString=function(){return"Biquad Filter"};
/*!
 * @depends BiquadFilter.js
 */
var AllPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(AllPassFilter,BiquadFilter);AllPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1-d;this.b1=-2*a;this.b2=1+d;this.a0=1+d;this.a1=-2*a;this.a2=1-d};AllPassFilter.prototype.toString=function(){return"All Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Amplitude=function(c,d,a){AudioletNode.call(this,c,3,1);this.linkNumberOfOutputChannels(0,0);this.followers=[];var b=this.audiolet.device.sampleRate;this.attack=new AudioletParameter(this,1,d||0.01);this.release=new AudioletParameter(this,2,a||0.01)};extend(Amplitude,AudioletNode);Amplitude.prototype.generate=function(a,g){var o=a[0];var u=g[0];if(o.isEmpty){u.isEmpty=true;return}var c=this.followers;var d=c.length;var v=this.attack;var q,l;if(v.isStatic()){q=v.getValue()}else{l=v.getChannel()}var s=this.release;var t,m;if(s.isStatic()){t=s.getValue()}else{m=s.getChannel()}var b=o.numberOfChannels;for(var r=0;r<b;r++){if(r>d){c.push(0)}var h=c[r];var e=o.getChannelData(r);var k=u.getChannelData(r);var f=o.length;for(var p=0;p<f;p++){var n=Math.abs(e[p]);if(l){q=l[p]}if(m){t=m[p]}if(n>h){h=q*(h-n)+n}else{h=t*(h-n)+n}k[p]=h}c[r]=h}};Amplitude.prototype.toString=function(){return("Amplitude")};
/*!
 * @depends ../core/PassThroughNode.js
 */
var BadValueDetector=function(a,b){PassThroughNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0);if(b){this.callback=b}};extend(BadValueDetector,PassThroughNode);BadValueDetector.prototype.callback=function(c,b,a){console.error(c+" detected at channel "+b+" index "+a)};BadValueDetector.prototype.generate=function(d,g){var e=d[0];if(e.isEmpty){return}var h=e.numberOfChannels;for(var c=0;c<h;c++){var f=e.getChannelData(c);var a=e.length;for(var b=0;b<a;b++){var k=f[b];if(typeof k=="undefined"||k==null||isNaN(k)||k==Infinity||k==-Infinity){this.callback(k,c,b)}}}};BadValueDetector.prototype.toString=function(){return"Bad Value Detector"};
/*!
 * @depends BiquadFilter.js
 */
var BandPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(BandPassFilter,BiquadFilter);BandPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=d;this.b1=0;this.b2=-d;this.a0=1+d;this.a1=-2*a;this.a2=1-d};BandPassFilter.prototype.toString=function(){return"Band Pass Filter"};
/*!
 * @depends BiquadFilter.js
 */
var BandRejectFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(BandRejectFilter,BiquadFilter);BandRejectFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1;this.b1=-2*a;this.b2=1;this.a0=1+d;this.a1=-2*a;this.a2=1-d};BandRejectFilter.prototype.toString=function(){return"Band Reject Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BitCrusher=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.bits=new AudioletParameter(this,1,b)};extend(BitCrusher,AudioletNode);BitCrusher.prototype.generate=function(d,f){var a=this.inputs[0];var e=Math.pow(2,this.bits.getValue())-1;var b=a.samples.length;for(var c=0;c<b;c++){this.outputs[0].samples[c]=Math.floor(a.samples[c]*e)/e}};BitCrusher.prototype.toString=function(){return"BitCrusher"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BufferPlayer=function(c,b,e,d,a){AudioletNode.call(this,c,3,1);this.buffer=b;this.setNumberOfOutputChannels(0,this.buffer.numberOfChannels);this.position=d||0;this.playbackRate=new AudioletParameter(this,0,e||1);this.restartTrigger=new AudioletParameter(this,1,0);this.startPosition=new AudioletParameter(this,2,d||0);this.loop=new AudioletParameter(this,3,a||0);this.restartTriggerOn=false;this.playing=true};extend(BufferPlayer,AudioletNode);BufferPlayer.prototype.generate=function(c,o){var x=o[0];var u=this.buffer;var A=this.position;var h=this.playing;var z=this.restartTriggerOn;var t=this.playbackRate;var m,r;if(t.isStatic()){m=t.getValue()}else{r=t.getChannel()}var n=this.restartTrigger;var d,b;if(n.isStatic()){d=n.getValue()}else{b=n.getChannel()}var g=this.startPosition;var p,s;if(g.isStatic()){p=g.getValue()}else{s=g.getChannel()}var e=this.loop;var y,a;if(e.isStatic()){y=e.getValue()}else{a=e.getChannel()}if(u.length==0||(!b&&!h)){x.isEmpty=true;return}var f=u.numberOfChannels;var l=x.length;for(var w=0;w<l;w++){if(r){m=r[w]}if(b){d=b[w]}if(a){y=a[w]}if(d>0&&!z){A=p;z=true;h=true}if(d<=0&&z){z=false}if(h){for(var v=0;v<f;v++){var k=u.channels[v];var q=x.channels[v];q[w]=k[Math.floor(A)]}A+=m;if(A>=u.length){if(y){A%=u.length}else{h=false}}}else{for(var v=0;v<f;v++){var q=x.channels[v];q[w]=0}}}this.playing=h;this.position=A;this.restartTriggerOn=z};BufferPlayer.prototype.toString=function(){return("Buffer player")};
/*!
 * @depends ../core/AudioletNode.js
 */
var CombFilter=function(a,d,c,b){AudioletNode.call(this,a,3,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=d;this.delayTime=new AudioletParameter(this,1,c||1);this.decayTime=new AudioletParameter(this,2,b);var e=d*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(CombFilter,AudioletNode);CombFilter.prototype.generate=function(d,p){var s=d[0];var y=p[0];if(s.isEmpty){y.isEmpty=true;return}var w=this.maximumDelayTime;var c=this.audiolet.device.sampleRate;var C=this.delayTime;var a,x;if(C.isStatic()){a=Math.floor(C.getValue()*c)}else{x=C.getChannel()}var b=this.decayTime;var e,n;if(b.isStatic()){e=Math.floor(b.getValue()*c)}else{n=b.getChannel()}var f;if(C.isStatic()&&b.isStatic()){f=Math.exp(-3*a/e)}var A=this.buffers;var B=this.readWriteIndex;var h=s.channels;var q=y.channels;var g=s.numberOfChannels;var z=A.length;for(var v=z;v<g;v++){var l=w*c;A.push(new Float32Array(l))}var m=s.length;for(var v=0;v<m;v++){if(x){a=Math.floor(x[v]*c)}if(n){e=Math.floor(n[v]*c)}if(x||n){f=Math.exp(-3*a/e)}for(var u=0;u<g;u++){var k=h[u];var r=q[u];var t=A[u];var o=t[B];r[v]=o;t[B]=k[v]+f*o}B+=1;if(B>=a){B=0}}this.readWriteIndex=B};CombFilter.prototype.toString=function(){return"Comb Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var TableLookupOscillator=function(a,b,c){AudioletNode.call(this,a,1,1);this.table=b;this.frequency=new AudioletParameter(this,0,c||440);this.phase=0};extend(TableLookupOscillator,AudioletNode);TableLookupOscillator.prototype.generate=function(){this.outputs[0].samples[0]=this.table[Math.floor(this.phase)];var b=this.audiolet.device.sampleRate;var c=this.frequency.getValue();var a=this.table.length;this.phase+=c*a/b;if(this.phase>a){this.phase%=a}};TableLookupOscillator.prototype.toString=function(){return"Table Lookup Oscillator"};
/*!
 * @depends TableLookupOscillator.js
 */
var Sine=function(a,b){TableLookupOscillator.call(this,a,Sine.TABLE,b)};extend(Sine,TableLookupOscillator);Sine.prototype.toString=function(){return"Sine"};Sine.TABLE=[];for(var i=0;i<8192;i++){Sine.TABLE.push(Math.sin(i*2*Math.PI/8192))}
/*!
 * @depends ../core/AudioletNode.js
 * @depends Sine.js
 */
var CrossFade=function(b,a){AudioletNode.call(this,b,3,1);this.linkNumberOfOutputChannels(0,0);this.position=new AudioletParameter(this,2,a||0.5)};extend(CrossFade,AudioletNode);CrossFade.prototype.generate=function(f,r){var n=f[0];var m=f[1];var y=r[0];var c=n.channels;var b=m.channels;var s=y.channels;if(n.isEmpty&&m.isEmpty){y.isEmpty=true;return}var v=this.position;var z,w;if(v.isStatic()){z=v.getValue()}else{w=v.getChannel()}var q=y.length;for(var x=0;x<q;x++){if(w){z=w[x]}var a=Sine.TABLE.length/4;var k=Math.floor(z*a);var g=Sine.TABLE[k+a];var d=Sine.TABLE[k];var l=n.numberOfChannels;for(var u=0;u<l;u++){var p=c[u];var o=b[u];var t=s[u];var h,e;if(!n.isEmpty){h=p[x]}else{h=0}if(!m.isEmpty){e=o[x]}else{e=0}t[x]=h*g+e*d}}};CrossFade.prototype.toString=function(){return"Cross Fader"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DampedCombFilter=function(b,e,d,c,a){AudioletNode.call(this,b,4,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=e;this.delayTime=new AudioletParameter(this,1,d||1);this.decayTime=new AudioletParameter(this,2,c);this.damping=new AudioletParameter(this,3,a);var f=e*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0;this.filterStore=0};extend(DampedCombFilter,AudioletNode);DampedCombFilter.prototype.generate=function(d,r){var v=d[0];var B=r[0];if(v.isEmpty){B.isEmpty=true;return}var z=this.maximumDelayTime;var c=this.audiolet.device.sampleRate;var F=this.delayTime;var a,A;if(F.isStatic()){a=Math.floor(F.getValue()*c)}else{A=F.getChannel()}var b=this.decayTime;var e,o;if(b.isStatic()){e=Math.floor(b.getValue()*c)}else{o=b.getChannel()}var p=this.damping;var f,G;if(p.isStatic()){f=p.getValue()}else{G=p.getChannel()}var g;if(F.isStatic()&&b.isStatic()){g=Math.exp(-3*a/e)}var E=this.buffers;var D=this.readWriteIndex;var t=this.filterStore;var k=v.channels;var s=B.channels;var h=v.numberOfChannels;var C=E.length;for(var y=C;y<h;y++){var m=z*c;E.push(new Float32Array(m))}var n=v.length;for(var y=0;y<n;y++){if(A){a=Math.floor(A[y]*c)}if(o){e=Math.floor(o[y]*c)}if(G){f=G[y]}if(A||o){g=Math.exp(-3*a/e)}for(var x=0;x<h;x++){var l=k[x];var u=s[x];var w=E[x];var q=w[D];t=(q*(1-f))+(t*f);u[y]=q;w[D]=l[y]+g*t}D+=1;if(D>=a){D=0}}this.readWriteIndex=D;this.filterStore=t};DampedCombFilter.prototype.toString=function(){return"Damped Comb Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DCFilter=function(b,a){AudioletNode.call(this,b,2,1);this.linkNumberOfOutputChannels(0,0);this.coefficient=new AudioletParameter(this,1,a||0.995);this.xValues=[];this.yValues=[]};extend(DCFilter,AudioletNode);DCFilter.prototype.generate=function(f,h){var c=this.coefficient.getValue();var a=this.inputs[0];var b=a.samples.length;for(var e=0;e<b;e++){if(e>=this.xValues.length){this.xValues.push(0)}if(e>=this.yValues.length){this.yValues.push(0)}var d=a.samples[e];var g=d-this.xValues[e]+c*this.yValues[e];this.outputs[0].samples[e]=g;this.xValues[e]=d;this.yValues[e]=g}};DCFilter.prototype.toString=function(){return"DC Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Delay=function(a,c,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=c;this.delayTime=new AudioletParameter(this,1,b||1);var d=c*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(Delay,AudioletNode);Delay.prototype.generate=function(c,k){var n=c[0];var t=k[0];var r=this.maximumDelayTime;var b=this.audiolet.device.sampleRate;var w=this.delayTime;var a,s;if(w.isStatic()){a=Math.floor(w.getValue()*b)}else{s=w.getChannel()}var u=this.buffers;var v=this.readWriteIndex;var d=[];var l=[];var e=n.numberOfChannels;for(var q=0;q<e;q++){d.push(n.getChannelData(q));l.push(t.getChannelData(q));if(q>=u.length){var g=r*b;u.push(new Float32Array(g))}}var h=n.length;for(var q=0;q<h;q++){if(s){a=Math.floor(s[q]*b)}for(var p=0;p<e;p++){var f=d[p];var m=l[p];var o=u[p];m[q]=o[v];if(!n.isEmpty){o[v]=f[q]}else{o[v]=0}}v+=1;if(v>=a){v=0}}this.readWriteIndex=v};Delay.prototype.toString=function(){return"Delay"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DiscontinuityDetector=function(b,a,c){AudioletNode.call(this,b,1,1);this.linkNumberOfOutputChannels(0,0);this.threshold=a||0.2;if(c){this.callback=c}this.lastValues=[]};extend(DiscontinuityDetector,AudioletNode);DiscontinuityDetector.prototype.callback=function(b,c,a){console.error("Discontinuity of "+b+" detected on channel "+c+" index "+a)};DiscontinuityDetector.prototype.generate=function(d,l){var g=d[0];if(g.isEmpty){this.lastValues=[];return}var f=this.lastValues;var e=this.threshold;var m=g.numberOfChannels;for(var c=0;c<m;c++){var h=g.getChannelData(c);if(c>=f.length){f.push(null)}var k=f[c];var a=g.length;for(var b=0;b<a;b++){var n=h[b];if(k!=null){if(Math.abs(k-n)>e){this.callback(Math.abs(k-n),c,b)}}k=n}f[c]=k}};DiscontinuityDetector.prototype.toString=function(){return"Discontinuity Detector"};
/*!
 * @depends ../core/AudioletNode.js
 */
var FeedbackDelay=function(b,e,d,a,c){AudioletNode.call(this,b,4,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=e;this.delayTime=new AudioletParameter(this,1,d||1);this.feedback=new AudioletParameter(this,2,a||0.5);this.mix=new AudioletParameter(this,3,c||1);var f=e*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(FeedbackDelay,AudioletNode);FeedbackDelay.prototype.generate=function(h,k){var l=this.inputs[0];var c=this.outputs[0];var g=this.delayTime.getValue();var a=this.feedback.getValue();var p=this.mix.getValue();var m=this.audiolet.output.device.sampleRate;var j=l.samples.length;var d=this.buffers.length;for(var f=0;f<j;f++){if(f>=d){var b=this.maximumDelayTime*m;this.buffers.push(new Float32Array(b))}var e=this.buffers[f];var o=l.samples[f];var n=e[this.readWriteIndex];c.samples[f]=p*n+(1-p)*o;e[this.readWriteIndex]=o+a*n}this.readWriteIndex+=1;if(this.readWriteIndex>=g){this.readWriteIndex=0}};FeedbackDelay.prototype.toString=function(){return"Feedback Delay"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Gain=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.gain=new AudioletParameter(this,1,b||1)};extend(Gain,AudioletNode);Gain.prototype.generate=function(d,f){var e=this.gain.getValue();var a=this.inputs[0];var b=a.samples.length;for(var c=0;c<b;c++){this.outputs[0].samples[c]=a.samples[c]*e}};Gain.prototype.toString=function(){return("Gain")};
/*!
 * @depends BiquadFilter.js
 */
var HighPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(HighPassFilter,BiquadFilter);HighPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1+a)/2;this.b1=-(1+a);this.b2=this.b0;this.a0=1+d;this.a1=-2*a;this.a2=1-d};HighPassFilter.prototype.toString=function(){return"High Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Lag=function(a,c,b){AudioletNode.call(this,a,2,1);this.value=new AudioletParameter(this,0,c||0);this.lag=new AudioletParameter(this,1,b||1);this.lastValue=c||0;this.log001=Math.log(0.001)};extend(Lag,AudioletNode);Lag.prototype.generate=function(l,p){var d=p[0];var j=d.getChannelData(0);var r=this.audiolet.device.sampleRate;var f=this.log001;var n=this.value;var q,b;if(n.isStatic()){q=n.getValue()}else{b=n.getChannel()}var m=this.lag;var g,c,h;if(m.isStatic()){g=m.getValue();h=Math.exp(f/(g*r))}else{c=m.getChannel()}var o=this.lastValue;var a=d.length;for(var k=0;k<a;k++){if(b){q=b[k];h=Math.exp(f/(g*r))}if(c){g=c[k]}var e=((1-h)*q)+(h*o);j[k]=e;o=e}this.lastValue=o};Lag.prototype.toString=function(){return"Lag"};
/*!
 * @depends ../core/AudioletGroup.js
 */
var Limiter=function(c,b,d,a){AudioletGroup.call(this,c,4,1);var d=d||0.01;this.attackNode=new ParameterNode(c,d);this.attack=this.attackNode.parameter;var a=a||0.4;this.releaseNode=new ParameterNode(c,a);this.release=this.releaseNode.parameter;this.amplitude=new Amplitude(c);this.limitFromAmplitude=new LimitFromAmplitude(c,b);this.threshold=this.limitFromAmplitude.threshold;this.inputs[0].connect(this.amplitude);this.inputs[0].connect(this.limitFromAmplitude,0,0);this.inputs[1].connect(this.limitFromAmplitude,0,2);this.inputs[2].connect(this.attackNode);this.inputs[3].connect(this.releaseNode);this.attackNode.connect(this.amplitude,0,1);this.releaseNode.connect(this.amplitude,0,2);this.amplitude.connect(this.limitFromAmplitude,0,1);this.limitFromAmplitude.connect(this.outputs[0])};extend(Limiter,AudioletGroup);Limiter.prototype.toString=function(){return"Limiter"};var LimitFromAmplitude=function(b,a){AudioletNode.call(this,b,3,1);this.linkNumberOfOutputChannels(0,0);this.threshold=new AudioletParameter(this,2,a||0.95)};extend(LimitFromAmplitude,AudioletNode);LimitFromAmplitude.prototype.generate=function(a,k){var p=a[0];var g=a[1];var n=p.getChannelData(0);var t=k[0];if(p.isEmpty||g.isEmpty){t.isEmpty=true;return}var s=this.threshold;var c,h;if(s.isStatic()){c=s.getValue()}else{h=s.getChannel()}var b=p.numberOfChannels;for(var r=0;r<b;r++){var d=p.getChannelData(r);var m=t.getChannelData(r);var f=p.length;for(var q=0;q<f;q++){var o=d[q];var e=n[q];if(h){c=h[q]}var l=e-c;if(l>0){m[q]=d[q]/(1+l)}else{m[q]=d[q]}}}};LimitFromAmplitude.prototype.toString=function(){return("Limit From Amplitude")};
/*!
 * @depends ../core/AudioletNode.js
 */
var LinearCrossFade=function(b,a){AudioletNode.call(this,b,3,1);this.linkNumberOfOutputChannels(0,0);this.position=new AudioletParameter(this,2,a||0.5)};extend(LinearCrossFade,AudioletNode);LinearCrossFade.prototype.generate=function(d,n){var h=d[0];var g=d[1];var u=n[0];var b=h.channels;var a=g.channels;var o=u.channels;if(h.isEmpty||g.isEmpty){u.isEmpty=true;return}var q=this.position;var v,s;if(q.isStatic()){v=q.getValue()}else{s=q.getChannel()}var m=u.length;for(var t=0;t<m;t++){if(s){v=s[t]}var e=1-v;var c=v;var f=h.numberOfChannels;for(var r=0;r<f;r++){var l=b[r];var k=a[r];var p=o[r];p[t]=l[t]*e+k[t]*c}}};LinearCrossFade.prototype.toString=function(){return"Linear Cross Fader"};
/*!
 * @depends BiquadFilter.js
 */
var LowPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(LowPassFilter,BiquadFilter);LowPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1-a)/2;this.b1=1-a;this.b2=this.b0;this.a0=1+d;this.a1=-2*a;this.a2=1-d};LowPassFilter.prototype.toString=function(){return"Low Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Pan=function(a,b){AudioletNode.call(this,a,2,1);this.setNumberOfOutputChannels(0,2);if(b==null){var b=0.5}this.pan=new AudioletParameter(this,1,b)};extend(Pan,AudioletNode);Pan.prototype.generate=function(j,l){var k=j[0];var e=l[0];if(k.isEmpty){e.isEmpty=true;return}var b=k.getChannelData(0);var f=e.getChannelData(0);var d=e.getChannelData(1);var c=this.pan;var o,h;if(c.isStatic()){o=c.getValue()}else{h=c.getChannel()}var a=e.length;for(var g=0;g<a;g++){if(h){o=h[g]}var n=o*Math.PI/2;var m=b[g];f[g]=m*Math.cos(n);d[g]=m*Math.sin(n)}};Pan.prototype.toString=function(){return"Stereo Panner"};
/*!
 * @depends Envelope.js
 */
var PercussiveEnvelope=function(b,c,g,a,e){var d=[0,1,0];var f=[g,a];Envelope.call(this,b,c,d,f,null,e)};extend(PercussiveEnvelope,Envelope);PercussiveEnvelope.prototype.toString=function(){return"Percussive Envelope"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Pulse=function(a,b,c){AudioletNode.call(this,a,2,1);this.frequency=new AudioletParameter(this,0,b||440);this.pulseWidth=new AudioletParameter(this,1,c||0.5);this.phase=0};extend(Pulse,AudioletNode);Pulse.prototype.generate=function(b,d){var e=this.pulseWidth.getValue();this.outputs[0].samples[0]=(this.phase<e)?1:-1;var c=this.frequency.getValue();var a=this.audiolet.device.sampleRate;this.phase+=c/a;if(this.phase>1){this.phase%=1}};Pulse.prototype.toString=function(){return"Pulse"};
/*!
 * @depends ../core/AudioletNode.js
 * @depends ../core/AudioletGroup.js
 */
var ReverbB=function(c,f,a,b){AudioletGroup.call(this,c,4,1);this.initialMix=0.33;this.fixedGain=0.015;this.initialDamping=0.5;this.scaleDamping=0.4;this.initialRoomSize=0.5;this.scaleRoom=0.28;this.offsetRoom=0.7;this.combTuning=[1116,1188,1277,1356,1422,1491,1557,1617];this.allPassTuning=[556,441,341,225];var a=a||this.initialRoomSize;this.roomSizeNode=new ParameterNode(c,a);this.roomSizeMulAdd=new MulAdd(c,this.scaleRoom,this.offsetRoom);var b=b||this.initialDamping;this.dampingNode=new ParameterNode(c,b);this.dampingMulAdd=new MulAdd(c,this.scaleDamping);this.roomSize=this.roomSizeNode.parameter;this.damping=this.dampingNode.parameter;this.gain=new Gain(c,this.fixedGain);this.combFilters=[];this.fgConverters=[];for(var e=0;e<this.combTuning.length;e++){var h=this.combTuning[e]/this.audiolet.device.sampleRate;this.combFilters[e]=new DampedCombFilter(c,h,h);this.fgConverters[e]=new FeedbackGainToDecayTime(c,h)}this.allPassFilters=[];for(var e=0;e<this.allPassTuning.length;e++){this.allPassFilters[e]=new AllPassFilter(c,this.allPassTuning[e])}var f=f||this.initialMix;this.mixer=new LinearCrossFade(c,f);this.mix=this.mixer.position;this.inputs[1].connect(this.mixer,0,2);this.inputs[2].connect(this.roomSizeNode);this.roomSizeNode.connect(this.roomSizeMulAdd);this.inputs[3].connect(this.dampingNode);this.dampingNode.connect(this.dampingMulAdd);this.inputs[0].connect(this.gain);for(var e=0;e<this.combFilters.length;e++){this.gain.connect(this.combFilters[e]);this.combFilters[e].connect(this.allPassFilters[0]);this.roomSizeMulAdd.connect(this.fgConverters[e]);this.fgConverters[e].connect(this.combFilters[e],0,2);this.dampingMulAdd.connect(this.combFilters[e],0,3)}var d=this.allPassFilters.length;for(var e=0;e<d-1;e++){this.allPassFilters[e].connect(this.allPassFilters[e+1])}this.inputs[0].connect(this.mixer);var g=d-1;this.allPassFilters[g].connect(this.mixer,0,1);this.mixer.connect(this.outputs[0])};extend(ReverbB,AudioletGroup);ReverbB.prototype.toString=function(){return"Reverb B"};var FeedbackGainToDecayTime=function(a,b){AudioletNode.call(this,a,1,1);this.delayTime=b;this.lastFeedbackGain=null;this.decayTime=null};extend(FeedbackGainToDecayTime,AudioletNode);FeedbackGainToDecayTime.prototype.generate=function(h,k){var j=h[0];var d=k[0];var c=j.channels[0];var e=d.channels[0];var g=this.lastDelayTime;var l=this.decayTime;var m=this.lastFeedbackGain;var b=d.length;for(var f=0;f<b;f++){var a=c[f];if(a!=m){l=-3*g/Math.log(a);m=a}e[f]=a}this.decayTime=l;this.lastFeedbackGain=m};
/*!
 * @depends ../core/AudioletNode.js
 * @depends ../core/AudioletGroup.js
 */
var Reverb=function(d,g,a,c){AudioletNode.call(this,d,4,1);this.initialMix=0.33;this.fixedGain=0.015;this.initialDamping=0.5;this.scaleDamping=0.4;this.initialRoomSize=0.5;this.scaleRoom=0.28;this.offsetRoom=0.7;this.combTuning=[1116,1188,1277,1356,1422,1491,1557,1617];this.allPassTuning=[556,441,341,225];var g=g||this.initialMix;this.mix=new AudioletParameter(this,1,g);var a=a||this.initialRoomSize;this.roomSize=new AudioletParameter(this,2,a);var c=c||this.initialDamping;this.damping=new AudioletParameter(this,3,c);this.combBuffers=[];this.combIndices=[];this.filterStores=[];var b=this.combTuning.length;for(var f=0;f<b;f++){this.combBuffers.push(new Float32Array(this.combTuning[f]));this.combIndices.push(0);this.filterStores.push(0)}this.allPassBuffers=[];this.allPassIndices=[];var e=this.allPassTuning.length;for(var f=0;f<e;f++){this.allPassBuffers.push(new Float32Array(this.allPassTuning[f]));this.allPassIndices.push(0)}};extend(Reverb,AudioletNode);Reverb.prototype.generate=function(d,k){var n=this.mix.getValue();var o=this.roomSize.getValue();var e=this.damping.getValue();var a=this.combTuning.length;var u=this.allPassTuning.length;var s=this.inputs[0].samples[0];var l=s;s*=this.fixedGain;var c=s;var e=e*this.scaleDamping;var f=o*this.scaleRoom+this.offsetRoom;for(var t=0;t<a;t++){var q=this.combIndices[t];var r=this.combBuffers[t];var p=this.filterStores[t];var j=r[q];p=(j*(1-e))+(p*e);s+=j;r[q]=c+f*p;q+=1;if(q>=r.length){q=0}this.combIndices[t]=q;this.filterStores[t]=p}for(var t=0;t<u;t++){var b=this.allPassBuffers[t];var h=this.allPassIndices[t];var m=s;var g=b[h];s=-s+g;b[h]=m+(g*0.5);h+=1;if(h>=b.length){h=0}this.allPassIndices[t]=h}this.outputs[0].samples[0]=n*s+(1-n)*l};Reverb.prototype.toString=function(){return"Reverb"};
/*!
 * @depends TableLookupOscillator.js
 */
var Saw=function(a,b){TableLookupOscillator.call(this,a,Saw.TABLE,b)};extend(Saw,TableLookupOscillator);Saw.prototype.toString=function(){return"Saw"};Saw.TABLE=[];for(var i=0;i<8192;i++){Saw.TABLE.push(((((i-4096)/8192)%1)+1)%1*2-1)}
/*!
 * @depends ../core/AudioletNode.js
 */
var SoftClip=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(SoftClip,AudioletNode);SoftClip.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){var m=b[d];if(m>0.5){e[d]=(m-0.25)/m}else{if(m<-0.5){e[d]=(-m-0.25)/m}else{e[d]=m}}}}};SoftClip.prototype.toString=function(){return("SoftClip")};
/*!
 * @depends TableLookupOscillator.js
 */
var Square=function(a,b){TableLookupOscillator.call(this,a,Square.TABLE,b)};extend(Square,TableLookupOscillator);Square.prototype.toString=function(){return"Square"};Square.TABLE=[];for(var i=0;i<8192;i++){Square.TABLE.push(((i-4096)/8192)<0?1:-1)}
/*!
 * @depends TableLookupOscillator.js
 */
var Triangle=function(a,b){TableLookupOscillator.call(this,a,Triangle.TABLE,b)};extend(Triangle,TableLookupOscillator);Triangle.prototype.toString=function(){return"Triangle"};Triangle.TABLE=[];for(var i=0;i<8192;i++){Triangle.TABLE.push(Math.abs(((((i-2048)/8192)%1)+1)%1*2-1)*2-1)}
/*!
 * @depends ../core/AudioletNode.js
 */
var TriggerControl=function(b,a){AudioletNode.call(this,b,0,1);this.trigger=new AudioletParameter(this,null,a||0)};extend(TriggerControl,AudioletNode);TriggerControl.prototype.generate=function(a,b){if(this.trigger.getValue()>0){this.outputs[0].samples[0]=1;this.trigger.setValue(0)}else{this.outputs[0].samples[0]=0}};TriggerControl.prototype.toString=function(){return"Trigger Control"};
/*!
 * @depends ../core/AudioletNode.js
 */
var UpMixer=function(a,b){AudioletNode.call(this,a,1,1);this.outputs[0].numberOfChannels=b};extend(UpMixer,AudioletNode);UpMixer.prototype.generate=function(){var c=this.inputs[0];var b=this.outputs[0];var e=c.samples.length;var a=b.samples.length;if(e==a){b.samples=c.samples}else{for(var d=0;d<a;d++){b.samples[d]=c.samples[d%e]}}};UpMixer.prototype.toString=function(){return"UpMixer"};
/*!
 * @depends ../core/AudioletNode.js
 */
var WhiteNoise=function(a){AudioletNode.call(this,a,0,1)};extend(WhiteNoise,AudioletNode);WhiteNoise.prototype.generate=function(d,f){var a=f[0];var e=a.getChannelData(0);var c=a.length;for(var b=0;b<c;b++){e[b]=Math.random()*2-1}};WhiteNoise.prototype.toString=function(){return"White Noise"};var Pattern=function(){};Pattern.prototype.next=function(){return null};Pattern.prototype.valueOf=function(a){if(a instanceof Pattern){return(a.next())}else{return(a)}};Pattern.prototype.reset=function(){};
/*!
 * @depends Pattern.js
 */
var PArithmetic=function(c,b,a){Pattern.call(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0};extend(PArithmetic,Pattern);PArithmetic.prototype.next=function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value+=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)};PArithmetic.prototype.reset=function(){this.value=this.start;this.position=0;if(this.step instanceof Pattern){this.step.reset()}};var Pseries=PArithmetic;
/*!
 * @depends Pattern.js
 */
var PChoose=function(b,a){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0};extend(PChoose,Pattern);PChoose.prototype.next=function(){var b;if(this.position<this.repeats){var a=Math.floor(Math.random()*this.list.length);var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PChoose.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Prand=PChoose;
/*!
 * @depends Pattern.js
 */
var PGeometric=function(c,b,a){Pattern.call(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0};extend(PGeometric,Pattern);PGeometric.prototype.next=function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value*=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)};PGeometric.prototype.reset=function(){this.value=this.start;this.position=0;if(this.step instanceof Pattern){this.step.reset()}};var Pgeom=PGeometric;
/*!
 * @depends Pattern.js
 */
var PProxy=function(a){Pattern.call(this);if(a){this.pattern=a}};extend(PProxy,Pattern);PProxy.prototype.next=function(){var a;if(this.pattern){var a=this.pattern.next()}else{a=null}return a};var Pp=PProxy;
/*!
 * @depends Pattern.js
 */
var PRandom=function(a,c,b){Pattern.call(this);this.low=a;this.high=c;this.repeats=b;this.position=0};extend(PRandom,Pattern);PRandom.prototype.next=function(){var b;if(this.position<this.repeats){var a=this.valueOf(this.low);var c=this.valueOf(this.high);if(a!=null&&c!=null){this.value*=step;b=this.value;this.position+=1}else{b=null}}else{b=null}return(b)};PRandom.prototype.reset=function(){this.position=0};var Pwhite=PRandom;
/*!
 * @depends Pattern.js
 */
var PSequence=function(b,a,c){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0};extend(PSequence,Pattern);PSequence.prototype.next=function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PSequence.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Pseq=PSequence;
/*!
 * @depends Pattern.js
 */
var PSeries=function(b,a,c){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0};extend(PSeries,Pattern);PSeries.prototype.next=function(){var b;if(this.position<this.repeats){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PSeries.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Pser=PSeries;
/*!
 * @depends Pattern.js
 */
var PShuffle=function(d,a){Pattern.call(this);this.list=[];while(d.length){var b=Math.floor(Math.random()*d.length);var c=d.splice(b,1);this.list.push(c)}this.repeats=a;this.position=0};extend(PShuffle,Pattern);PShuffle.prototype.next=function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};var Pshuffle=PShuffle;var Scale=function(b,a){this.degrees=b;this.tuning=a||new EqualTemperamentTuning(12)};Scale.prototype.getFrequency=function(d,a,b){var c=a;b+=Math.floor(d/this.degrees.length);d%=this.degrees.length;c*=Math.pow(this.tuning.octaveRatio,b);c*=this.tuning.ratios[this.degrees[d]];return c};
/*!
 * @depends Scale.js
 */
var MajorScale=function(){Scale.call(this,[0,2,4,5,7,9,11])};extend(MajorScale,Scale);
/*!
 * @depends Scale.js
 */
var MinorScale=function(){Scale.call(this,[0,2,3,5,7,8,10])};extend(MinorScale,Scale);var Tuning=function(d,c){this.semitones=d;this.octaveRatio=c||2;this.ratios=[];var b=this.semitones.length;for(var a=0;a<b;a++){this.ratios.push(Math.pow(2,this.semitones[a]/b))}};
/*!
 * @depends Tuning.js
 */
var EqualTemperamentTuning=function(b){var c=[];for(var a=0;a<b;a++){c.push(a)}Tuning.call(this,c,2)};extend(EqualTemperamentTuning,Tuning);(function(e){function d(l,k,j,h){var f=d.sinks,g;for(g in f){if(f.hasOwnProperty(g)&&f[g].enabled){try{return new f[g](l,k,j,h)}catch(m){}}}throw"No audio sink available."}function c(f){this.boundTo=f;this.buffers=[];f.activeRecordings.push(this)}c.prototype={add:function(f){this.buffers.push(f)},clear:function(){this.buffers=[]},stop:function(){var f=this.boundTo.activeRecordings,g;for(g=0;g<f.length;g++){if(f[g]===this){f.splice(g--,1)}}},join:function(){var k=0,m=0,h=this.buffers,f,o,j,g=h.length;for(j=0;j<g;j++){k+=h[j].length}f=new Float32Array(k);for(j=0;j<g;j++){for(o=0;o<h[j].length;o++){f[m+o]=h[j][o]}m+=h[j].length}return f}};function b(){}d.SinkClass=b;b.prototype={sampleRate:44100,channelCount:2,preBufferSize:4096,writePosition:0,writeMode:"async",channelMode:"interleaved",previousHit:0,ringBuffer:null,ringOffset:0,start:function(j,h,g,f){this.channelCount=isNaN(h)?this.channelCount:h;this.preBufferSize=isNaN(g)?this.preBufferSize:g;this.sampleRate=isNaN(f)?this.sampleRate:f;this.readFn=j;this.activeRecordings=[];this.previousHit=+new Date;this.asyncBuffers=[];this.syncBuffers=[]},process:function(g,h){this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);this.writeBuffersSync.apply(this,arguments);if(this.readFn){if(this.channelMode==="interleaved"){this.readFn.apply(this,arguments)}else{var f=d.deinterleave(g,this.channelCount);this.readFn.apply(this,[f].concat([].slice.call(arguments,1)));d.interleave(f,this.channelCount,g)}}this.writeBuffersAsync.apply(this,arguments);this.recordData.apply(this,arguments);this.previousHit=+new Date;this.writePosition+=g.length/h},record:function(){return new c(this)},recordData:function(g){var j=this.activeRecordings,h,f=j.length;for(h=0;h<f;h++){j[h].add(g)}},writeBuffersAsync:function(h){var g=this.asyncBuffers,f=h.length,j,m,k,p,o;if(g){for(k=0;k<g.length;k++){j=g[k];m=j.b.length;o=j.d;j.d-=Math.min(o,f);for(p=0;p+o<f&&p<m;p++){h[p+o]+=j.b[p]}j.b=j.b.subarray(p+o);k>=m&&g.splice(k--,1)}}},writeBuffersSync:function(h){var g=this.syncBuffers,f=h.length,j=0,k=0;for(;j<f&&g.length;j++){h[j]+=g[0][k];if(g[0].length<=k){g.splice(0,1);k=0;continue}k++}if(g.length){g[0]=g[0].subarray(k)}},writeBufferAsync:function(g,h){g=this.mode==="deinterleaved"?d.interleave(g,this.channelCount):g;var f=this.asyncBuffers;f.push({b:g,d:isNaN(h)?~~((+new Date-this.previousHit)/1000*this.sampleRate):h});return f.length},writeBufferSync:function(g){g=this.mode==="deinterleaved"?d.interleave(g,this.channelCount):g;var f=this.syncBuffers;f.push(g);return f.length},writeBuffer:function(){this[this.writeMode==="async"?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},getSyncWriteOffset:function(){var f=this.syncBuffers,h=0,g;for(g=0;g<f.length;g++){h+=f[g].length}return h},getPlaybackTime:function(){return this.writePosition-this.preBufferSize},ringSpin:function(h){var j=this.ringBuffer,g=h.length,f=j.length,n=this.ringOffset,k;for(k=0;k<g;k++){h[k]+=j[n];n=(n+1)%f}this.ringOffset=n},ringSpinDeinterleaved:function(p){var o=this.ringBuffer,k=p.length,f=o.length,j=o[0].length,r=f*j,h=this.ringOffset,q,g;for(q=0;q<k;q+=f){for(g=0;g<f;g++){p[q+g]+=o[g][h]}h=(h+1)%j}this.ringOffset=g}};function a(j,h,f,g){f=f||h.prototype;h.prototype=new d.SinkClass();h.prototype.type=j;h.enabled=!g;for(g in f){if(f.hasOwnProperty(g)){h.prototype[g]=f[g]}}a[j]=h}a("moz",function(){var p=this,h=0,o=null,n=new Audio(),m,l,j,k,f;p.start.apply(p,arguments);p.preBufferSize=isNaN(arguments[2])?p.sampleRate/2:p.preBufferSize;function g(){if(o){m=n.mozWriteAudio(o);h+=m;if(m<o.length){o=o.subarray(m);return o}o=null}l=n.mozCurrentSampleOffset();j=Number(l+p.preBufferSize*p.channelCount-h);if(j>0){k=new Float32Array(j);p.process(k,p.channelCount);m=n.mozWriteAudio(k);if(m<k.length){o=k.subarray(m)}h+=m}}n.mozSetup(p.channelCount,p.sampleRate);p.kill=d.doInterval(g,20);p._bufferFill=g;p._audio=n},{getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}});a("webkit",function(n,l,j,h){var f=this,k=new (window.AudioContext||webkitAudioContext)(),m=k.createJavaScriptNode(j,0,l);f.start.apply(f,arguments);function g(v){var o=v.outputBuffer,r=o.numberOfChannels,t,q,s=o.length,w=o.size,u=new Array(r),p=new Float32Array(s*r);for(t=0;t<r;t++){u[t]=o.getChannelData(t)}f.process(p,f.channelCount);for(t=0;t<s;t++){for(q=0;q<r;q++){u[q][t]=p[t*f.channelCount+q]}}}m.onaudioprocess=g;m.connect(k.destination);f.sampleRate=k.sampleRate;f._context=k;f._node=m;f._callback=g},{kill:function(){},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate},});a("dummy",function(){var f=this;f.start.apply(f,arguments);function g(){var h=new Float32Array(f.preBufferSize*f.channelCount);f.process(h,f.channelCount)}f.kill=d.doInterval(g,f.preBufferSize/f.sampleRate*1000);f._callback=g},null,true);d.sinks=d.devices=a;d.Recording=c;d.doInterval=function(m,h){var g=window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,l,k,f;if((d.doInterval.backgroundWork||d.devices.moz.backgroundWork)&&g){try{f=new g();f.append('setInterval(function(){ postMessage("tic"); }, '+h+");");k=(window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL).createObjectURL(f.getBlob());l=new Worker(k);l.onmessage=function(){m()};return function(){l.terminate();(window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL).revokeObjectURL(k)}}catch(j){}}l=setInterval(m,h);return function(){clearInterval(l)}};d.doInterval.backgroundWork=true;(function(){function f(g,h){if(g&&h){f[g]=h}else{if(g&&f[g] instanceof Function){d.interpolate=f[g]}}return f[g]}d.interpolation=f;f("linear",function(g,l){var k=Math.floor(l),j=k+1,h=l-k;j=j<g.length?j:0;return g[k]*(1-h)+g[j]*h});f("nearest",function(g,h){return h>=g.length-0.5?g[0]:g[Math.round(h)]});f("linear")}());d.resample=function(p,f,s,t,h){var o=arguments.length,k=o===2?f:o===3?f/s:t/f*h/s,m=p.length,g=Math.ceil(m/k),r=new Float32Array(g),q,j;for(q=0,j=0;q<m;q+=k){r[j++]=d.interpolate(p,q)}return r};d.deinterleave=function(g,m){var f=g.length,k=f/m,h=[],j,o;for(j=0;j<m;j++){h[j]=new Float32Array(k);for(o=0;o<k;o++){h[j][o]=g[o*m+j]}}return h};d.interleave=function(h,m,g){m=m||h.length;var f=h[0].length,k=h.length,j,o;g=g||new Float32Array(f*m);for(j=0;j<k;j++){for(o=0;o<f;o++){g[j+o*m]=h[j][o]}}return g};d.mix=function(h){var g=[].slice.call(arguments,1),f,j,k;for(k=0;k<g.length;k++){f=Math.max(h.length,g[k].length);for(j=0;j<f;j++){h[j]+=g[k][j]}}return h};d.resetBuffer=function(g){var f=g.length,h;for(h=0;h<f;h++){g[h]=0}return g};d.clone=function(h,f){var g=h.length,j;f=f||new Float32Array(g);for(j=0;j<g;j++){f[j]=h[j]}return f};d.createDeinterleaved=function(j,h){var f=new Array(h),g;for(g=0;g<h;g++){f[g]=new Float32Array(j)}return f};e.Sink=d}(function(){return this}()));