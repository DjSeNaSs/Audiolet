var AudioletNode=new Class({initialize:function(c,b,e,a){this.audiolet=c;this.numberOfInputs=b;this.numberOfOutputs=e;this.inputs=[];var b=this.numberOfInputs;for(var d=0;d<b;d++){this.inputs.push(new AudioletInput(this,d))}this.outputs=[];var e=this.numberOfOutputs;for(var d=0;d<e;d++){this.outputs.push(new AudioletOutput(this,d))}if(a){this.generate=a}this.timestamp=null},connect:function(d,c,b){if(instanceOf(d,AudioletGroup)){d=d.inputs[b||0]}var a=this.outputs[c||0];var e=d.inputs[b||0];a.connect(e);e.connect(a)},disconnect:function(d,c,b){if(instanceOf(d,AudioletGroup)){d=d.inputs[b||0]}var a=this.outputs[c||0];var e=d.inputs[b];e.disconnect(a);a.disconnect(e)},tick:function(b,c){if(c!=this.timestamp){this.tickParents(b,c);var a=this.createInputBuffers(b);var d=this.createOutputBuffers(b);this.generate(a,d);this.timestamp=c}},tickParents:function(f,g){var a=this.numberOfInputs;for(var d=0;d<a;d++){var b=this.inputs[d];var e=b.connectedFrom.length;for(var c=0;c<e;c++){b.connectedFrom[c].node.tick(f,g)}}},generate:function(a,b){},createInputBuffers:function(a){var f=[];var g=this.numberOfInputs;for(var d=0;d<g;d++){var o=this.inputs[d];var m=o.connectedFrom;var k=m.length;if(k){var n=0;var e;for(var c=0;c<k;c++){var b=m[c];var l=b.buffer.numberOfChannels;if(l>n){n=l;e=b}}var h=o.buffer;h.resize(n,a);h.set(e.buffer);for(var c=0;c<k;c++){var b=m[c];if(b!=e){h.add(b.buffer)}}o.buffer=h;f.push(h)}else{f.push(null)}}return(f)},createOutputBuffers:function(c){var e=[];var d=this.numberOfOutputs;for(var b=0;b<d;b++){var a=this.outputs[b];a.buffer.resize(a.getNumberOfChannels(),c);e.push(a.buffer)}return(e)},remove:function(){var g=this.inputs.length;for(var e=0;e<g;e++){var h=this.inputs[e];var c=h.connectedFrom.length;for(var d=0;d<c;d++){var a=h.connectedFrom[d];var b=a.node;b.disconnect(this,a.index,e)}}var f=this.outputs.length;for(var e=0;e<f;e++){var b=this.outputs[e];var c=b.connectedTo.length;for(var d=0;d<c;d++){var k=h.connectedFrom[d];var h=k.node;this.disconnect(h,e,k.index)}}}});var AbstractAudioletDevice=new Class({Extends:AudioletNode,initialize:function(a){AudioletNode.prototype.initialize.apply(this,[a,1,0]);this.audiolet=a;this.numberOfChannels=this.audiolet.numberOfChannels;this.sampleRate=this.audiolet.sampleRate;this.bufferSize=this.audiolet.bufferSize;this.buffer=null},generate:function(a,b){this.buffer=a[0]},getPlaybackTime:function(){return 0},getWriteTime:function(){return 0}});var AudioDataAPIDevice=new Class({Extends:AbstractAudioletDevice,initialize:function(a){AbstractAudioletDevice.prototype.initialize.apply(this,[a]);this.output=new Audio();this.overflow=null;this.writePosition=0;this.output.mozSetup(this.numberOfChannels,this.sampleRate);this.tick.periodical(1000*this.bufferSize/this.sampleRate,this)},tick:function(){var b;if(this.overflow){b=this.output.mozWriteAudio(this.overflow);this.writePosition+=b;if(b<this.overflow.length){this.overflow=this.overflow.subarray(b);return}this.overflow=null}var d=this.output.mozCurrentSampleOffset();if(d==0){this.writePosition=0}var c=d+(this.bufferSize*this.numberOfChannels)-this.writePosition;if(c<=0&&c>=-128){c=this.bufferSize}if(c>0){AudioletNode.prototype.tick.apply(this,[c/this.numberOfChannels]);this.buffer.interleave();var a=this.buffer.data;b=this.output.mozWriteAudio(a);this.writePosition+=b;if(b<a.length){this.overflow=a.subarray(b)}}},getTime:function(){return this.output.mozCurrentSampleOffset()/this.numberOfChannels}});var AudioletBuffer=new Class({initialize:function(b,c,a){this.numberOfChannels=b;this.sampleRate=a;this.length=c;this.duration=this.length/this.sampleRate;this.data=new Float32Array(b*c);this.unsliced_data=this.data},getChannelData:function(a){return(this.data.subarray(a*this.length,(a+1)*this.length))},set:function(a){this.data.set(a.data)},add:function(b){var f=this.length;var d=b.numberOfChannels;for(var e=0;e<d;e++){var a=this.getChannelData(e);var g=b.getChannelData(e);for(var c=0;c<f;c++){a[c]+=g[c]}}},resize:function(b,c){if(b*c>this.unsliced_data.length){this.data=new Float32Array(b*c);this.unsliced_data=this.data}else{var a=b*c;this.data=this.unsliced_data.subarray(0,a)}this.numberOfChannels=b;this.length=c},interleave:function(){var c=this.numberOfChannels*this.length;var f=new Float32Array(c);var b=this.getChannelData(0);var a=this.getChannelData(1);var e=this.length;for(var d=0;d<e;d++){f[2*d]=b[d];f[2*d+1]=a[d]}this.data=f}});var AudioletGroup=new Class({initialize:function(b,a,d){this.audiolet=b;this.numberOfInputs=a;this.numberOfOutputs=d;this.inputs=[];for(var c=0;c<a;c++){this.inputs.push(new PassThroughNode(this.audiolet,1,1))}this.outputs=[];for(var c=0;c<d;c++){this.outputs.push(new PassThroughNode(this.audiolet,1,1))}},connect:function(c,b,a){this.outputs[b||0].connect(c,0,a)},disconnect:function(c,b,a){this.outputs[b||0].disconnect(c,0,a)},remove:function(){var a=this.inputs.length;for(var b=0;b<a;b++){this.inputs[b].remove()}for(var b=0;b<numberOfOutputs;b++){this.outputs[b].remove()}}});var AudioletDestination=new Class({Extends:AudioletGroup,initialize:function(a){AudioletGroup.prototype.initialize.apply(this,[a,1,0]);this.device=new AudioletDevice(a);this.scheduler=new Scheduler(a);this.inputs[0].connect(this.scheduler);this.scheduler.connect(this.device)}});function AudioletDevice(b){var a=new Audio();var c=(typeof a.mozSetup=="function");a=null;if(c){return(new AudioDataAPIDevice(b))}else{if(typeof AudioContext!="undefined"){return(new WebAudioAPIDevice(b))}else{return(new DummyDevice(b))}}}var AudioletInput=new Class({initialize:function(b,a){this.node=b;this.index=a;this.connectedFrom=[];this.buffer=new AudioletBuffer(1,1,b.audiolet.sampleRate)},connect:function(a){this.connectedFrom.push(a)},disconnect:function(a){var c=this.connectedFrom.length;for(var b=0;b<c;b++){if(a==this.connectedFrom[b]){this.connectedFrom.splice(b,1);break}}},isConnected:function(){return(this.connectedFrom.length>0)}});var Audiolet=new Class({initialize:function(b,a,c){this.sampleRate=b||44100;this.numberOfChannels=a||2;this.bufferSize=c||Math.pow(2,14);this.output=new AudioletDestination(this);this.device=this.output.device;this.scheduler=this.output.scheduler}});var AudioletOutput=new Class({initialize:function(b,a){this.node=b;this.index=a;this.connectedTo=[];this.buffer=new AudioletBuffer(1,1,b.audiolet.sampleRate);this.linkedInput=null;this.numberOfChannels=1},connect:function(a){this.connectedTo.push(a)},disconnect:function(a){var c=this.connectedTo.length;for(var b=0;b<c;b++){if(a==this.connectedTo[b]){this.connectedTo.splice(b,1);break}}},isConnected:function(){return(this.connectedTo.length>0)},link:function(a){this.linkedInput=a},unlink:function(){this.linkedInput=null},getNumberOfChannels:function(){if(this.linkedInput&&this.linkedInput.isConnected()){return(this.linkedInput.buffer.numberOfChannels)}return(this.numberOfChannels)}});var AudioletParameter=new Class({initialize:function(a,c,b){this.node=a;if(typeof c!="undefined"&&c!=null){this.input=a.inputs[c]}else{this.input=null}this.value=b||0},setValue:function(a){this.value=a},getValue:function(b){var a=this.input;if(a&&a.isConnected()){return(a.buffer.data[b])}else{return(this.value)}}});var DummyDevice=new Class({Extends:AbstractAudioletDevice,initialize:function(a){AbstractAudioletDevice.prototype.initialize.apply(this,[a]);this.writePosition=0;this.tick.periodical(1000*this.bufferSize/this.sampleRate,this)},tick:function(){AudioletNode.prototype.tick.apply(this,[this.bufferSize]);this.writePosition+=this.bufferSize},getPlaybackTime:function(){return this.writePosition-this.bufferSize},getWriteTime:function(){return this.writePosition}});var PassThroughNode=new Class({Extends:AudioletNode,initialize:function(b,a,c){AudioletNode.prototype.initialize.apply(this,[b,a,c])},createOutputBuffers:function(e){var g=[];var f=this.numberOfOutputs;var a=this.numberOfInputs;for(var d=0;d<f;d++){var c=this.outputs[d];if(d<a){var b=this.inputs[d];c.buffer=b.buffer}else{c.buffer.resize(c.getNumberOfChannels(),e)}g.push(c.buffer)}return(g)}});var PriorityQueue=new Class({initialize:function(c,b){if(b){this.compare=b}if(c){this.heap=c;for(var a=0;a<Math.floor(this.heap.length/2);a++){this.siftUp(a)}}else{this.heap=[]}},push:function(a){this.heap.push(a);this.siftDown(0,this.heap.length-1)},pop:function(){var b,a;b=this.heap.pop();if(this.heap.length){var a=this.heap[0];this.heap[0]=b;this.siftUp(0)}else{a=b}return(a)},peek:function(){return(this.heap[0])},isEmpty:function(){return(this.heap.length==0)},siftDown:function(d,a){var b=this.heap[a];while(a>d){var e=(a-1)>>1;var c=this.heap[e];if(this.compare(b,c)){this.heap[a]=c;a=e;continue}break}this.heap[a]=b},siftUp:function(a){var e=this.heap.length;var d=a;var c=this.heap[a];var b=2*a+1;while(b<e){var f=b+1;if(f<e&&!this.compare(this.heap[b],this.heap[f])){b=f}this.heap[a]=this.heap[childposition];a=b;b=2*a+1}this.heap[a]=c;siftDown(d,a)},compare:function(d,c){return(d<c)},});var Scheduler=new Class({Extends:AudioletNode,initialize:function(a,b){AudioletNode.prototype.initialize.apply(this,[a,1,1]);this.outputs[0].link(this.inputs[0]);this.bpm=b||120;this.queue=new PriorityQueue(null,function(d,c){return(d.time<c.time)});this.time=0;this.beat=0;this.beatInBar=0;this.bar=0;this.seconds=0;this.beatsPerBar=0;this.lastBeatTime=0;this.beatLength=60/this.bpm*this.audiolet.sampleRate},addRelative:function(a,c){var b={};b.callback=c;b.time=this.time+a*this.beatLength;this.queue.push(b);return b},addAbsolute:function(b,c){if(b<this.beat||b==this.beat&&this.time>this.lastBeatTime){return null}var a={};a.callback=c;a.time=this.lastBeatTime+(b-this.beat)*this.beatLength;this.queue.push(a);return a},play:function(b,a,d){var c={};c.patterns=b;c.durationPattern=a;c.callback=d;c.time=this.audiolet.device.getWriteTime();this.queue.push(c)},remove:function(){},tick:function(c,j){var d=this.audiolet.device.getWriteTime();this.updateClock(d);var k=null;var a=d;while(!this.queue.isEmpty()&&this.queue.peek().time<=d+c){var b=this.queue.pop();var e=b.time-a;if(e>0){var g=a-d;this.tickParents(e,j+g);var h=this.createInputBuffers(e);if(!k){var k=this.createOutputBuffers(c)}this.generate(h,k,g)}this.updateClock(b.time);a=b.time;this.processEvent(b)}var f=d+c-a;if(f){this.tickParents(f,j+a-d);var h=this.createInputBuffers(f);if(!k){var k=this.createOutputBuffers(c)}var g=a-d;this.generate(h,k,g)}},updateClock:function(a){this.time=a;this.seconds=this.time*this.audiolet.sampleRate;if(this.time>=this.lastBeatTime+this.beatLength){this.beat+=1;this.beatInBar+=1;if(this.beatInBar==this.beatsPerBar){this.bar+=1;this.beatInBar=0}this.lastBeatTime+=this.beatLength}},processEvent:function(e){var a=e.durationPattern;if(a){var b=[];var d=e.patterns;var h=d.length;for(var c=0;c<h;c++){var f=d[c];b.push(f.next())}e.callback.apply(null,b);var g;if(instanceOf(a,Pattern)){g=a.next()}else{g=a}if(g){e.time+=g*this.beatLength;this.queue.push(e)}}},generate:function(d,f,g){var e=d[0];var b=f[0];for(var c=0;c<e.numberOfChannels;c++){var h=e.getChannelData(c);var a=b.getChannelData(c);a.set(h,g)}}});var Int8Array,Uint8Array,Int16Array,Uint16Array;var Int32Array,Uint32Array,Float32Array,Float64Array;var types=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];var original,shim;for(var i=0;i<types.length;++i){if(types[i]){if(types[i].prototype.slice===undefined){original="subarray";shim="slice"}else{if(types[i].prototype.subarray===undefined){original="slice";shim="subarray"}}Object.defineProperty(types[i].prototype,shim,{value:types[i].prototype[original],enumerable:false})}}var WebAudioAPIDevice=new Class({Extends:AbstractAudioletDevice,initialize:function(a){AbstractAudioletDevice.prototype.initialize.apply(this,[a]);var c,b;c=c||b;this.context=new c(this.sampleRate);this.node=this.context.createJavaScriptAudioNode(this.bufferSize,1,1);this.node.onprocessaudio=this.tick;this.writePosition=0},tick:function(e){var a=e.outputBuffer[0];var f=a.length;AudioletNode.prototype.tick.apply(this,[f]);var b=a.numberOfChannels;for(var c=0;c<b;c++){var d=a.getChannelData(c);d.set(this.buffer.getChannelData(c))}this.writePosition+=f},getPlaybackTime:function(){return this.context.currentTime*this.sampleRate},getWriteTime:function(){return this.writePosition}});var Envelope=new Class({Extends:AudioletNode,initialize:function(b,c,a,d){AudioletNode.prototype.initialize.apply(this,[b,1,a]);this.gate=new AudioletParameter(this,0,c||1);this.onComplete=d}});var ADSR=new Class({Extends:Envelope,initialize:function(c,d,g,e,b,a,f){Envelope.prototype.initialize.apply(this,[c,d,5,f]);this.on=false;this.stage=null;this.level=0;this.attack=new AudioletParameter(this,1,g||0.01);this.decay=new AudioletParameter(this,2,e||0.3);this.sustain=new AudioletParameter(this,3,b||0.5);this.release=new AudioletParameter(this,4,a||1);this.attackDelta=null;this.releaseDelta=null},generate:function(c,l){var o=l[0];var x=o.getChannelData(0);var b=this.audiolet.sampleRate;var h=this.gate;var v=this.attack;var d=this.decay;var n=this.sustain;var r=this.release;var m=this.on;var s=this.stage;var a=this.level;var u=this.onComplete;var j=this.attackDelta;var f=this.releaseDelta;var g=o.length;for(var q=0;q<g;q++){var k=h.getValue(q);if(!m&&k){m=true;s=ADSR.ATTACK;var p=v.getValue(q);j=(1-a)/(p*b)}if(m&&!k){m=false;s=ADSR.RELEASE;var t=r.getValue(q);f=a/(t*b)}if(s==ADSR.ATTACK){a+=j;if(a>=1){a=1;s=ADSR.DECAY;var w=d.getValue(q);var e=n.getValue(q);decayDelta=(1-e)/(w*b)}}else{if(s==ADSR.DECAY){a-=decayDelta;var e=n.getValue(q);if(a<=e){a=e;s=ADSR.SUSTAIN}}else{if(s==ADSR.RELEASE){a-=f;if(a<=0){a=0;s=null;if(u){u()}}}}}x[q]=a}this.on=m;this.stage=s;this.level=a;this.attackDelta=j;this.releaseDelta=f}});ADSR.ATTACK=0;ADSR.DECAY=1;ADSR.SUSTAIN=2;ADSR.RELEASE=3;var BiquadFilter=new Class({Extends:AudioletNode,initialize:function(a,b){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.outputs[0].link(this.inputs[0]);this.frequency=new AudioletParameter(this,1,b||22100);this.lastFrequency=null;this.xValues=[];this.yValues=[];this.b0=0;this.b1=0;this.b2=0;this.a0=0;this.a1=0;this.a2=0},calculateCoefficients:function(a){},generate:function(c,p){var u=c[0];var B=p[0];var e=[];var r=[];var f=u.numberOfChannels;for(var w=0;w<f;w++){e.push(u.getChannelData(w));r.push(B.getChannelData(w));if(w>=this.xValues.length){this.xValues.push([0,0]);this.yValues.push([0,0])}}var o=this.frequency;var q=this.lastFrequency;var E=this.a0;var D=this.a1;var C=this.a2;var n=this.b0;var m=this.b1;var l=this.b2;var k=B.length;for(var w=0;w<k;w++){var t=o.getValue(w);if(t!=q){this.calculateCoefficients(t);q=t;E=this.a0;D=this.a1;C=this.a2;n=this.b0;m=this.b1;l=this.b2}for(var v=0;v<f;v++){var h=e[v];var s=r[v];var z=this.xValues[v];var y=z[0];var x=z[1];var g=this.yValues[v];var b=g[0];var a=g[1];var A=h[w];var d=(n/E)*A+(m/E)*y+(l/E)*x-(D/E)*b-(C/E)*a;s[w]=d;z[0]=A;z[1]=y;g[0]=d;g[1]=b}}this.lastFrequency=q}});var AllPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1-d;this.b1=-2*a;this.b2=1+d;this.a0=1+d;this.a1=-2*a;this.a2=1-d}});var BandPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=d;this.b1=0;this.b2=-d;this.a0=1+d;this.a1=-2*a;this.a2=1-d}});var BandRejectFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1;this.b1=-2*a;this.b2=1;this.a0=1+d;this.a1=-2*a;this.a2=1-d}});var Delay=new Class({Extends:AudioletNode,initialize:function(a,c,b){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.maximumDelayTime=c;this.delayTime=new AudioParameter(this,1,b||1);this.buffer=new Float32Array(c);this.readWriteIndex=0},generate:function(j,m){var k=j[0];var c=m[0];var l=this.delayTime;var f=this.buffer;var d=this.readWriteIndex;var n=this.audiolet.sampleRate;var b=k.getChannelData(0);var e=c.getChannelData(0);var a=k.length;for(var g=0;g<a;g++){var h=l.getValue(g)*n;e[g]=f[d];f[d]=b[g];d=(d+1)%h}this.readWriteIndex=d}});var Gain=new Class({Extends:AudioletNode,initialize:function(a){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.outputs[0].link(this.inputs[0]);this.gain=new AudioletParameter(this,1,1)},generate:function(g,k){var h=g[0];var c=k[0];var m=this.gain;var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){e[d]=b[d]*m.getValue(f)}}}});var HighPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1+a)/2;this.b1=-(1+a);this.b2=this.b1;this.a0=1+d;this.a1=-2*a;this.a2=1-d}});var LowPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1-a)/2;this.b1=1-a;this.b2=this.b1;this.a0=1+d;this.a1=-2*a;this.a2=1-d}});var MulAdd=new Class({Extends:AudioletNode,initialize:function(a,c,b){AudioletNode.prototype.initialize.apply(this,[a,3,1]);this.outputs[0].link(this.inputs[0]);this.mul=new AudioletParameter(this,1,c||1);this.add=new AudioletParameter(this,2,b||0)},generate:function(k,n){var l=k[0];var c=n[0];var e=this.mul;var m=this.add;var o=l.numberOfChannels;for(var h=0;h<o;h++){var b=l.getChannelData(h);var g=c.getChannelData(h);var a=l.length;for(var f=0;f<a;f++){var d=e.getValue(f);var p=m.getValue(f);g[f]=b[f]*d+p}}}});var Pan=new Class({Extends:AudioletNode,initialize:function(a){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.outputs[0].numberOfChannels=2;this.pan=new AudioletParameter(this,1,0.5)},generate:function(g,j){var h=g[0];var d=j[0];var b=h.getChannelData(0);var e=d.getChannelData(0);var c=d.getChannelData(1);var m=this.pan;var a=d.length;for(var f=0;f<a;f++){var l=this.pan.getValue(f)*Math.PI/2;var k=b[f];e[f]=k*Math.cos(l);c[f]=k*Math.sin(l)}}});var TableLookupOscillator=new Class({Extends:AudioletNode,initialize:function(a,b,c){AudioletNode.prototype.initialize.apply(this,[a,1,1]);this.table=b;this.frequency=new AudioletParameter(this,0,c||440);this.phase=0},generate:function(e,j){var c=j[0];var f=c.getChannelData(0);var k=this.audiolet.sampleRate;var m=this.table;var h=m.length;var l=this.phase;var g=this.frequency;var a=c.length;for(var d=0;d<a;d++){var b=g.getValue(d)*h/k;l+=b;if(l>=h){l%=h}f[d]=m[Math.floor(l)]}this.phase=l}});var Saw=new Class({Extends:TableLookupOscillator,initialize:function(a,b){TableLookupOscillator.prototype.initialize.apply(this,[a,Saw.TABLE,b])}});Saw.TABLE=[];for(var i=0;i<8192;i++){Saw.TABLE.push(((((i-4096)/8192)%1)+1)%1*2-1)}var Sine=new Class({Extends:TableLookupOscillator,initialize:function(a,b){TableLookupOscillator.prototype.initialize.apply(this,[a,Sine.TABLE,b])}});Sine.TABLE=[];for(var i=0;i<8192;i++){Sine.TABLE.push(Math.sin(i*2*Math.PI/8192))}var Triangle=new Class({Extends:TableLookupOscillator,initialize:function(a,b){TableLookupOscillator.prototype.initialize.apply(this,[a,Triangle.TABLE,b])}});Triangle.TABLE=[];for(var i=0;i<8192;i++){Triangle.TABLE.push(Math.abs(((i-2048)/8192)%1*2-1)*2-1)}var WhiteNoise=new Class({Extends:AudioletNode,initialize:function(a){AudioletNode.prototype.initialize.apply(this,[a,0,1])},generate:function(d,f){var a=f[0];var e=a.getChannelData(0);var c=a.length;for(var b=0;b<c;b++){e[b]=Math.random()*2-1}}});var Pattern=new Class({initialize:function(){},next:function(){return null},value:function(a){if(instanceOf(a,Pattern)){return(a.next())}else{return(a)}},reset:function(){}});var PArithmetic=new Class({Extends:Pattern,initialize:function(c,b,a){Pattern.prototype.initialize.apply(this);this.value=c;this.step=b;this.repeats=a;this.position=0},next:function(){var a;if(this.position<this.repeats){var b=this.value(this.step);if(b!=null){this.value+=b;a=this.value;this.position+=1}else{a=null}}else{a=null}return(a)}});var Pseries=PArithmetic;var PChoose=new Class({Extends:Pattern,initialize:function(b,a){Pattern.prototype.initialize.apply(this);this.list=b;this.repeats=a||1;this.position=0},next:function(){var b;if(this.position<this.repeats){var a=Math.floor(Math.random()*this.list.length);var c=this.list[a];var d=this.value(c);if(d!=null){if(!instanceOf(c,Pattern)){this.position+=1}b=d}else{this.position+=1;b=this.next()}}else{b=null}return(b)}});var Prand=PChoose;var PGeometric=new Class({Extends:Pattern,initialize:function(c,b,a){Pattern.prototype.initialize(this);this.value=c;this.step=b;this.repeats=a;this.position=0},next:function(){var a;if(this.position<this.repeats){var b=this.value(this.step);if(b!=null){this.value*=b;a=this.value;this.position+=1}else{a=null}}else{a=null}return(a)}});var Pgeom=PGeometric;var PRandom=new Class({Extends:Pattern,initialize:function(a,c,b){Pattern.prototype.initialize(this);this.low=a;this.high=c;this.repeats=b;this.position=0},next:function(){var b;if(this.position<this.repeats){var a=this.value(this.low);var c=this.value(this.high);if(a!=null&&c!=null){this.value*=step;b=this.value;this.position+=1}else{b=null}}else{b=null}return(b)}});var Pwhite=PRandom;var PSequence=new Class({Extends:Pattern,initialize:function(b,a,c){Pattern.prototype.initialize(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0},next:function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.value(c);if(d!=null){if(!instanceOf(c,Pattern)){this.position+=1}b=d}else{this.position+=1;b=this.next()}}else{b=null}return(b)}});var Pseq=PSequence;var PSeries=new Class({Extends:Pattern,initialize:function(b,a,c){Pattern.prototype.initialize(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0},next:function(){var b;if(this.position<this.repeats){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.value(c);if(d!=null){if(!instanceOf(c,Pattern)){this.position+=1}b=d}else{this.position+=1;b=this.next()}}else{b=null}return(b)}});var Pser=PSeries;var PShuffle=new Class({Extends:Pattern,Implements:PSequence,initialize:function(d,a){Pattern.prototype.initialize(this);this.list=[];while(d.length){var b=Math.floor(Math.random()*d.length);var c=d.splice(b,1);this.list.push(c)}this.repeats=a;this.position=0}});var Pshuffle=PShuffle;var PWeightedChoose=new Class({Extends:Pattern,initialize:function(){Pattern.prototype.initialize(this)},next:function(){}});Pwrand=PWeightedChoose;