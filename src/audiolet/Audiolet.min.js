var AudioletNode=new Class({initialize:function(c,b,e,a){this.audiolet=c;this.numberOfInputs=b;this.numberOfOutputs=e;this.inputs=[];var b=this.numberOfInputs;for(var d=0;d<b;d++){this.inputs.push(new AudioletInput(this,d))}this.outputs=[];var e=this.numberOfOutputs;for(var d=0;d<e;d++){this.outputs.push(new AudioletOutput(this,d))}if(a){this.generate=a}this.timestamp=null},connect:function(d,c,b){if(instanceOf(d,AudioletGroup)){d=d.inputs[b||0]}var a=this.outputs[c||0];var e=d.inputs[b||0];a.connect(e);e.connect(a)},disconnect:function(d,c,b){if(instanceOf(d,AudioletGroup)){d=d.inputs[b||0]}var a=this.outputs[c||0];var e=d.inputs[b];e.disconnect(a);a.disconnect(e)},setNumberOfOutputChannels:function(a,b){this.outputs[a].numberOfChannels=b},linkNumberOfOutputChannels:function(b,a){this.outputs[b].linkNumberOfChannels(this.inputs[a])},tick:function(b,c){if(c!=this.timestamp){this.timestamp=c;this.tickParents(b,c);var a=this.createInputBuffers(b);var d=this.createOutputBuffers(b);this.generate(a,d)}},tickParents:function(g,h){var a=this.numberOfInputs;for(var e=0;e<a;e++){var b=this.inputs[e];var f=b.connectedFrom.length;for(var d=0;d<f;d++){var c=f-d-1;b.connectedFrom[c].node.tick(g,h)}}},generate:function(a,b){},createInputBuffers:function(b){var g=[];var h=this.numberOfInputs;for(var e=0;e<h;e++){var o=this.inputs[e];var m=o.connectedFrom;var l=m.length;if(l){var n=0;var f=null;for(var d=0;d<l;d++){var c=m[d];var a=c.buffer;if(a.numberOfChannels>n){n=a.numberOfChannels;f=c}}var k=o.buffer;k.resize(n,b,true);k.set(f.getBuffer(b));for(var d=0;d<l;d++){var c=m[d];if(c!=f){k.add(c.getBuffer(b))}}g.push(k)}else{var k=o.buffer;k.resize(1,b,true);k.isEmpty=true;g.push(k)}}return g},createOutputBuffers:function(c){var e=[];var d=this.numberOfOutputs;for(var b=0;b<d;b++){var a=this.outputs[b];a.buffer.resize(a.getNumberOfChannels(),c,true);e.push(a.buffer)}return(e)},remove:function(){var g=this.inputs.length;for(var e=0;e<g;e++){var h=this.inputs[e];var c=h.connectedFrom.length;for(var d=0;d<c;d++){var a=h.connectedFrom[d];var b=a.node;b.disconnect(this,a.index,e)}}var f=this.outputs.length;for(var e=0;e<f;e++){var b=this.outputs[e];var c=b.connectedTo.length;for(var d=0;d<c;d++){var k=b.connectedTo[d];var h=k.node;this.disconnect(h,e,k.index)}}}});var AbstractAudioletDevice=new Class({Extends:AudioletNode,initialize:function(a){AudioletNode.prototype.initialize.apply(this,[a,1,0]);this.audiolet=a;this.buffer=null},generate:function(a,b){this.buffer=a[0]},getPlaybackTime:function(){return 0},getWriteTime:function(){return 0},toString:function(){return"Device"}});var AudioDataAPIDevice=new Class({Extends:AbstractAudioletDevice,initialize:function(c,b,a,d){AbstractAudioletDevice.prototype.initialize.apply(this,[c]);this.sampleRate=b||44100;this.numberOfChannels=a||2;if(d){this.bufferSize=d;this.autoLatency=false}else{this.bufferSize=this.sampleRate*0.02;this.autoLatency=true}this.output=new Audio();this.overflow=null;this.writePosition=0;this.output.mozSetup(this.numberOfChannels,this.sampleRate);this.started=new Date().valueOf();this.interval=this.tick.periodical(10,this)},tick:function(){var d=this.output.mozCurrentSampleOffset();var b;if(this.overflow){b=this.output.mozWriteAudio(this.overflow);this.writePosition+=b;if(b<this.overflow.length){this.overflow=this.overflow.subarray(b);return}this.overflow=null}var c=d+(this.bufferSize*this.numberOfChannels)-this.writePosition;if(this.autoLatency){var e=(new Date().valueOf()-this.started)/1000;this.bufferSize=this.sampleRate*e;if(d){this.autoLatency=false}}if(c>=this.numberOfChannels){c=Math.floor(c/this.numberOfChannels);AudioletNode.prototype.tick.apply(this,[c,this.getWriteTime()]);var a=this.buffer.interleaved();b=this.output.mozWriteAudio(a);this.writePosition+=b;if(b<a.length){this.overflow=a.subarray(b)}}},getPlaybackTime:function(){return this.output.mozCurrentSampleOffset()/this.numberOfChannels},getWriteTime:function(){return this.writePosition/this.numberOfChannels},toString:function(){return"Audio Data API Device"}});var AudioletBuffer=new Class({initialize:function(a,c){this.numberOfChannels=a;this.length=c;this.channels=[];for(var b=0;b<this.numberOfChannels;b++){this.channels.push(new Float32Array(a*c))}this.unsliced_channels=[];for(var b=0;b<this.numberOfChannels;b++){this.unsliced_channels.push(this.channels[b])}this.isEmpty=false},getChannelData:function(a){return(this.channels[a])},set:function(a){var b=a.numberOfChannels;for(var c=0;c<b;c++){this.channels[c].set(a.getChannelData(c))}},setSection:function(c,g,f,b){f=f||0;b=b||0;var d=c.numberOfChannels;for(var e=0;e<d;e++){var a=this.getChannelData(e).subarray(b,b+g);var h=c.getChannelData(e).subarray(f,f+g);a.set(h)}},add:function(b){var f=this.length;var d=b.numberOfChannels;for(var e=0;e<d;e++){var a=this.getChannelData(e);var g=b.getChannelData(e);for(var c=0;c<f;c++){a[c]+=g[c]}}},addSection:function(f,b,h,a){h=h||0;a=a||0;var k=f.numberOfChannels;for(var g=0;g<k;g++){var d=this.getChannelData(g);var c=f.getChannelData(g);for(var e=0;e<b;e++){d[e+a]+=c[e+h]}}},resize:function(a,e,c,f){f=f||0;for(var b=0;b<a;b++){if(e>this.length){var d=this.channels[b];this.channels[b]=new Float32Array(e);if(!c&&d){this.channels[b].set(d,f)}this.unsliced_channels[b]=this.channels[b]}else{this.channels[b]=this.channels[b].subarray(f,f+e)}}this.numberOfChannels=a;this.length=e},push:function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b);this.setSection(a,b,0,this.length-b)},pop:function(a){var b=a.length;var c=b-length;a.setSection(this,b,c,0);this.resize(this.numberOfChannels,c)},unshift:function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b,false,b);this.setSection(a,b,0,0)},shift:function(a){var b=a.length;a.setSection(this,b,0,0);this.resize(this.numberOfChannels,this.length-b,false,b)},zero:function(){var b=this.numberOfChannels;for(var c=0;c<b;c++){var e=this.getChannelData(c);var d=this.length;for(var a=0;a<d;a++){e[a]=0}}},combined:function(){var a=this.channels;var b=this.numberOfChannels;var e=this.length;var d=new Float32Array(b*e);for(var c=0;c<b;c++){d.set(a[c],c*e)}return d},interleaved:function(){var a=this.channels;var c=this.numberOfChannels;var e=this.length;var f=new Float32Array(c*e);for(var d=0;d<e;d++){for(var b=0;b<c;b++){f[c*d+b]=a[b][d]}}return f},copy:function(){var a=new AudioletBuffer(this.numberOfChannels,this.length);a.set(this);return a}});var AudioletGroup=new Class({initialize:function(b,a,d){this.audiolet=b;this.numberOfInputs=a;this.numberOfOutputs=d;this.inputs=[];for(var c=0;c<a;c++){this.inputs.push(new PassThroughNode(this.audiolet,1,1))}this.outputs=[];for(var c=0;c<d;c++){this.outputs.push(new PassThroughNode(this.audiolet,1,1))}},connect:function(c,b,a){this.outputs[b||0].connect(c,0,a)},disconnect:function(c,b,a){this.outputs[b||0].disconnect(c,0,a)},remove:function(){var a=this.inputs.length;for(var b=0;b<a;b++){this.inputs[b].remove()}var c=this.outputs.length;for(var b=0;b<c;b++){this.outputs[b].remove()}}});var AudioletDestination=new Class({Extends:AudioletGroup,initialize:function(c,b,a,d){AudioletGroup.prototype.initialize.apply(this,[c,1,0]);this.device=new AudioletDevice(c,b,a,d);c.device=this.device;this.scheduler=new Scheduler(c);c.scheduler=this.scheduler;this.blockSizeLimiter=new BlockSizeLimiter(c,Math.pow(2,12));c.blockSizeLimiter=this.blockSizeLimiter;this.upMixer=new UpMixer(c,this.device.numberOfChannels);this.inputs[0].connect(this.blockSizeLimiter);this.blockSizeLimiter.connect(this.scheduler);this.scheduler.connect(this.upMixer);this.upMixer.connect(this.device)}});function AudioletDevice(d,c,b,f){var a=new Audio();var e=(typeof a.mozSetup=="function");a=null;if(e){return(new AudioDataAPIDevice(d,c,b,f))}else{if(typeof AudioContext!="undefined"){return(new WebAudioAPIDevice(d,c,b,f))}else{return(new DummyDevice(d,c,b,f))}}}var AudioletInput=new Class({initialize:function(b,a){this.node=b;this.index=a;this.connectedFrom=[];this.buffer=new AudioletBuffer(1,0);this.overflow=new AudioletBuffer(1,0)},connect:function(a){this.connectedFrom.push(a)},disconnect:function(a){var c=this.connectedFrom.length;for(var b=0;b<c;b++){if(a==this.connectedFrom[b]){this.connectedFrom.splice(b,1);break}}},isConnected:function(){return(this.connectedFrom.length>0)}});var Audiolet=new Class({initialize:function(b,a,c){this.output=new AudioletDestination(this,b,a,c)}});var AudioletOutput=new Class({initialize:function(b,a){this.node=b;this.index=a;this.connectedTo=[];this.buffer=new AudioletBuffer(1,0);this.feedbackBuffer=new AudioletBuffer(1,0);this.outputBuffer=new AudioletBuffer(1,0);this.linkedInput=null;this.numberOfChannels=1;this.suppliesFeedbackLoop=false;this.timestamp=null},connect:function(a){this.connectedTo.push(a)},disconnect:function(a){var c=this.connectedTo.length;for(var b=0;b<c;b++){if(a==this.connectedTo[b]){this.connectedTo.splice(b,1);break}}},isConnected:function(){return(this.connectedTo.length>0)},linkNumberOfChannels:function(a){this.linkedInput=a},unlinkNumberOfChannels:function(){this.linkedInput=null},getNumberOfChannels:function(){if(this.linkedInput&&this.linkedInput.isConnected()){return(this.linkedInput.buffer.numberOfChannels)}return(this.numberOfChannels)},getBuffer:function(d){var b=this.buffer;if(b.length==d&&!this.suppliesFeedbackLoop){return b}else{if(this.node.timestamp==this.timestamp){return this.outputBuffer}else{this.timestamp=this.node.timestamp;var e=this.feedbackBuffer;var c=this.outputBuffer;if(!this.suppliesFeedbackLoop){this.suppliesFeedbackLoop=true;var a=this.node.audiolet.blockSizeLimiter;e.resize(this.getNumberOfChannels(),a.maximumBlockSize,true)}e.resize(this.getNumberOfChannels(),e.length);c.resize(this.getNumberOfChannels(),d,true);e.push(b);e.shift(c);return c}}}});var AudioletParameter=new Class({initialize:function(a,c,b){this.node=a;if(typeof c!="undefined"&&c!=null){this.input=a.inputs[c]}else{this.input=null}this.value=b||0},setValue:function(a){this.value=a},getValue:function(b){var a=this.input;if(a&&a.connectedFrom.length){return(a.buffer.channels[0][b])}else{return(this.value)}}});var BlockSizeLimiter=new Class({Extends:AudioletNode,initialize:function(a,b){AudioletNode.prototype.initialize.apply(this,[a,1,1]);this.maximumBlockSize=b;this.linkNumberOfOutputChannels(0,0)},tick:function(e,f){var c=this.maximumBlockSize;if(e<c){AudioletNode.prototype.tick.apply(this,[e,f])}else{var b=0;var h=null;while(b<e){var g;var a=e%c;if(b==0&&a){g=a}else{g=c}this.tickParents(g,f+b);var d=this.createInputBuffers(g);if(!h){h=this.createOutputBuffers(e)}this.generate(d,h,b);b+=g}}},generate:function(b,d,e){e=e||0;var c=b[0];var a=d[0];if(c.isEmpty){a.isEmpty=true;return}a.setSection(c,c.length,0,e)},toString:function(){return"Block Size Limiter"}});var DummyDevice=new Class({Extends:AbstractAudioletDevice,initialize:function(c,b,a,d){AbstractAudioletDevice.prototype.initialize.apply(this,[c]);this.sampleRate=b||44100;this.numberOfChannels=a||2;this.bufferSize=d||8192;this.writePosition=0;this.tick.periodical(1000*this.bufferSize/this.sampleRate,this)},tick:function(){AudioletNode.prototype.tick.apply(this,[this.bufferSize,this.writePosition]);this.writePosition+=this.bufferSize},getPlaybackTime:function(){return this.writePosition-this.bufferSize},getWriteTime:function(){return this.writePosition},toString:function(){return"Dummy Device"}});var PassThroughNode=new Class({Extends:AudioletNode,initialize:function(b,a,c){AudioletNode.prototype.initialize.apply(this,[b,a,c])},createOutputBuffers:function(e){var g=[];var f=this.numberOfOutputs;var a=this.numberOfInputs;for(var d=0;d<f;d++){var c=this.outputs[d];if(d<a){var b=this.inputs[d];c.buffer=b.buffer}else{c.buffer.resize(c.getNumberOfChannels(),e)}g.push(c.buffer)}return(g)},toString:function(){return"Pass Through Node"}});var PriorityQueue=new Class({initialize:function(c,b){if(b){this.compare=b}if(c){this.heap=c;for(var a=0;a<Math.floor(this.heap.length/2);a++){this.siftUp(a)}}else{this.heap=[]}},push:function(a){this.heap.push(a);this.siftDown(0,this.heap.length-1)},pop:function(){var b,a;b=this.heap.pop();if(this.heap.length){var a=this.heap[0];this.heap[0]=b;this.siftUp(0)}else{a=b}return(a)},peek:function(){return(this.heap[0])},isEmpty:function(){return(this.heap.length==0)},siftDown:function(d,a){var b=this.heap[a];while(a>d){var e=(a-1)>>1;var c=this.heap[e];if(this.compare(b,c)){this.heap[a]=c;a=e;continue}break}this.heap[a]=b},siftUp:function(a){var e=this.heap.length;var d=a;var c=this.heap[a];var b=2*a+1;while(b<e){var f=b+1;if(f<e&&!this.compare(this.heap[b],this.heap[f])){b=f}this.heap[a]=this.heap[childposition];a=b;b=2*a+1}this.heap[a]=c;this.siftDown(d,a)},compare:function(d,c){return(d<c)}});var Scheduler=new Class({Extends:AudioletNode,initialize:function(a,c){AudioletNode.prototype.initialize.apply(this,[a,1,1]);this.linkNumberOfOutputChannels(0,0);this.bpm=c||120;this.queue=new PriorityQueue(null,function(e,d){return(e.time<d.time)});this.time=0;this.beat=0;this.beatInBar=0;this.bar=0;this.seconds=0;this.beatsPerBar=0;this.lastBeatTime=0;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate;var b=new AudioletBuffer(1,1)},setTempo:function(a){this.bpm=a;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate},addRelative:function(a,c){var b={};b.callback=c;b.time=this.time+a*this.beatLength;this.queue.push(b);return b},addAbsolute:function(b,c){if(b<this.beat||b==this.beat&&this.time>this.lastBeatTime){return null}var a={};a.callback=c;a.time=this.lastBeatTime+(b-this.beat)*this.beatLength;this.queue.push(a);return a},play:function(b,a,d){var c={};c.patterns=b;c.durationPattern=a;c.callback=d;c.time=this.audiolet.device.getWriteTime();this.queue.push(c)},remove:function(){},tick:function(c,j){var d=this.audiolet.device.getWriteTime();this.updateClock(d);var k=null;var a=d;while(!this.queue.isEmpty()&&this.queue.peek().time<=d+c){var b=this.queue.pop();var e=b.time-a;if(e>0){var g=a-d;this.tickParents(e,j+g);var h=this.createInputBuffers(e);if(!k){var k=this.createOutputBuffers(c)}this.generate(h,k,g)}this.updateClock(b.time);a=b.time;this.processEvent(b)}var f=d+c-a;if(f){this.tickParents(f,j+a-d);var h=this.createInputBuffers(f);if(!k){var k=this.createOutputBuffers(c)}var g=a-d;this.generate(h,k,g)}},updateClock:function(a){this.time=a;this.seconds=this.time*this.audiolet.device.sampleRate;if(this.time>=this.lastBeatTime+this.beatLength){this.beat+=1;this.beatInBar+=1;if(this.beatInBar==this.beatsPerBar){this.bar+=1;this.beatInBar=0}this.lastBeatTime+=this.beatLength}},processEvent:function(a){var h=a.durationPattern;if(h){var g=[];var b=a.patterns;var e=b.length;for(var d=0;d<e;d++){var f=b[d];var j=f.next();if(j!=null){g.push(j)}else{return}}a.callback.apply(null,g);var c;if(instanceOf(h,Pattern)){c=h.next()}else{c=h}if(c){a.time+=c*this.beatLength;a.time=Math.floor(a.time);this.queue.push(a)}}},generate:function(d,f,g){var e=d[0];var b=f[0];for(var c=0;c<e.numberOfChannels;c++){var h;if(e.isEmpty){emptyBuffer.resize(e.numberOfChannels,e.length);h=emptyBuffer.getChannelData(0)}else{h=e.getChannelData(c)}var a=b.getChannelData(c);a.set(h,g)}},toString:function(){return"Scheduler"}});var Int8Array,Uint8Array,Int16Array,Uint16Array;var Int32Array,Uint32Array,Float32Array,Float64Array;var types=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];var original,shim;for(var i=0;i<types.length;++i){if(types[i]){if(types[i].prototype.slice===undefined){original="subarray";shim="slice"}else{if(types[i].prototype.subarray===undefined){original="slice";shim="subarray"}}Object.defineProperty(types[i].prototype,shim,{value:types[i].prototype[original],enumerable:false})}}var WebAudioAPIDevice=new Class({Extends:AbstractAudioletDevice,initialize:function(c,b,a,f){AbstractAudioletDevice.prototype.initialize.apply(this,[c]);this.sampleRate=b||44100;this.numberOfChannels=a||2;this.bufferSize=f||8192;var e,d;e=e||d;this.context=new e(this.sampleRate);this.node=this.context.createJavaScriptAudioNode(this.bufferSize,1,1);this.node.onprocessaudio=this.tick;this.writePosition=0},tick:function(e){var a=e.outputBuffer[0];var f=a.length;AudioletNode.prototype.tick.apply(this,[f]);var b=a.numberOfChannels;for(var c=0;c<b;c++){var d=a.getChannelData(c);d.set(this.buffer.getChannelData(c))}this.writePosition+=f},getPlaybackTime:function(){return this.context.currentTime*this.sampleRate},getWriteTime:function(){return this.writePosition},toString:function(){return"Web Audio API Device"}});var Envelope=new Class({Extends:AudioletNode,initialize:function(b,c,d,f,a,e){AudioletNode.prototype.initialize.apply(this,[b,1,1]);this.gate=new AudioletParameter(this,0,c||1);this.levels=d;this.times=f;this.releaseStage=a;this.onComplete=e;this.stage=null;this.time=null;this.changeTime=null;this.level=0;this.delta=0;this.gateOn=false},generate:function(h,o){var d=o[0];var k=d.getChannelData(0);var m=this.gate;var q=this.releaseStage;var l=this.stage;var c=this.time;var g=this.changeTime;var b=this.level;var p=this.delta;var j=this.gateOn;var n=false;var a=d.length;for(var e=0;e<a;e++){var f=m.getValue(e);if(f&&!j){j=true;l=0;c=0;n=true}if(j&&!f){j=false;if(q){l=q;n=true}}if(g){c+=1;if(c>=g){l+=1;if(l!=q){n=true}else{g=null;p=0}}}if(n){b=this.levels[l];if(l!=this.times.length){p=this.calculateDelta(l,b);g=this.calculateChangeTime(l,c)}else{if(this.onComplete){this.onComplete()}l=null;c=null;g=null;p=0}n=false}b+=p;k[e]=b}this.stage=l;this.time=c;this.changeTime=g;this.level=b;this.delta=p;this.gateOn=j},calculateDelta:function(b,d){var c=this.levels[b+1]-d;var a=this.times[b]*this.audiolet.device.sampleRate;return(c/a)},calculateChangeTime:function(b,c){var a=this.times[b]*this.audiolet.device.sampleRate;return(c+a)},toString:function(){return"Envelope"}});var ADSREnvelope=new Class({Extends:Envelope,initialize:function(j,e,c,d,g,f,b){var h=[0,1,g,0];var a=[c,d,f];Envelope.prototype.initialize.apply(this,[j,e,h,a,2,b])},toString:function(){return"ADSR Envelope"}});var BiquadFilter=new Class({Extends:AudioletNode,initialize:function(a,b){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.linkNumberOfOutputChannels(0,0);this.frequency=new AudioletParameter(this,1,b||22100);this.lastFrequency=null;this.xValues=[];this.yValues=[];this.b0=0;this.b1=0;this.b2=0;this.a0=0;this.a1=0;this.a2=0},calculateCoefficients:function(a){},generate:function(c,p){var u=c[0];var B=p[0];if(u.isEmpty){B.isEmpty=true;return}var e=[];var r=[];var f=u.numberOfChannels;for(var w=0;w<f;w++){e.push(u.getChannelData(w));r.push(B.getChannelData(w));if(w>=this.xValues.length){this.xValues.push([0,0]);this.yValues.push([0,0])}}var o=this.frequency;var q=this.lastFrequency;var E=this.a0;var D=this.a1;var C=this.a2;var n=this.b0;var m=this.b1;var l=this.b2;var k=B.length;for(var w=0;w<k;w++){var t=o.getValue(w);if(t!=q){this.calculateCoefficients(t);q=t;E=this.a0;D=this.a1;C=this.a2;n=this.b0;m=this.b1;l=this.b2}for(var v=0;v<f;v++){var h=e[v];var s=r[v];var z=this.xValues[v];var y=z[0];var x=z[1];var g=this.yValues[v];var b=g[0];var a=g[1];var A=h[w];var d=(n/E)*A+(m/E)*y+(l/E)*x-(D/E)*b-(C/E)*a;s[w]=d;z[0]=A;z[1]=y;g[0]=d;g[1]=b}}this.lastFrequency=q},toString:function(){return"Biquad Filter"}});var AllPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1-d;this.b1=-2*a;this.b2=1+d;this.a0=1+d;this.a1=-2*a;this.a2=1-d},toString:function(){return"All Pass Filter"}});var BandPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=d;this.b1=0;this.b2=-d;this.a0=1+d;this.a1=-2*a;this.a2=1-d},toString:function(){return"Band Pass Filter"}});var BandRejectFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1;this.b1=-2*a;this.b2=1;this.a0=1+d;this.a1=-2*a;this.a2=1-d},toString:function(){return"Band Reject Filter"}});var Delay=new Class({Extends:AudioletNode,initialize:function(a,c,b){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.maximumDelayTime=c;this.delayTime=new AudioletParameter(this,1,b||1);var d=c*this.audiolet.device.sampleRate;this.buffer=new Float32Array(Math.floor(d));this.readWriteIndex=0},generate:function(j,m){var k=j[0];var c=m[0];if(k.isEmpty){c.isEmpty=true;return}var l=this.delayTime;var f=this.buffer;var d=this.readWriteIndex;var n=this.audiolet.device.sampleRate;var b=k.getChannelData(0);var e=c.getChannelData(0);var a=k.length;for(var g=0;g<a;g++){var h=l.getValue(g)*n;h=Math.floor(h);e[g]=f[d];f[d]=b[g];d+=1;if(d>=h){d=0}}this.readWriteIndex=d},toString:function(){return"Delay"}});var DiscontinuityDetector=new Class({Extends:PassThroughNode,initialize:function(b,a,c){PassThroughNode.prototype.initialize.apply(this,[b,1,1]);this.linkNumberOfOutputChannels(0,0);this.threshold=a||0.2;if(c){this.callback=c}this.lastValues=[]},callback:function(){},generate:function(d,l){var g=d[0];var f=this.lastValues;var e=this.threshold;var m=g.numberOfChannels;for(var c=0;c<m;c++){var h=g.getChannelData(c);if(c>=f.length){f.push(null)}var k=f[c];var a=g.length;for(var b=0;b<a;b++){var n=h[b];if(k!=null){if(Math.abs(k-n)>e){this.callback()}}k=n}f[c]=k}},toString:function(){return"Discontinuity Detector"}});var Gain=new Class({Extends:AudioletNode,initialize:function(a,b){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.linkNumberOfOutputChannels(0,0);this.gain=new AudioletParameter(this,1,b||1)},generate:function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var m=this.gain;var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){e[d]=b[d]*m.getValue(d)}}},toString:function(){return("Gain")}});var HighPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1+a)/2;this.b1=-(1+a);this.b2=this.b1;this.a0=1+d;this.a1=-2*a;this.a2=1-d},toString:function(){return"High Pass Filter"}});var LowPassFilter=new Class({Extends:BiquadFilter,initialize:function(a,b){BiquadFilter.prototype.initialize.apply(this,[a,b])},calculateCoefficients:function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1-a)/2;this.b1=1-a;this.b2=this.b1;this.a0=1+d;this.a1=-2*a;this.a2=1-d},toString:function(){return"Low Pass Filter"}});var MulAdd=new Class({Extends:AudioletNode,initialize:function(a,c,b){AudioletNode.prototype.initialize.apply(this,[a,3,1]);this.linkNumberOfOutputChannels(0,0);this.mul=new AudioletParameter(this,1,c||1);this.add=new AudioletParameter(this,2,b||0)},generate:function(k,n){var l=k[0];var c=n[0];var e=this.mul;var m=this.add;var o=l.numberOfChannels;for(var h=0;h<o;h++){var b=l.getChannelData(h);var g=c.getChannelData(h);var a=l.length;for(var f=0;f<a;f++){var d=e.getValue(f);var p=m.getValue(f);g[f]=b[f]*d+p}}},toString:function(){return"Multiplier/Adder"}});var Pan=new Class({Extends:AudioletNode,initialize:function(a){AudioletNode.prototype.initialize.apply(this,[a,2,1]);this.setNumberOfOutputChannels(0,2);this.pan=new AudioletParameter(this,1,0.5)},generate:function(g,j){var h=g[0];var d=j[0];if(h.isEmpty){d.isEmpty=true;return}var b=h.getChannelData(0);var e=d.getChannelData(0);var c=d.getChannelData(1);var m=this.pan;var a=d.length;for(var f=0;f<a;f++){var l=this.pan.getValue(f)*Math.PI/2;var k=b[f];e[f]=k*Math.cos(l);c[f]=k*Math.sin(l)}},toString:function(){return"Stereo Panner"}});var PercussiveEnvelope=new Class({Extends:Envelope,initialize:function(b,c,g,a,e){var d=[0,1,0];var f=[g,a];Envelope.prototype.initialize.apply(this,[b,c,d,f,null,e])},toString:function(){return"Percussive Envelope"}});var TableLookupOscillator=new Class({Extends:AudioletNode,initialize:function(a,b,c){AudioletNode.prototype.initialize.apply(this,[a,1,1]);this.table=b;this.frequency=new AudioletParameter(this,0,c||440);this.phase=0},generate:function(e,j){var c=j[0];var f=c.getChannelData(0);var k=this.audiolet.device.sampleRate;var m=this.table;var h=m.length;var l=this.phase;var g=this.frequency;var a=c.length;for(var d=0;d<a;d++){var b=g.getValue(d)*h/k;l+=b;if(l>=h){l%=h}f[d]=m[Math.floor(l)]}this.phase=l},toString:function(){return"Table Lookup Oscillator"}});var Saw=new Class({Extends:TableLookupOscillator,initialize:function(a,b){TableLookupOscillator.prototype.initialize.apply(this,[a,Saw.TABLE,b])},toString:function(){return"Saw"}});Saw.TABLE=[];for(var i=0;i<8192;i++){Saw.TABLE.push(((((i-4096)/8192)%1)+1)%1*2-1)}var Sine=new Class({Extends:TableLookupOscillator,initialize:function(a,b){TableLookupOscillator.prototype.initialize.apply(this,[a,Sine.TABLE,b])},toString:function(){return"Sine"}});Sine.TABLE=[];for(var i=0;i<8192;i++){Sine.TABLE.push(Math.sin(i*2*Math.PI/8192))}var Triangle=new Class({Extends:TableLookupOscillator,initialize:function(a,b){TableLookupOscillator.prototype.initialize.apply(this,[a,Triangle.TABLE,b])},toString:function(){return"Triangle"}});Triangle.TABLE=[];for(var i=0;i<8192;i++){Triangle.TABLE.push(Math.abs(((((i-2048)/8192)%1)+1)%1*2-1)*2-1)}var TriggerControl=new Class({Extends:AudioletNode,initialize:function(b,a){AudioletNode.prototype.initialize.apply(this,[b,0,1]);this.trigger=new AudioletParameter(this,null,a||0)},generate:function(f,h){var a=h[0];var g=a.getChannelData(0);var b=this.trigger;var e=a.length;for(var d=0;d<e;d++){var c=b.getValue(d);if(c){g[d]=1;b.setValue(0)}else{g[d]=0}}},toString:function(){return"TriggerControl"}});var UpMixer=new Class({Extends:AudioletNode,initialize:function(a,b){AudioletNode.prototype.initialize.apply(this,[a,1,1]);this.outputChannels=b;this.outputs[0].numberOfChannels=b},generate:function(e,h){var f=e[0];var b=h[0];if(f.isEmpty){b.isEmpty=true;return}var g=this.outputChannels;var j=f.numberOfChannels;for(var d=0;d<g;d++){var a=f.getChannelData(d%j);var c=b.getChannelData(d);c.set(a)}},toString:function(){return"UpMixer"}});var WhiteNoise=new Class({Extends:AudioletNode,initialize:function(a){AudioletNode.prototype.initialize.apply(this,[a,0,1])},generate:function(d,f){var a=f[0];var e=a.getChannelData(0);var c=a.length;for(var b=0;b<c;b++){e[b]=Math.random()*2-1}},toString:function(){return"White Noise"}});var Pattern=new Class({initialize:function(){},next:function(){return null},valueOf:function(a){if(instanceOf(a,Pattern)){return(a.next())}else{return(a)}},reset:function(){}});var PArithmetic=new Class({Extends:Pattern,initialize:function(c,b,a){Pattern.prototype.initialize.apply(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0},next:function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value+=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)},reset:function(){this.value=this.start;this.position=0;if(instanceOf(this.step,Pattern)){this.step.reset()}}});var Pseries=PArithmetic;var PChoose=new Class({Extends:Pattern,initialize:function(b,a){Pattern.prototype.initialize.apply(this);this.list=b;this.repeats=a||1;this.position=0},next:function(){var b;if(this.position<this.repeats){var a=Math.floor(Math.random()*this.list.length);var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!instanceOf(c,Pattern)){this.position+=1}b=d}else{if(instanceOf(c,Pattern)){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)},reset:function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(instanceOf(b,Pattern)){b.reset()}}}});var Prand=PChoose;var PGeometric=new Class({Extends:Pattern,initialize:function(c,b,a){Pattern.prototype.initialize(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0},next:function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value*=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)},reset:function(){this.value=this.start;this.position=0;if(instanceOf(this.step,Pattern)){this.step.reset()}}});var Pgeom=PGeometric;var PRandom=new Class({Extends:Pattern,initialize:function(a,c,b){Pattern.prototype.initialize(this);this.low=a;this.high=c;this.repeats=b;this.position=0},next:function(){var b;if(this.position<this.repeats){var a=this.valueOf(this.low);var c=this.valueOf(this.high);if(a!=null&&c!=null){this.value*=step;b=this.value;this.position+=1}else{b=null}}else{b=null}return(b)},reset:function(){this.position=0}});var Pwhite=PRandom;var PSequence=new Class({Extends:Pattern,initialize:function(b,a,c){Pattern.prototype.initialize(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0},next:function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!instanceOf(c,Pattern)){this.position+=1}b=d}else{if(instanceOf(c,Pattern)){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)},reset:function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(instanceOf(b,Pattern)){b.reset()}}}});var Pseq=PSequence;var PSeries=new Class({Extends:Pattern,initialize:function(b,a,c){Pattern.prototype.initialize(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0},next:function(){var b;if(this.position<this.repeats){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!instanceOf(c,Pattern)){this.position+=1}b=d}else{if(instanceOf(c,Pattern)){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)},reset:function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(instanceOf(b,Pattern)){b.reset()}}}});var Pser=PSeries;var PShuffle=new Class({Extends:Pattern,Implements:PSequence,initialize:function(d,a){Pattern.prototype.initialize(this);this.list=[];while(d.length){var b=Math.floor(Math.random()*d.length);var c=d.splice(b,1);this.list.push(c)}this.repeats=a;this.position=0}});var Pshuffle=PShuffle;var PWeightedChoose=new Class({Extends:Pattern,initialize:function(){Pattern.prototype.initialize(this)},next:function(){}});Pwrand=PWeightedChoose;var Scale=new Class({initialize:function(b,a){this.degrees=b;this.tuning=a||new EqualTemperamentTuning(12)},getFrequency:function(d,a,b){var c=a;c*=Math.pow(this.tuning.octaveRatio,b);c*=this.tuning.ratios[this.degrees[d]];return c}});var MajorScale=new Class({Extends:Scale,initialize:function(){Scale.prototype.initialize.apply(this,[[0,2,4,5,7,9,11]])}});var Tuning=new Class({initialize:function(d,c){this.semitones=d;this.octaveRatio=c||2;this.ratios=[];var b=this.semitones.length;for(var a=0;a<b;a++){this.ratios.push(Math.pow(2,a/b))}}});var EqualTemperamentTuning=new Class({Extends:Tuning,initialize:function(b){var c=[];for(var a=0;a<b;a++){c.push(a)}Tuning.prototype.initialize.apply(this,[c,2])}});